"use strict";(self.webpackChunkbillit=self.webpackChunkbillit||[]).push([[592],{3208:(R,f,i)=>{i.d(f,{v:()=>u});var l=i(4762),h=i(8312),I=i(6215),c=i(9067),a=i(9670),d=i(4885),p=i(2178),g=i(7716),D=i(1841),L=i(4416),E=i(7001),O=i(7048);let u=(()=>{class _{constructor(t,s,e,o){this.http=t,this.helperService=s,this._snackBar=e,this.dialogService=o,this.customerList$=new I.X(null),this.purchaseData$=new I.X(null),this.customerUrl=h.a.customerUrl,this.isDataLoaded=!1,this.initDate()}addCustomer(t){return(0,l.mG)(this,void 0,void 0,function*(){const s=this.dialogService.openDialog(p.pW,a.ib.progressBar);s.componentInstance.mode="indeterminate",s.componentInstance.color="accent";const e=yield this.http.post(this.customerUrl,t,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();s.close();const o=this.getCustomerListValue();return o.length?(o.splice(this.helperService._alphebaticallocationOf(e,o),0,e),this.customerList$.next(o)):this.customerList$.next([e]),this._snackBar.open("Customer added successfully!",null,a.R$.success),e})}getAllCustomers(){return this.isDataLoaded||this.loadCustomers(),this.customerList$.asObservable()}getCustomer(t){return(0,l.mG)(this,void 0,void 0,function*(){const s=this.getCustomerListValue();for(const n of s)if(n._id===t)return n;const e=this.dialogService.openDialog(p.pW,a.ib.progressBar);e.componentInstance.mode="indeterminate",e.componentInstance.color="accent";const o=yield this.http.get(`${this.customerUrl}/${t}`,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();return e.close(),o})}updateCustomer(t,s){return(0,l.mG)(this,void 0,void 0,function*(){const e=this.dialogService.openDialog(p.pW,a.ib.progressBar);e.componentInstance.mode="indeterminate",e.componentInstance.color="accent";const o=yield this.http.patch(`${this.customerUrl}/${t}`,s,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();e.close();const n=this.getCustomerListValue(),m=n.findIndex(v=>v._id===t);-1!==m&&(n.splice(m,1)[0].name.toLocaleLowerCase()===o.name.toLocaleLowerCase()?n.splice(m,0,o):n.length?n.splice(this.helperService._alphebaticallocationOf(o,n),0,o):n.push(o),this.customerList$.next(n),this._snackBar.open("Customer updated successfully!",null,a.R$.success))})}removeCustomer(t){return(0,l.mG)(this,void 0,void 0,function*(){const s=h.a.removeCustomerUrl,e=this.dialogService.openDialog(p.pW,a.ib.progressBar);e.componentInstance.mode="indeterminate",e.componentInstance.color="accent",yield this.http.patch(`${s}/${t}`,null,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise(),e.close();const o=this.customerList$.getValue(),n=o.findIndex(m=>m._id===t);-1!==n&&(o.splice(n,1),this.customerList$.next(o)),this._snackBar.open("Customer removed successfully!",null,a.R$.success)})}deleteCustomer(t){return(0,l.mG)(this,void 0,void 0,function*(){const s=this.dialogService.openDialog(p.pW,a.ib.progressBar);s.componentInstance.mode="indeterminate",s.componentInstance.color="accent",yield this.http.delete(`${this.customerUrl}/${t}`,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise(),s.close();const e=this.customerList$.getValue(),o=e.findIndex(n=>n._id===t);-1!==o&&(e.splice(o,1),this.customerList$.next(e)),this._snackBar.open("Customer deleted successfully!",null,a.R$.success)})}getCurrentDateRange(){return{startDate:this.startOfRange,endDate:this.endDate}}loadPurchaseDetails(t,s,e){return(0,l.mG)(this,void 0,void 0,function*(){const o=this.helperService._getDateRange(s,e);this.startOfRange=o.startOfRange,this.endOfRange=o.endOfRange,e&&(this.endDate=e);const n={shopId:c.cQ.storageHelper.shopId,startDate:this.startOfRange.toISOString(),endDate:this.endOfRange.toISOString(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},m=this.dialogService.openDialog(d.$g,a.ib.spinnerBig),v=yield this.http.get(`${h.a.customerPurchaseReportUrl}/${t}`,{params:n}).toPromise();return m.close(),v})}initDate(){const t=new Date;t.setDate(t.getDate()-7),this.endDate=new Date;const s=this.helperService._getDateRange(t,this.endDate);this.startOfRange=s.startOfRange,this.endOfRange=s.endOfRange}loadCustomers(){const t=this.dialogService.openDialog(p.pW,a.ib.progressBar);t.componentInstance.mode="indeterminate",t.componentInstance.color="accent",this.http.get(h.a.allCustomersUrl,{params:{shopId:c.cQ.storageHelper.shopId}}).subscribe(s=>{this.customerList$.next(s),this.isDataLoaded=!0,t.close()})}getCustomerListValue(){return this.customerList$.getValue()}}return _.\u0275fac=function(t){return new(t||_)(g.LFG(D.eN),g.LFG(L.W),g.LFG(E.ux),g.LFG(O.x))},_.\u0275prov=g.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},7672:(R,f,i)=>{i.d(f,{e:()=>O});var l=i(4762),h=i(8312),I=i(6215),c=i(9067),a=i(9670),d=i(2178),p=i(7716),g=i(1841),D=i(4416),L=i(7001),E=i(7048);let O=(()=>{class u{constructor(r,t,s,e){this.http=r,this.helperService=t,this._snackBar=s,this.dialogService=e,this.itemList$=new I.X(null),this.itemUrl=h.a.itemUrl,this.isDataLoaded=!1}addItem(r){return(0,l.mG)(this,void 0,void 0,function*(){const t=this.dialogService.openDialog(d.pW,a.ib.progressBar);t.componentInstance.mode="indeterminate",t.componentInstance.color="accent";const s=yield this.http.post(this.itemUrl,r,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();t.close();const e=this.getItemListValue();return e.length?(e.splice(this.helperService._alphebaticallocationOf(s,e),0,s),this.itemList$.next(e)):this.itemList$.next([s]),this._snackBar.open("Item added successfully!",null,a.R$.success),s})}getAllItems(){return this.isDataLoaded||this.loadItems(),this.itemList$.asObservable()}getItem(r){return(0,l.mG)(this,void 0,void 0,function*(){const t=this.getItemListValue();for(const o of t)if(o._id===r)return o;const s=this.dialogService.openDialog(d.pW,a.ib.progressBar);s.componentInstance.mode="indeterminate",s.componentInstance.color="accent";const e=yield this.http.get(`${this.itemUrl}/${r}`,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();return s.close(),e})}updateItem(r,t){return(0,l.mG)(this,void 0,void 0,function*(){const s=this.dialogService.openDialog(d.pW,a.ib.progressBar);s.componentInstance.mode="indeterminate",s.componentInstance.color="accent";const e=yield this.http.patch(`${this.itemUrl}/${r}`,t,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise();s.close();const o=this.getItemListValue(),n=o.findIndex(m=>m._id===r);-1!==n&&(o.splice(n,1)[0].name.toLocaleLowerCase()===e.name.toLocaleLowerCase()?o.splice(n,0,e):o.splice(this.helperService._alphebaticallocationOf(e,o),0,e),this.itemList$.next(o),this._snackBar.open("Item updated successfully!",null,a.R$.success))})}removeItem(r){return(0,l.mG)(this,void 0,void 0,function*(){const t=h.a.removeItemUrl,s=this.dialogService.openDialog(d.pW,a.ib.progressBar);s.componentInstance.mode="indeterminate",s.componentInstance.color="accent",yield this.http.patch(`${t}/${r}`,null,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise(),s.close();const e=this.itemList$.getValue(),o=e.findIndex(n=>n._id===r);-1!==o&&(e.splice(o,1),this.itemList$.next(e)),this._snackBar.open("Item removed successfully!",null,a.R$.success)})}deleteItem(r){return(0,l.mG)(this,void 0,void 0,function*(){const t=this.dialogService.openDialog(d.pW,a.ib.progressBar);t.componentInstance.mode="indeterminate",t.componentInstance.color="accent",yield this.http.delete(`${this.itemUrl}/${r}`,{params:{shopId:c.cQ.storageHelper.shopId}}).toPromise(),t.close();const s=this.itemList$.getValue(),e=s.findIndex(o=>o._id===r);-1!==e&&(s.splice(e,1),this.itemList$.next(s)),this._snackBar.open("Item deleted successfully!",null,a.R$.success)})}loadItems(){const r=this.dialogService.openDialog(d.pW,a.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent",this.http.get(h.a.allItemsUrl,{params:{shopId:c.cQ.storageHelper.shopId}}).subscribe(t=>{this.itemList$.next(t),this.isDataLoaded=!0,r.close()})}getItemListValue(){return this.itemList$.getValue()}}return u.\u0275fac=function(r){return new(r||u)(p.LFG(g.eN),p.LFG(D.W),p.LFG(L.ux),p.LFG(E.x))},u.\u0275prov=p.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);