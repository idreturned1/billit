"use strict";(self.webpackChunkbillit=self.webpackChunkbillit||[]).push([[551],{8551:(Jo,J,l)=>{l.r(J),l.d(J,{OrdersModule:()=>Qo});var g=l(9808),s=l(3075),T=l(7322),m=l(4999),S=l(5245),D=l(6087),I=l(7531),A=l(7423),O=l(4847),F=l(3092),f=l(6856),x=l(9224),B=l(4107),$=l(2368),w=l(7238),h=l(8966),Z=l(5899),L=l(1787),u=l(655),C=l(1777),W=l(7579),q=l(727),R=l(9841),y=l(8675),j=l(4004),X=l(8505),k=l(7165),_=l(9670),t=l(5e3),P=l(4416),H=l(3208),K=l(7672),N=l(6344),v=l(9067),tt=l(1135),b=l(4464),et=l(773),E=l(520),Y=l(7048);let G=(()=>{class o{constructor(e,r){this.http=e,this.dialogService=r,this.receiptMap=new Map}generateReceiptForOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){const r=yield(0,b.n)(this.http.post(`${N.a.receiptForOrderUrl}/${e}`,null,{params:{shopId:v.cQ.storageHelper.shopId}}));this.receiptMap.set(e,r)})}getReceiptForOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(Z.pW,_.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent";let n=this.receiptMap.get(e);return n||(n=yield(0,b.n)(this.http.get(`${N.a.receiptForOrderUrl}/${e}`,{params:{shopId:v.cQ.storageHelper.shopId}})),r.close(),n)})}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(E.eN),t.LFG(Y.x))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var ot=l(2266),rt=l(7261);let Q=(()=>{class o{constructor(e,r,n,a,d,c,p){this.http=e,this.receiptService=r,this.helperService=n,this.reportService=a,this._snackBar=d,this.dialogService=c,this.customerService=p,this.orderList$=new tt.X(null),this.orderUrl=N.a.orderUrl,this.isDataLoaded=!1,this.initDate()}getOrders(){return this.isDataLoaded||this.loadOrders(),this.orderList$.asObservable()}getCurrentDateRange(){return{startDate:this.startOfRange,endDate:this.endDate}}updateOrderDateRange(e,r){const n=this.helperService._getDateRange(e,r);this.startOfRange=n.startOfRange,this.endOfRange=n.endOfRange,r&&(this.endDate=r),this.getOrdersFromCache()||this.loadOrders()}addOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(Z.pW,_.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent";const n=yield(0,b.n)(this.http.post(this.orderUrl,e,{params:{shopId:v.cQ.storageHelper.shopId}}));if(r.close(),this.orderCache.startOfRange<=new Date(n.deliveryDate)&&this.orderCache.endOfRange>=new Date(n.deliveryDate)&&this.orderCache.orders.push(n),this.isOrderInRange(n.deliveryDate)){const a=this.getOrderListValue();a.length?(a.splice(this.helperService._deliveryDateLocationOf(n,a),0,n),this.orderList$.next(a)):this.orderList$.next([n])}return this._snackBar.open("Order added successfully!",null,_.R$.success),n})}updateOrder(e,r){return(0,u.mG)(this,void 0,void 0,function*(){const n=this.dialogService.openDialog(Z.pW,_.ib.progressBar);n.componentInstance.mode="indeterminate",n.componentInstance.color="accent";const a=yield(0,b.n)(this.http.patch(`${this.orderUrl}/${e}`,r,{params:{shopId:v.cQ.storageHelper.shopId}}));if(n.close(),this.orderCache){const p=this.orderCache.orders.findIndex(M=>M._id===e);-1!==p&&(this.orderCache.orders[p]=this.helperService._clone(a))}const d=this.getOrderListValue(),c=d.findIndex(p=>p._id===e);if(-1!==c&&(d.splice(c,1)[0].deliveryDate===a.deliveryDate?d.splice(c,0,a):this.isOrderInRange(a.deliveryDate)&&(d.length?d.splice(this.helperService._deliveryDateLocationOf(a,d),0,a):d.push(a)),this.orderList$.next(d),this._snackBar.open("Order updated successfully!",null,_.R$.success)),a.paymentCompleted&&a.completed){yield this.receiptService.generateReceiptForOrder(e);const p=a.customer.currentPoints+Math.round(a.billAmount)-a.pointsUsed;yield this.customerService.updateCustomer(a.customer._id,{currentPoints:p})}this.reportService.refreshData()})}deleteOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(Z.pW,_.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent",yield(0,b.n)(this.http.delete(`${this.orderUrl}/${e}`,{params:{shopId:v.cQ.storageHelper.shopId}})),r.close();const n=this.orderList$.getValue();if(this.orderCache){const d=this.orderCache.orders.findIndex(c=>c._id===e);-1!==d&&this.orderCache.orders.splice(d,1)}const a=n.findIndex(d=>d._id===e);-1!==a&&(n.splice(a,1),this.orderList$.next(n)),this._snackBar.open("Order deleted successfully!",null,_.R$.success),this.reportService.refreshData()})}clearOrdersCache(){this.orderCache=null}addOrdersToCache(e){const r=this.helperService._clone(e);if(this.orderCache){let n=!1;this.startOfRange<=this.orderCache.startOfRange&&this.endOfRange>=this.orderCache.startOfRange&&(this.orderCache.startOfRange=this.startOfRange,n=!0),this.endOfRange>=this.orderCache.endOfRange&&this.startOfRange<=this.orderCache.endOfRange&&(this.orderCache.endOfRange=this.endOfRange,n=!0),n&&(this.orderCache.orders.length?r.forEach(a=>{const d=this.orderCache.orders.findIndex(c=>c._id===a._id);-1!==d?this.orderCache.orders[d]=a:this.orderCache.orders.push(a)}):this.orderCache.orders=r)}else this.orderCache={startOfRange:this.startOfRange,endOfRange:this.endOfRange,orders:this.helperService._clone(r)}}loadOrders(){const e={shopId:v.cQ.storageHelper.shopId,startDate:this.startOfRange.toISOString(),endDate:this.endOfRange.toISOString()},r=this.dialogService.openDialog(et.Ou,_.ib.spinnerBig);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent",this.http.get(N.a.allOrdersUrl,{params:e}).subscribe(n=>{this.orderList$.next(n),this.addOrdersToCache(n),this.isDataLoaded=!0,r.close()})}getOrdersFromCache(){if(this.orderCache&&this.orderCache.startOfRange<=this.startOfRange&&this.orderCache.endOfRange>=this.endOfRange){const e=this.orderCache.orders.filter(r=>new Date(r.deliveryDate)>=this.startOfRange&&new Date(r.deliveryDate)<=this.endOfRange);return this.orderList$.next(e),!0}return!1}getOrderListValue(){return this.orderList$.getValue()}isOrderInRange(e){let r=e;return"string"==typeof e&&(r=new Date(e)),r>=this.startOfRange&&r<this.endOfRange}initDate(){const e=this.helperService._getDateRange(new Date);this.startOfRange=e.startOfRange,this.endOfRange=e.endOfRange}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(E.eN),t.LFG(G),t.LFG(P.W),t.LFG(ot.r),t.LFG(rt.ux),t.LFG(Y.x),t.LFG(H.v))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var nt=l(9574),it=l(508);function at(o,i){1&o&&t._UZ(0,"mat-progress-bar",4)}function st(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"mat-option",69),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).autoFillCustomerForm(a)}),t.TgZ(1,"span"),t._uU(2),t.qZA(),t._uU(3," | "),t.TgZ(4,"small"),t._uU(5),t.qZA()()}if(2&o){const e=i.$implicit;t.Q6J("value",e.name),t.xp6(2),t.Oqu(e.name),t.xp6(3),t.hij("Mob. No: ",e.mobile,"")}}function lt(o,i){if(1&o&&(t.TgZ(0,"mat-option",70),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function dt(o,i){if(1&o&&(t.TgZ(0,"mat-option",70),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function mt(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"mat-option",69),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).selectItem(a)}),t._uU(1),t.qZA()}if(2&o){const e=i.$implicit;t.Q6J("value",e.name),t.xp6(1),t.hij(" ",e.name," ")}}function ct(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"No."),t.qZA())}function pt(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=i.index;t.xp6(1),t.hij(" ",e+1," ")}}function ut(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Name"),t.qZA())}function _t(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.Oqu(e.item.name)}}function ht(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Price"),t.qZA())}function gt(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.itemPrice,"USD")," ")}}function ft(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Quantity"),t.qZA())}function Ct(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.Oqu(e.quantity)}}function Tt(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Total Cost"),t.qZA())}function xt(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.quantity*e.itemPrice,"USD")," ")}}function Ot(o,i){1&o&&t._UZ(0,"th",71)}function Zt(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"td",72)(1,"button",73),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).removeItemFromBill(a)}),t.TgZ(2,"mat-icon"),t._uU(3,"close"),t.qZA()()()}}function yt(o,i){1&o&&t._UZ(0,"tr",74)}function vt(o,i){1&o&&t._UZ(0,"tr",75),2&o&&t.ekj("bg-grey",i.even)}function bt(o,i){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw(3);t.xp6(1),t.hij("Max. Usable Points: ",e.maxUsablePoints,"")}}function Dt(o,i){if(1&o&&(t.TgZ(0,"div",76),t.YNc(1,bt,2,1,"span",2),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.maxUsablePoints)}}function It(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Total Amount"),t.qZA())}function At(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.totalAmount,"USD")," ")}}function wt(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Discount"),t.qZA())}function Nt(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.Oqu(e.discount)}}function Ut(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Delivery"),t.qZA())}function St(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" +",t.xi3(2,1,e.deliveryCharges,"USD")," ")}}function Ft(o,i){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Advance"),t.qZA())}function qt(o,i){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.advancePayment,"USD")," ")}}function Rt(o,i){1&o&&(t.TgZ(0,"th",77),t._uU(1," Net Bill Amount "),t.qZA())}function kt(o,i){if(1&o&&(t.TgZ(0,"td",78),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function Pt(o,i){1&o&&t._UZ(0,"tr",74)}function Yt(o,i){1&o&&t._UZ(0,"tr",75)}function Qt(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"mat-dialog-content")(1,"div",5)(2,"div",6)(3,"h4",7),t._uU(4,"Customer Details"),t.qZA(),t.TgZ(5,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().resetCustomerForm()}),t.TgZ(6,"mat-icon",9),t._uU(7,"restart_alt"),t.qZA()(),t.TgZ(8,"form",10)(9,"div",11)(10,"mat-form-field",12)(11,"mat-label"),t._uU(12,"Name"),t.qZA(),t._UZ(13,"input",13),t.TgZ(14,"mat-autocomplete",null,14),t.YNc(16,st,6,3,"mat-option",15),t.ALo(17,"async"),t.qZA()()(),t.TgZ(18,"div",11)(19,"mat-form-field",16)(20,"mat-label"),t._uU(21,"Mobile"),t.qZA(),t._UZ(22,"input",17),t.qZA()(),t.TgZ(23,"div",11)(24,"mat-form-field",12)(25,"mat-label"),t._uU(26,"Address"),t.qZA(),t._UZ(27,"textarea",18),t.qZA()(),t.TgZ(28,"div",11)(29,"mat-form-field",12)(30,"mat-label"),t._uU(31,"Email"),t.qZA(),t._UZ(32,"input",19),t.qZA()(),t.TgZ(33,"div",20)(34,"div",21)(35,"h4"),t._uU(36,"Birthday"),t.qZA(),t.TgZ(37,"mat-form-field",22)(38,"mat-label"),t._uU(39,"Day"),t.qZA(),t._UZ(40,"input",23),t.qZA(),t._UZ(41,"div",24),t.TgZ(42,"mat-form-field",22)(43,"mat-label"),t._uU(44,"Month"),t.qZA(),t.TgZ(45,"mat-select",25),t.YNc(46,lt,2,2,"mat-option",26),t.qZA()()(),t.TgZ(47,"div",27)(48,"h4"),t._uU(49,"Anniversary"),t.qZA(),t.TgZ(50,"mat-form-field",22)(51,"mat-label"),t._uU(52,"Day"),t.qZA(),t._UZ(53,"input",23),t.qZA(),t._UZ(54,"div",24),t.TgZ(55,"mat-form-field",22)(56,"mat-label"),t._uU(57,"Month"),t.qZA(),t.TgZ(58,"mat-select",25),t.YNc(59,dt,2,2,"mat-option",26),t.qZA()()()()()(),t._UZ(60,"div",28),t.TgZ(61,"div",29)(62,"h4",7),t._uU(63,"Items Details"),t.qZA(),t.TgZ(64,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().resetItemForm()}),t.TgZ(65,"mat-icon",30),t._uU(66,"restart_alt"),t.qZA()(),t.TgZ(67,"div")(68,"span",31),t._uU(69,"Choose Item"),t.qZA(),t.TgZ(70,"button",32),t.NdJ("click",function(){return t.CHM(e),t.oxw().clearItemSelection()}),t._uU(71," Clear "),t.qZA()(),t.TgZ(72,"form",10)(73,"div",11)(74,"mat-form-field",33)(75,"mat-label"),t._uU(76,"Item Name"),t.qZA(),t._UZ(77,"input",34),t.TgZ(78,"mat-autocomplete",null,35),t.YNc(80,mt,2,2,"mat-option",15),t.ALo(81,"async"),t.qZA()(),t.TgZ(82,"mat-form-field",33)(83,"mat-label"),t._uU(84,"Quantity"),t.qZA(),t._UZ(85,"input",36),t.qZA(),t.TgZ(86,"button",37),t.NdJ("click",function(){return t.CHM(e),t.oxw().addItemToBill()}),t._uU(87," Add "),t.qZA()()(),t.TgZ(88,"table",38),t.ynx(89,39),t.YNc(90,ct,2,0,"th",40),t.YNc(91,pt,2,1,"td",41),t.BQk(),t.ynx(92,42),t.YNc(93,ut,2,0,"th",40),t.YNc(94,_t,2,1,"td",41),t.BQk(),t.ynx(95,43),t.YNc(96,ht,2,0,"th",40),t.YNc(97,gt,3,4,"td",41),t.BQk(),t.ynx(98,44),t.YNc(99,ft,2,0,"th",40),t.YNc(100,Ct,2,1,"td",41),t.BQk(),t.ynx(101,45),t.YNc(102,Tt,2,0,"th",40),t.YNc(103,xt,3,4,"td",41),t.BQk(),t.ynx(104,46),t.YNc(105,Ot,1,0,"th",40),t.YNc(106,Zt,4,0,"td",41),t.BQk(),t.YNc(107,yt,1,0,"tr",47),t.YNc(108,vt,1,2,"tr",48),t.qZA(),t.TgZ(109,"form",10)(110,"div",49)(111,"mat-form-field",22)(112,"mat-label"),t._uU(113,"Discount"),t.qZA(),t._UZ(114,"input",50),t.qZA(),t.TgZ(115,"mat-form-field",51)(116,"mat-label"),t._uU(117,"Type"),t.qZA(),t.TgZ(118,"mat-select",52),t.NdJ("valueChange",function(n){return t.CHM(e),t.oxw().discountType=n}),t.TgZ(119,"mat-option",53),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(120,"%"),t.qZA(),t.TgZ(121,"mat-option",54),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(122,"Amount"),t.qZA(),t.TgZ(123,"mat-option",55),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(124,"Points"),t.qZA()()(),t.YNc(125,Dt,2,1,"div",56),t.TgZ(126,"mat-form-field",16)(127,"mat-label"),t._uU(128,"Delivery Date & Time"),t.qZA(),t._UZ(129,"input",57),t.qZA()(),t.TgZ(130,"div",58)(131,"mat-form-field",33)(132,"mat-label"),t._uU(133,"Delivery Charges"),t.qZA(),t._UZ(134,"input",59),t.qZA(),t.TgZ(135,"mat-form-field",33)(136,"mat-label"),t._uU(137,"Advance Payment"),t.qZA(),t._UZ(138,"input",60),t.qZA()()(),t.TgZ(139,"table",38),t.ynx(140,61),t.YNc(141,It,2,0,"th",40),t.YNc(142,At,3,4,"td",41),t.BQk(),t.ynx(143,62),t.YNc(144,wt,2,0,"th",40),t.YNc(145,Nt,2,1,"td",41),t.BQk(),t.ynx(146,63),t.YNc(147,Ut,2,0,"th",40),t.YNc(148,St,3,4,"td",41),t.BQk(),t.ynx(149,64),t.YNc(150,Ft,2,0,"th",40),t.YNc(151,qt,3,4,"td",41),t.BQk(),t.ynx(152,65),t.YNc(153,Rt,2,0,"th",66),t.YNc(154,kt,3,4,"td",67),t.BQk(),t.YNc(155,Pt,1,0,"tr",47),t.YNc(156,Yt,1,0,"tr",68),t.qZA()()()()}if(2&o){const e=t.MAs(15),r=t.MAs(79),n=t.oxw();t.xp6(8),t.Q6J("formGroup",n.orderCustomerForm),t.xp6(5),t.Q6J("matAutocomplete",e),t.xp6(3),t.Q6J("ngForOf",t.lcZ(17,20,n.customerList$)),t.xp6(30),t.Q6J("ngForOf",n.MONTHS),t.xp6(13),t.Q6J("ngForOf",n.MONTHS),t.xp6(11),t.Q6J("disabled",!n.enableItemAddButton||!(null!=n.orderItemForm&&n.orderItemForm.valid)),t.xp6(2),t.Q6J("formGroup",n.orderItemForm),t.xp6(5),t.Q6J("matAutocomplete",r),t.xp6(3),t.Q6J("ngForOf",t.lcZ(81,22,n.itemList$)),t.xp6(6),t.Q6J("disabled",!n.enableItemAddButton||!(null!=n.orderItemForm&&n.orderItemForm.valid)),t.xp6(2),t.Q6J("dataSource",n.viewBillItems),t.xp6(19),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(1),t.Q6J("formGroup",n.orderItemForm),t.xp6(9),t.Q6J("value",n.discountType),t.xp6(5),t.Q6J("disabled",!n.selectedCustomerId),t.xp6(2),t.Q6J("ngIf","points"===n.discountType),t.xp6(14),t.Q6J("dataSource",n.billData),t.xp6(16),t.Q6J("matHeaderRowDef",n.billDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.billDisplayedColumns)}}function Mt(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"mat-dialog-actions",79)(1,"button",80),t._uU(2,"Cancel"),t.qZA(),t.TgZ(3,"button",81),t.NdJ("click",function(){return t.CHM(e),t.oxw().executeAction()}),t._uU(4),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("disabled",!e.enableAction()),t.xp6(1),t.hij(" ","Add"===e.formType?"Order":e.formType," ")}}let V=(()=>{class o{constructor(e,r,n,a,d,c,p){this.dialogRef=e,this.helperService=r,this.customerService=n,this.itemService=a,this.orderService=d,this.preferencesService=c,this.orderData=p,this.MONTHS=_.zC,this.viewBillItems=[],this.enableItemAddButton=!1,this.availablePoints=0,this.maxUsablePoints=0,this.iemRemovedFromBill$=new W.x,this.isLoading=!0,this.displayedColumns=["id","name","price","quantity","total","actions"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.subscriptions=new q.w0}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){this.orderData?(this.formType="Update",this.selectedCustomerId=this.orderData.customer._id,this.availablePoints=this.orderData.customer.currentPoints,this.discountType=this.orderData.discountType?this.orderData.discountType:"amount"):(this.formType="Add",this.discountType="amount"),this.isLoading=!0,this.currentPreferences=yield this.preferencesService.getPreferences(),this.isLoading=!1,this.initCustomerForm(),this.initItemForm(),this.initBillItemTable(),this.calculateBillData(),this.customerList$=(0,R.a)([this.customerService.getAllCustomers(),this.orderCustomerForm.get("name").valueChanges.pipe((0,y.O)(""))]).pipe((0,j.U)(([n,a])=>{if(n)return this._customerListFilter(n,a)})),this.itemList$=(0,R.a)([this.itemService.getAllItems(),this.orderItemForm.get("itemName").valueChanges.pipe((0,y.O)(""))]).pipe((0,X.b)(()=>{this.enableItemAddButton=!1,this.selectedItem=null}),(0,j.U)(([n,a])=>{if(n)return this._itemListFilter(n,a)}));const e=(0,R.a)([this.orderItemForm.get("discount").valueChanges.pipe((0,y.O)(0)),this.orderItemForm.get("advancePayment").valueChanges.pipe((0,y.O)(0)),this.orderItemForm.get("deliveryCharges").valueChanges.pipe((0,y.O)(0))]).subscribe(()=>{this.calculateBillData()});this.subscriptions.add(e);const r=this.orderItemForm.get("quantity").valueChanges.pipe((0,y.O)(0)).subscribe(n=>{this.selectedItem&&n&&(this.enableItemAddButton=!0)});this.subscriptions.add(r)})}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}executeAction(){"Add"===this.formType?this.addNewOrder():this.updateOrder()}calculateBillData(){this.billData=[];const e=this.orderData?this.orderData.dollarToPointsMultiplier:this.currentPreferences.dollarToPointsMultiplier;if(this.viewBillItems.length){const r=this.viewBillItems.map(U=>U.itemPrice*U.quantity).reduce((U,Mo)=>U+Mo,0);this.maxUsablePoints=Math.min(Math.floor(r*e),this.availablePoints),"Add"===this.formType&&this.selectedCustomerId&&!this.orderItemForm.get("discount").dirty&&this.currentPreferences.applyAutoDiscount&&this.availablePoints>=e*this.currentPreferences.autoDiscountAmount&&(this.discountType="points",this.orderItemForm.get("discount").setValue(Math.min(this.maxUsablePoints,e*this.currentPreferences.autoDiscountAmount),{emitEvent:!1}),this.orderItemForm.get("discount").markAsDirty());let n=this.orderItemForm.get("discount").value;n=n||0;const a="percentage"===this.discountType?Math.round(n/100*r*100)/100:"points"===this.discountType?Math.round(n/e*100)/100:n;this.orderDiscountPercentage="percentage"===this.discountType?n:"points"===this.discountType?Math.round(n/e/r*1e3)/10:Math.round(n/r*1e3)/10;let d=this.orderItemForm.get("advancePayment").value;d=d||0;let c=this.orderItemForm.get("deliveryCharges").value;c=c||0;const p=r-a+c;this.orderItemForm.get("advancePayment").setValidators(s.kI.max(p)),this.orderItemForm.get("advancePayment").updateValueAndValidity({emitEvent:!1});const M="percentage"===this.discountType?[s.kI.min(0),s.kI.max(100)]:"points"===this.discountType?[s.kI.min(0),s.kI.max(this.maxUsablePoints)]:[s.kI.min(0),s.kI.max(r)];this.orderItemForm.get("discount").setValidators(M),this.orderItemForm.get("discount").updateValueAndValidity({emitEvent:!1}),this.billData.push({totalAmount:r,discount:`-$${a} (${this.orderDiscountPercentage}%)`,billAmount:p,advancePayment:d,deliveryCharges:c})}else this.resetItemFormValidators()}updateBillTable(){this.calculateBillData(),this.billTable.renderRows()}autoFillCustomerForm(e){this.orderCustomerForm.patchValue({name:e.name,mobile:e.mobile,address:e.address,email:e.email}),e.birthday&&this.orderCustomerForm.patchValue({birthday:{day:e.birthday.day,month:e.birthday.month}}),e.anniversary&&this.orderCustomerForm.patchValue({anniversary:{day:e.anniversary.day,month:e.anniversary.month}}),this.selectedCustomerId=e._id,this.availablePoints=e.currentPoints,this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable()}resetCustomerForm(){this.orderCustomerForm.enable(),this.orderCustomerForm.reset(),this.selectedCustomerId=null,this.availablePoints=null,"points"===this.discountType&&(this.discountType="amount"),this.calculateBillData()}selectItem(e){this.selectedItem=this.helperService._clone(e)}addItemToBill(){const e={item:this.selectedItem,itemPrice:this.selectedItem.price,quantity:this.getItemQuantityFromForm()};this.viewBillItems.push(e),this.updateBillTable(),this.enableItemAddButton=!1,this.selectedItem=null,this.orderItemForm.get("itemName").reset(),this.orderItemForm.get("quantity").reset(),this.itemTable.renderRows()}removeItemFromBill(e){this.viewBillItems=this.viewBillItems.filter(r=>r.item._id!==e.item._id),this.itemTable.renderRows(),this.updateBillTable(),this.orderItemForm.get("itemName").updateValueAndValidity()}resetItemForm(){this.orderItemForm.reset({discount:0,advancePayment:0,deliveryCharges:0,deliveryDate:this._getBrowserDateTimeString()}),this.selectedItem=null,this.enableItemAddButton=!1,this.viewBillItems=[],this.billData=[],this.discountType="amount",this.resetItemFormValidators()}clearItemSelection(){this.orderItemForm.get("itemName").reset(),this.orderItemForm.get("quantity").reset(),this.enableItemAddButton=!1,this.selectedItem=null}enableAction(){return this.orderCustomerForm.valid&&(this.orderCustomerForm.dirty||this.orderItemForm.dirty||this.viewBillItems.length!==this.orderData.billItems.length)&&this.viewBillItems.length&&this.billData.length&&!this.enableItemAddButton&&this.orderItemForm.valid}generateNewOrderObject(){return(0,u.mG)(this,void 0,void 0,function*(){const e=this.viewBillItems.map(n=>({item:n.item._id,itemPrice:n.itemPrice,quantity:n.quantity}));return this.selectedCustomerId||(yield this.addNewCustomer()),{customer:this.selectedCustomerId,billItems:e,billAmount:this.billData[0].billAmount,discount:this.orderDiscountPercentage?this.orderDiscountPercentage:0,advancePayment:this.orderItemForm.get("advancePayment").value,deliveryCharges:this.orderItemForm.get("deliveryCharges").value,deliveryDate:new Date(this.orderItemForm.get("deliveryDate").value).toISOString(),paymentCompleted:this.billData[0].advancePayment===this.billData[0].billAmount,pointsUsed:"points"===this.discountType?Math.round(this.orderItemForm.get("discount").value):0,discountType:this.discountType,discountValue:this.orderItemForm.get("discount").value,dollarToPointsMultiplier:this.orderData?this.orderData.dollarToPointsMultiplier:this.currentPreferences.dollarToPointsMultiplier}})}addNewOrder(){return(0,u.mG)(this,void 0,void 0,function*(){const e=yield this.generateNewOrderObject();yield this.orderService.addOrder(e),this.closeDialog()})}updateOrder(){return(0,u.mG)(this,void 0,void 0,function*(){const e=yield this.generateNewOrderObject();yield this.orderService.updateOrder(this.orderData._id,e),this.closeDialog()})}initCustomerForm(){"Add"===this.formType?this.orderCustomerForm=new s.cw({name:new s.NI(null,[s.kI.required.bind(this),k.F]),mobile:new s.NI(null,s.kI.required.bind(this)),address:new s.NI(null),email:new s.NI(null,s.kI.email.bind(this)),birthday:new s.cw({day:new s.NI(null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(null,[s.kI.min(1),s.kI.max(12)])}),anniversary:new s.cw({day:new s.NI(null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(null,[s.kI.min(1),s.kI.max(12)])})}):(this.orderCustomerForm=new s.cw({name:new s.NI(this.orderData.customer.name,[s.kI.required.bind(this),k.F]),mobile:new s.NI(this.orderData.customer.mobile,s.kI.required.bind(this)),address:new s.NI(this.orderData.customer.address),email:new s.NI(this.orderData.customer.email,s.kI.email.bind(this)),birthday:new s.cw({day:new s.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.day:null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.month:null,[s.kI.min(1),s.kI.max(12)])}),anniversary:new s.cw({day:new s.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.day:null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.month:null,[s.kI.min(1),s.kI.max(12)])})}),this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable())}getOrderCustomerFormData(){return this.helperService._clone(this.orderCustomerForm.value)}_customerListFilter(e,r){return r=r||"",e.filter(n=>n.name.toLowerCase().includes(r.toLowerCase()))}addNewCustomer(){return(0,u.mG)(this,void 0,void 0,function*(){const e=this.getOrderCustomerFormData(),r=yield this.customerService.addCustomer(e);this.selectedCustomerId=r._id,this.availablePoints=r.currentPoints})}initItemForm(){this.orderItemForm=new s.cw({itemName:new s.NI(null,k.F),quantity:new s.NI(null,s.kI.min(1))}),this.orderItemForm.addControl("discount",new s.NI(this.orderData?this.orderData.discountValue:0,s.kI.min(0))),this.orderItemForm.addControl("advancePayment",new s.NI(this.orderData?this.orderData.advancePayment:0,s.kI.min(0))),this.orderItemForm.addControl("deliveryCharges",new s.NI(this.orderData?this.orderData.deliveryCharges:0,s.kI.min(0)));const a=this.orderData?this._getBrowserDateTimeString(this.orderData.deliveryDate):this._getBrowserDateTimeString();this.orderItemForm.addControl("deliveryDate",new s.NI(a,s.kI.required.bind(this)))}resetItemFormValidators(){this.orderItemForm.get("advancePayment").setValidators(s.kI.min(0)),this.orderItemForm.get("advancePayment").updateValueAndValidity({emitEvent:!1}),this.orderItemForm.get("discount").setValidators(s.kI.min(0)),this.orderItemForm.get("discount").updateValueAndValidity({emitEvent:!1})}initBillItemTable(){this.orderData&&this.orderData.billItems.forEach(e=>{this.viewBillItems.push({item:e.item,itemPrice:e.itemPrice,quantity:e.quantity})})}getItemQuantityFromForm(){return this.orderItemForm.get("quantity").value}_itemListFilter(e,r){return r=r||"",e.filter(n=>n.name.toLowerCase().includes(r.toLowerCase())&&-1===this.viewBillItems.findIndex(a=>a.item._id===n._id))}_getBrowserDateTimeString(e){let r=new Date;return"string"==typeof e&&(r=new Date(e)),`${r.getFullYear()}-${r.getMonth()+1<10?`0${r.getMonth()+1}`:`${r.getMonth()+1}`}-${r.getDate()<10?`0${r.getDate()}`:`${r.getDate()}`}T${r.getHours()<10?`0${r.getHours()}`:`${r.getHours()}`}:${r.getMinutes()<10?`0${r.getMinutes()}`:`${r.getMinutes()}`}`}closeDialog(){this.dialogRef.close()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.so),t.Y36(P.W),t.Y36(H.v),t.Y36(K.e),t.Y36(Q),t.Y36(nt.y),t.Y36(h.WI))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order-form"]],viewQuery:function(e,r){if(1&e&&(t.Gf(m.BZ,5),t.Gf(m.BZ,5)),2&e){let n;t.iGM(n=t.CRH())&&(r.itemTable=n.first),t.iGM(n=t.CRH())&&(r.billTable=n.first)}},decls:5,vars:4,consts:[["mat-dialog-title",""],["mode","indeterminate","color","accent",4,"ngIf"],[4,"ngIf"],["align","end",4,"ngIf"],["mode","indeterminate","color","accent"],[1,"flex","order-form-container"],[1,"customer-form-container"],[1,"sub-form-heading"],["mat-icon-button","","color","warn",1,"reset-button",3,"click"],["matTooltip","Reset Customer Form"],[3,"formGroup"],[1,"mar-vr-16"],["appearance","fill",1,"full-width"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","name","required","",3,"matAutocomplete"],["autoSuggestCustomers","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["appearance","fill"],["matInput","","type","number","formControlName","mobile","required",""],["matInput","","formControlName","address","placeholder","Ex: #1 Tesla Road, Nikola City"],["matInput","","type","email","placeholder","Ex. nikola@tesla.com","formControlName","email"],[1,"flex-col"],["formGroupName","birthday",1,"occasion-container","mar-right-16"],["appearance","fill",1,"input-small"],["matInput","","type","number","formControlName","day"],[1,"input-separator"],["formControlName","month"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","anniversary",1,"occasion-container"],[1,"separator"],[1,"items-form-container"],["matTooltip","Reset Item Form"],[1,"mar-right-8"],["mat-button","","color","warn","matTooltip","Clear Selected Item",3,"disabled","click"],["appearance","fill",1,"mar-right-16"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","itemName",3,"matAutocomplete"],["autoSuggestItems","matAutocomplete"],["type","number","matInput","","placeholder","Ex: 1","formControlName","quantity"],["mat-raised-button","","color","primary","matTooltip","Add Item To Order",3,"disabled","click"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],[1,"mar-top-32","position-relative"],["type","number","matInput","","placeholder","Ex: 1","formControlName","discount"],["appearance","fill",1,"input-small","mar-right-16"],[3,"value","valueChange"],["value","percentage",3,"click"],["value","amount",3,"click"],["value","points",3,"disabled","click"],["class","input-subtext font-12",4,"ngIf"],["type","datetime-local","matInput","","formControlName","deliveryDate"],[1,"mar-top-16"],["type","number","matInput","","placeholder","Ex: 1","formControlName","deliveryCharges"],["type","number","matInput","","placeholder","Ex: 1","formControlName","advancePayment"],["matColumnDef","totalAmount"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["matColumnDef","billAmount"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"value","click"],[3,"value"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"input-subtext","font-12"],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(e,r){1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.YNc(2,at,1,0,"mat-progress-bar",1),t.YNc(3,Qt,157,24,"mat-dialog-content",2),t.YNc(4,Mt,5,2,"mat-dialog-actions",3)),2&e&&(t.xp6(1),t.hij("",r.formType," Order"),t.xp6(1),t.Q6J("ngIf",r.isLoading),t.xp6(1),t.Q6J("ngIf",!r.isLoading),t.xp6(1),t.Q6J("ngIf",!r.isLoading))},directives:[h.uh,g.O5,Z.pW,h.xY,A.lW,S.Hw,w.gM,s._Y,s.JL,s.sg,T.KE,T.hX,I.Nt,s.Fj,F.ZL,s.JJ,s.u,s.Q7,F.XC,g.sg,it.ey,s.wV,s.x0,B.gD,m.BZ,m.w1,m.fO,m.ge,m.Dz,m.ev,m.as,m.XQ,m.nj,m.Gk,h.H8,h.ZT],pipes:[g.Ov,g.H9],styles:[".customer-form-container[_ngcontent-%COMP%]{flex:.25 1 auto}.items-form-container[_ngcontent-%COMP%]{flex:1}.sub-form-heading[_ngcontent-%COMP%]{display:inline-block}.reset-button[_ngcontent-%COMP%]{float:right}.input-small[_ngcontent-%COMP%]{width:100px}.occasion-container[_ngcontent-%COMP%]{position:relative}.input-separator[_ngcontent-%COMP%]{width:0px;border-right:1px solid rgba(0,0,0,.26);display:inline-block;height:35px;position:absolute;margin-top:8px}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}.input-subtext[_ngcontent-%COMP%]{position:absolute;bottom:-2px}"]}),o})();var Jt=l(7176),Bt=l(1884),$t=l(3601),Lt=l(9849),jt=l(4696),Ht=l(3812);function Et(o,i){if(1&o&&t._UZ(0,"app-order-receipt",4),2&o){const e=t.oxw();t.Q6J("customerData",e.receipt.customer)("shop",e.shop)("receipt",e.receipt)}}let Gt=(()=>{class o{constructor(e,r,n,a){this.receiptService=e,this.shopService=r,this.pdfService=n,this.orderId=a}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){this.shop=yield this.shopService.getCurrentShop(),this.receipt=yield this.receiptService.getReceiptForOrder(this.orderId)})}downloadReport(){return(0,u.mG)(this,void 0,void 0,function*(){const e=Array.from(document.querySelectorAll('[data-id="bill-receipt"]')),r=new Date(this.receipt.deliveryDate),n=`${r.getDate()}_${r.getMonth()}_${r.getFullYear()}`;yield this.pdfService.generatePdf(e,`${this.receipt.customer.name}-${n}`)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(G),t.Y36(Lt.d),t.Y36(jt.F),t.Y36(h.WI))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-print-receipt"]],decls:7,vars:1,consts:[["data-id","bill-receipt",3,"customerData","shop","receipt",4,"ngIf"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary","matTooltip","",3,"click"],["data-id","bill-receipt",3,"customerData","shop","receipt"]],template:function(e,r){1&e&&(t.TgZ(0,"mat-dialog-content"),t.YNc(1,Et,1,3,"app-order-receipt",0),t.qZA(),t.TgZ(2,"mat-dialog-actions",1)(3,"button",2),t._uU(4,"Close"),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return r.downloadReport()}),t._uU(6," Download "),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngIf",r.shop&&r.receipt))},directives:[h.xY,g.O5,Ht.o,h.H8,A.lW,h.ZT,w.gM],styles:[""]}),o})();const Vt=["pendingPaginator"],zt=["pendingSort"],Wt=["soldPaginator"],Xt=["soldSort"];function Kt(o,i){1&o&&(t.TgZ(0,"th",26),t._uU(1,"No."),t.qZA())}function te(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.index;t.oxw();const r=t.MAs(26);t.xp6(1),t.hij(" ",e+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function ee(o,i){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Name"),t.qZA())}function oe(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function re(o,i){1&o&&(t.TgZ(0,"th",26),t._uU(1,"Total Quantity"),t.qZA())}function ne(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function ie(o,i){1&o&&t._UZ(0,"tr",29)}function ae(o,i){1&o&&t._UZ(0,"tr",30),2&o&&t.ekj("bg-grey",i.even)}function se(o,i){1&o&&(t.TgZ(0,"tr",31)(1,"td",32),t._uU(2,"No data found."),t.qZA()())}function le(o,i){1&o&&(t.TgZ(0,"th",26),t._uU(1,"No."),t.qZA())}function de(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.index;t.oxw();const r=t.MAs(53);t.xp6(1),t.hij(" ",e+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function me(o,i){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Name"),t.qZA())}function ce(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function pe(o,i){1&o&&(t.TgZ(0,"th",26),t._uU(1,"Total Quantity"),t.qZA())}function ue(o,i){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function _e(o,i){1&o&&t._UZ(0,"tr",29)}function he(o,i){1&o&&t._UZ(0,"tr",30),2&o&&t.ekj("bg-grey",i.even)}function ge(o,i){1&o&&(t.TgZ(0,"tr",31)(1,"td",32),t._uU(2,"No data found."),t.qZA()())}const z=function(){return[5,10,25,100]};let fe=(()=>{class o{constructor(e){this.orderService=e,this.displayedColumns=["id","name","quantity"],this.pendingDataSource=new m.by([]),this.soldDataSource=new m.by([]),this.subscriptions=new q.w0}ngOnInit(){const e=this.orderService.getOrders().subscribe(r=>{r&&(this.pendingDataSource.data=this.setTableDataSource(r.filter(n=>!n.completed)),this.soldDataSource.data=this.setTableDataSource(r.filter(n=>n.completed)))});this.subscriptions.add(e)}ngAfterViewInit(){this.pendingDataSource.paginator=this.pendingPaginator,this.pendingDataSource.sort=this.pendingSort,this.soldDataSource.paginator=this.soldPaginator,this.soldDataSource.sort=this.soldSort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilterPending(e){this.pendingDataSource.filter=e.target.value.trim().toLowerCase(),this.pendingDataSource.paginator&&this.pendingDataSource.paginator.firstPage()}applyFilterSold(e){this.soldDataSource.filter=e.target.value.trim().toLowerCase(),this.soldDataSource.paginator&&this.soldDataSource.paginator.firstPage()}setTableDataSource(e){const r=new Map,n=[];for(const a of e)for(const d of a.billItems){const c=r.get(d.item.name);c?(c.quantity+=d.quantity,r.set(d.item.name,c)):r.set(d.item.name,{name:d.item.name,quantity:d.quantity})}return r.forEach(a=>{n.push(a)}),n}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Q))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order-total-items"]],viewQuery:function(e,r){if(1&e&&(t.Gf(Vt,5),t.Gf(zt,5),t.Gf(Wt,5),t.Gf(Xt,5)),2&e){let n;t.iGM(n=t.CRH())&&(r.pendingPaginator=n.first),t.iGM(n=t.CRH())&&(r.pendingSort=n.first),t.iGM(n=t.CRH())&&(r.soldPaginator=n.first),t.iGM(n=t.CRH())&&(r.soldSort=n.first)}},decls:54,vars:12,consts:[[1,"total-items","flex"],[1,"flex-1"],[1,"section-container"],[1,"title","mar-bottom-16"],["appearance","outline","color","accent",1,"mar-right-16"],["matInput","","placeholder","Ex. Samosa",3,"keyup"],["inputPending",""],[1,"pending-items-table"],["mat-table","","matSort","",1,"full-width",3,"dataSource"],["pendingSort","matSort"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","quantity"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],["pendingPaginator",""],[1,"hr-section-separator"],["inputSold",""],[1,"sold-items-table"],["soldSort","matSort"],["soldPaginator",""],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4,"Pending Items"),t.qZA(),t.TgZ(5,"mat-form-field",4)(6,"mat-label"),t._uU(7,"Search"),t.qZA(),t.TgZ(8,"input",5,6),t.NdJ("keyup",function(a){return r.applyFilterPending(a)}),t.qZA()(),t.TgZ(10,"div",7)(11,"table",8,9),t.ynx(13,10),t.YNc(14,Kt,2,0,"th",11),t.YNc(15,te,2,1,"td",12),t.BQk(),t.ynx(16,13),t.YNc(17,ee,2,0,"th",14),t.YNc(18,oe,2,1,"td",12),t.BQk(),t.ynx(19,15),t.YNc(20,re,2,0,"th",11),t.YNc(21,ne,2,1,"td",12),t.BQk(),t.YNc(22,ie,1,0,"tr",16),t.YNc(23,ae,1,2,"tr",17),t.YNc(24,se,3,0,"tr",18),t.qZA(),t._UZ(25,"mat-paginator",19,20),t.qZA()()(),t._UZ(27,"div",21),t.TgZ(28,"div",1)(29,"div",2)(30,"div",3),t._uU(31,"Prepared Items"),t.qZA(),t.TgZ(32,"mat-form-field",4)(33,"mat-label"),t._uU(34,"Search"),t.qZA(),t.TgZ(35,"input",5,22),t.NdJ("keyup",function(a){return r.applyFilterSold(a)}),t.qZA()(),t.TgZ(37,"div",23)(38,"table",8,24),t.ynx(40,10),t.YNc(41,le,2,0,"th",11),t.YNc(42,de,2,1,"td",12),t.BQk(),t.ynx(43,13),t.YNc(44,me,2,0,"th",14),t.YNc(45,ce,2,1,"td",12),t.BQk(),t.ynx(46,15),t.YNc(47,pe,2,0,"th",11),t.YNc(48,ue,2,1,"td",12),t.BQk(),t.YNc(49,_e,1,0,"tr",16),t.YNc(50,he,1,2,"tr",17),t.YNc(51,ge,3,0,"tr",18),t.qZA(),t._UZ(52,"mat-paginator",19,25),t.qZA()()()()),2&e&&(t.xp6(11),t.Q6J("dataSource",r.pendingDataSource),t.xp6(11),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(10,z)),t.xp6(13),t.Q6J("dataSource",r.soldDataSource),t.xp6(11),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(11,z)))},directives:[T.KE,T.hX,I.Nt,m.BZ,O.YE,m.w1,m.fO,m.ge,m.Dz,m.ev,O.nU,m.as,m.XQ,m.nj,m.Gk,m.Ee,D.NW],styles:[".title[_ngcontent-%COMP%]{font-weight:500}"]}),o})();function Ce(o,i){if(1&o&&(t.TgZ(0,"div",16)(1,"span",18),t._uU(2),t.ALo(3,"currency"),t.qZA(),t.TgZ(4,"span",18),t._uU(5),t.ALo(6,"currency"),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.hij("Filtered Revenue: ",t.xi3(3,2,e.filteredRevenue,"USD"),""),t.xp6(3),t.hij("Filtered Booking Amount: ",t.xi3(6,5,e.filteredBookingAmount,"USD"),"")}}function Te(o,i){1&o&&(t.TgZ(0,"mat-icon",50),t._uU(1,"unfold_more"),t.qZA())}function xe(o,i){1&o&&(t.TgZ(0,"mat-icon",51),t._uU(1,"unfold_less"),t.qZA())}function Oe(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"No."),t.qZA())}function Ze(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=i.dataIndex,r=t.oxw();t.xp6(1),t.hij(" ",e+1+(null==r.paginator?null:r.paginator.pageIndex)*(null==r.paginator?null:r.paginator.pageSize)," ")}}function ye(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Customer Name"),t.qZA())}function ve(o,i){1&o&&(t.TgZ(0,"mat-icon",56),t._uU(1,"label_important"),t.qZA())}function be(o,i){if(1&o&&(t.TgZ(0,"td",54),t._uU(1),t.YNc(2,ve,2,0,"mat-icon",55),t.qZA()),2&o){const e=i.$implicit,r=t.oxw();t.xp6(1),t.hij(" ",e.customer.name," "),t.xp6(1),t.Q6J("ngIf",r.isCustomerOccasion(e.customer.birthday)||r.isCustomerOccasion(e.customer.anniversary))}}function De(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Items"),t.qZA())}function Ie(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"+ 1 other"),t.qZA())}function Ae(o,i){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij("+ ",e.billItems.length-1," others")}}function we(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.YNc(2,Ie,2,0,"span",47),t.YNc(3,Ae,2,1,"span",47),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.billItems[0].item.name," "),t.xp6(1),t.Q6J("ngIf",2===e.billItems.length),t.xp6(1),t.Q6J("ngIf",e.billItems.length>2)}}function Ne(o,i){1&o&&(t.TgZ(0,"th",57),t._uU(1," Net Amount "),t.qZA())}function Ue(o,i){if(1&o&&(t.TgZ(0,"td",58),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function Se(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Created At"),t.qZA())}function Fe(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.createdAt,"MMM d, hh:mm a")," ")}}function qe(o,i){1&o&&(t.TgZ(0,"th",59),t._uU(1," Delivery By "),t.qZA())}function Re(o,i){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.deliveryDate,"MMM d, hh:mm a")," ")}}function ke(o,i){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.deliveryDate,"shortTime")," ")}}function Pe(o,i){if(1&o&&(t.TgZ(0,"td",53),t.YNc(1,Re,3,4,"span",47),t.YNc(2,ke,3,4,"span",47),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.orderDateRange.value.end),t.xp6(1),t.Q6J("ngIf",!e.orderDateRange.value.end)}}function Ye(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Status"),t.qZA())}function Qe(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"Finished"),t.qZA())}function Me(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"Payment Pending"),t.qZA())}function Je(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"Preperation Pending"),t.qZA())}function Be(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"Pending"),t.qZA())}function $e(o,i){1&o&&(t.TgZ(0,"span"),t._uU(1,"Overdue"),t.qZA())}function Le(o,i){if(1&o&&(t.TgZ(0,"td",53),t.YNc(1,Qe,2,0,"span",47),t.YNc(2,Me,2,0,"span",47),t.YNc(3,Je,2,0,"span",47),t.YNc(4,Be,2,0,"span",47),t.YNc(5,$e,2,0,"span",47),t.qZA()),2&o){const e=i.$implicit,r=t.oxw();t.xp6(1),t.Q6J("ngIf",e.completed&&e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",e.completed&&!e.paymentCompleted&&!r.isOrderOverdue(e.deliveryDate)),t.xp6(1),t.Q6J("ngIf",!e.completed&&e.paymentCompleted&&!r.isOrderOverdue(e.deliveryDate)),t.xp6(1),t.Q6J("ngIf",!e.completed&&!e.paymentCompleted&&!r.isOrderOverdue(e.deliveryDate)),t.xp6(1),t.Q6J("ngIf",(!e.completed||!e.paymentCompleted)&&r.isOrderOverdue(e.deliveryDate))}}function je(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Actions"),t.qZA())}function He(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",66),t.NdJ("click",function(n){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().completeOrder(a),n.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"playlist_add_check"),t.qZA()()}}function Ee(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",67),t.NdJ("click",function(n){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().paymentCompleteOrder(a),n.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"price_check"),t.qZA()()}}function Ge(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",68),t.NdJ("click",function(n){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().updateOrder(a),n.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function Ve(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",69),t.NdJ("click",function(n){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().deleteOrder(a),n.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA()()}}function ze(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",70),t.NdJ("click",function(n){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().getReceipt(a._id),n.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"receipt"),t.qZA()()}}function We(o,i){if(1&o&&(t.TgZ(0,"td",53)(1,"div",60),t.YNc(2,He,3,0,"button",61),t.YNc(3,Ee,3,0,"button",62),t.YNc(4,Ge,3,0,"button",63),t.YNc(5,Ve,3,0,"button",64),t.YNc(6,ze,3,0,"button",65),t.qZA()()),2&o){const e=i.$implicit;t.xp6(2),t.Q6J("ngIf",!e.completed),t.xp6(1),t.Q6J("ngIf",!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed||!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed||!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",e.completed&&e.paymentCompleted)}}function Xe(o,i){if(1&o&&(t.TgZ(0,"mat-card-header")(1,"div",73)(2,"a",91)(3,"mat-icon"),t._uU(4,"location_on"),t.qZA()()(),t.TgZ(5,"mat-card-title",74),t._uU(6),t.qZA(),t.TgZ(7,"mat-card-subtitle",75),t._uU(8,"Address"),t.qZA()()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("href","https://www.google.com/maps/place/"+e.customer.address,t.LSH),t.xp6(4),t.hij("",e.customer.address," ")}}function Ke(o,i){if(1&o&&(t.TgZ(0,"mat-card-header")(1,"div",73)(2,"mat-icon"),t._uU(3,"alternate_email"),t.qZA()(),t.TgZ(4,"mat-card-title",74),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",75),t._uU(7,"Email"),t.qZA()()),2&o){const e=t.oxw().$implicit;t.xp6(5),t.hij("",e.customer.email," ")}}function to(o,i){if(1&o&&(t.TgZ(0,"mat-card-header")(1,"div",73)(2,"mat-icon"),t._uU(3,"cake"),t.qZA()(),t.TgZ(4,"mat-card-title",74),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",75),t._uU(7,"Birthday"),t.qZA()()),2&o){const e=t.oxw().$implicit,r=t.oxw();t.xp6(5),t.hij("",r.getDateString(e.customer.birthday)," ")}}function eo(o,i){if(1&o&&(t.TgZ(0,"mat-card-header")(1,"div",73)(2,"mat-icon"),t._uU(3,"celebration"),t.qZA()(),t.TgZ(4,"mat-card-title",74),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",75),t._uU(7,"Anniversary"),t.qZA()()),2&o){const e=t.oxw().$implicit,r=t.oxw();t.xp6(5),t.hij("",r.getDateString(e.customer.anniversary)," ")}}function oo(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"No."),t.qZA())}function ro(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=i.index;t.xp6(1),t.hij(" ",e+1," ")}}function no(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Name"),t.qZA())}function io(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.item.name," ")}}function ao(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Price"),t.qZA())}function so(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.itemPrice,"USD")," ")}}function lo(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Quantity"),t.qZA())}function mo(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function co(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Total Cost"),t.qZA())}function po(o,i){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.quantity*e.itemPrice,"USD")," ")}}function uo(o,i){1&o&&t._UZ(0,"tr",92)}function _o(o,i){1&o&&t._UZ(0,"tr",93),2&o&&t.ekj("bg-grey",i.even)}function ho(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Total Amount"),t.qZA())}function go(o,i){if(1&o&&(t.TgZ(0,"td",94),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,100*(e.billAmount-e.deliveryCharges)/(100-e.discount),"USD")," ")}}function fo(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Discount"),t.qZA())}function Co(o,i){if(1&o&&(t.TgZ(0,"td",94),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.discount*(e.billAmount-e.deliveryCharges)/(100-e.discount),"USD")," ")}}function To(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Delivery"),t.qZA())}function xo(o,i){if(1&o&&(t.TgZ(0,"td",94),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" +",t.xi3(2,1,e.deliveryCharges,"USD")," ")}}function Oo(o,i){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Advance"),t.qZA())}function Zo(o,i){if(1&o&&(t.TgZ(0,"td",94),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.advancePayment,"USD")," ")}}function yo(o,i){1&o&&(t.TgZ(0,"th",95),t._uU(1," Net Bill Amount "),t.qZA())}function vo(o,i){if(1&o&&(t.TgZ(0,"td",96),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function bo(o,i){1&o&&t._UZ(0,"tr",92)}function Do(o,i){1&o&&t._UZ(0,"tr",93)}const Io=function(o){return[o]};function Ao(o,i){if(1&o&&(t.TgZ(0,"td",53)(1,"div",71)(2,"mat-card",72)(3,"mat-card-header")(4,"div",73)(5,"mat-icon"),t._uU(6,"face"),t.qZA()(),t.TgZ(7,"mat-card-title",74),t._uU(8),t.qZA(),t.TgZ(9,"mat-card-subtitle",75),t._uU(10,"Name"),t.qZA()(),t.YNc(11,Xe,9,2,"mat-card-header",47),t.TgZ(12,"mat-card-header")(13,"div",73)(14,"mat-icon"),t._uU(15,"smartphone"),t.qZA()(),t.TgZ(16,"mat-card-title",74),t._uU(17),t.qZA(),t.TgZ(18,"mat-card-subtitle",75),t._uU(19,"Mobile"),t.qZA()(),t.YNc(20,Ke,8,1,"mat-card-header",47),t.YNc(21,to,8,1,"mat-card-header",47),t.YNc(22,eo,8,1,"mat-card-header",47),t.qZA(),t.TgZ(23,"mat-card",76)(24,"mat-card-content")(25,"table",77),t.ynx(26,27),t.YNc(27,oo,2,0,"th",28),t.YNc(28,ro,2,1,"td",29),t.BQk(),t.ynx(29,78),t.YNc(30,no,2,0,"th",28),t.YNc(31,io,2,1,"td",29),t.BQk(),t.ynx(32,79),t.YNc(33,ao,2,0,"th",28),t.YNc(34,so,3,4,"td",29),t.BQk(),t.ynx(35,80),t.YNc(36,lo,2,0,"th",28),t.YNc(37,mo,2,1,"td",29),t.BQk(),t.ynx(38,81),t.YNc(39,co,2,0,"th",28),t.YNc(40,po,3,4,"td",29),t.BQk(),t.YNc(41,uo,1,0,"tr",42),t.YNc(42,_o,1,2,"tr",82),t.qZA(),t.TgZ(43,"table",77),t.ynx(44,83),t.YNc(45,ho,2,0,"th",28),t.YNc(46,go,3,4,"td",84),t.BQk(),t.ynx(47,85),t.YNc(48,fo,2,0,"th",28),t.YNc(49,Co,3,4,"td",84),t.BQk(),t.ynx(50,86),t.YNc(51,To,2,0,"th",28),t.YNc(52,xo,3,4,"td",84),t.BQk(),t.ynx(53,87),t.YNc(54,Oo,2,0,"th",28),t.YNc(55,Zo,3,4,"td",84),t.BQk(),t.ynx(56,33),t.YNc(57,yo,2,0,"th",88),t.YNc(58,vo,3,4,"td",89),t.BQk(),t.YNc(59,bo,1,0,"tr",42),t.YNc(60,Do,1,0,"tr",90),t.qZA()()()()()),2&o){const e=i.$implicit,r=t.oxw();t.uIk("colspan",r.displayedColumns.length),t.xp6(1),t.Q6J("@detailExpand",r.checkExpanded(e._id)?"expanded":"collapsed"),t.xp6(7),t.hij("",e.customer.name," "),t.xp6(3),t.Q6J("ngIf",e.customer.address),t.xp6(6),t.hij("",e.customer.mobile," "),t.xp6(3),t.Q6J("ngIf",e.customer.email),t.xp6(1),t.Q6J("ngIf",e.customer.birthday),t.xp6(1),t.Q6J("ngIf",e.customer.anniversary),t.xp6(3),t.Q6J("dataSource",e.billItems),t.xp6(16),t.Q6J("matHeaderRowDef",r.itemDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.itemDisplayedColumns),t.xp6(1),t.Q6J("dataSource",t.VKq(14,Io,e)),t.xp6(16),t.Q6J("matHeaderRowDef",r.billDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.billDisplayedColumns)}}function wo(o,i){1&o&&t._UZ(0,"tr",92)}function No(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"tr",97),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().toggleRowExpand(a._id)}),t.qZA()}if(2&o){const e=i.$implicit,r=t.oxw();t.ekj("order-expanded-row",r.checkExpanded(e._id))("order-completed-row",e.completed&&e.paymentCompleted)("order-time-warning-row",!(e.completed&&e.paymentCompleted)&&r.isOrderTimeWarning(e.deliveryDate))("order-overdue-warning-row",!(e.completed&&e.paymentCompleted)&&r.isOrderOverdue(e.deliveryDate))}}function Uo(o,i){1&o&&t._UZ(0,"tr",98)}function So(o,i){1&o&&(t.TgZ(0,"tr",99)(1,"td",100),t._uU(2,"No data found."),t.qZA()())}function Fo(o,i){1&o&&t._UZ(0,"app-order-total-items")}const qo=function(){return["expandedDetail"]},Ro=function(){return[5,10,25,100]},ko=[{path:"",component:(()=>{class o{constructor(e,r,n){this.orderService=e,this.dialogService=r,this.helperService=n,this.displayedColumns=["id","customerName","items","billAmount","timeCreated","deliveryDate","status","actions"],this.itemDisplayedColumns=["id","name","price","quantity","total"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.dataSource=new m.by([]),this.expandedOrderRows=[],this.allOrdersList=[],this.isShowPaidOrders=!0,this.isShowPreparedOrders=!0,this.isShowFinishedOrders=!0,this.totalRevenue=0,this.totalItemsSold=0,this.totalBookingAmount=0,this.filteredRevenue=0,this.filteredBookingAmount=0,this.showFilterSummary=!1,this.subscriptions=new q.w0}ngOnInit(){this.setDataSourceFilter();const e=this.orderService.getOrders().subscribe(n=>{n&&(this.allOrdersList=this.helperService._clone(n),this.updateDataSource(),this.updateOrderSummary())});this.initDateRange();const r=this.orderDateRange.valueChanges.pipe((0,Bt.x)(this.isDateSame.bind(this)),(0,$t.e)(1e3)).subscribe(n=>{n.end&&n.start.getTime()!==n.end.getTime()?this.orderService.updateOrderDateRange(n.start,n.end):this.orderService.updateOrderDateRange(n.start)});this.subscriptions.add(e),this.subscriptions.add(r)}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilter(e){const r=e.target.value;this.dataSource.filter=r.trim().toLowerCase(),""!==r.trim()?(this.updateFilterSummary(),this.showFilterSummary=!0):this.showFilterSummary=!1,this.dataSource.paginator&&this.dataSource.paginator.firstPage()}checkExpanded(e){return this.expandedOrderRows.includes(e)}toggleRowExpand(e){const r=this.expandedOrderRows.indexOf(e);-1===r?this.expandedOrderRows.push(e):this.expandedOrderRows.splice(r,1)}toggleAllRowsExpand(){this.expandedOrderRows=this.expandedOrderRows.length?[]:this.allOrdersList.map(e=>e._id)}addOrder(){this.dialogService.openDialog(V,_.ib.order)}updateOrder(e){this.dialogService.openDialog(V,Object.assign(Object.assign({},_.ib.order),{data:e}))}completeOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(e._id,{completed:!0})})}paymentCompleteOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(e._id,{paymentCompleted:!0})})}deleteOrder(e){return(0,u.mG)(this,void 0,void 0,function*(){const n=this.dialogService.openDialog(Jt.z,Object.assign(Object.assign({},_.ib.confirmationDialog),{data:{type:"warning",action:"delete",entity:"order"}}));(yield(0,b.n)(n.afterClosed()))&&(yield this.orderService.deleteOrder(e._id))})}isOrderTimeWarning(e){const r=(new Date).getTime(),n=new Date(e).getTime();return n>=r&&n-r<=18e5}isOrderOverdue(e){const r=(new Date).getTime();return new Date(e).getTime()<=r}isCustomerOccasion(e){if(e){const r=new Date;return r.getDate()===e.day&&r.getMonth()+1===e.month}}getDateString(e){if(e)return`${_.zC.find(r=>r.value===e.month).name}, ${e.day}`}togglePaidOrders(){this.isShowPaidOrders=!this.isShowPaidOrders,this.updateDataSource()}togglePreparedOrders(){this.isShowPreparedOrders=!this.isShowPreparedOrders,this.updateDataSource()}toggleFinishedOrders(){this.isShowFinishedOrders=!this.isShowFinishedOrders,this.updateDataSource()}getNumberOfOrders(e){return e?this.allOrdersList.filter(r=>r.completed&&r.paymentCompleted).length:this.allOrdersList.filter(r=>!(r.completed&&r.paymentCompleted)).length}gotToAdjacentDay(e){const r=this.orderDateRange.get("start").value;let n;"next"===e?(n=new Date(r.getTime()),n.setDate(n.getDate()+1)):(n=new Date(r.getTime()),n.setDate(n.getDate()-1)),this.orderDateRange.get("start").patchValue(n)}getReceipt(e){this.dialogService.openDialog(Gt,Object.assign(Object.assign({},_.ib.customerPurchaseDetails),{data:e}))}initDateRange(){const e=this.orderService.getCurrentDateRange();this.orderDateRange=new s.cw({start:new s.NI(e.startDate),end:new s.NI(e.endDate)})}updateDataSource(){if(this.allOrdersList.length){let e;!this.isShowPaidOrders&&this.isShowPreparedOrders?e=this.allOrdersList.filter(r=>!r.paymentCompleted):this.isShowPaidOrders&&!this.isShowPreparedOrders?e=this.allOrdersList.filter(r=>!r.completed):this.isShowPaidOrders||this.isShowPreparedOrders?this.isShowPaidOrders&&this.isShowPreparedOrders&&(e=this.isShowFinishedOrders?this.helperService._clone(this.allOrdersList):this.allOrdersList.filter(r=>!(r.completed&&r.paymentCompleted))):e=this.allOrdersList.filter(r=>!r.completed&&!r.paymentCompleted),this.dataSource.data=e}else this.dataSource.data=[]}setDataSourceFilter(){this.dataSource.filterPredicate=(e,r)=>{const n=r.toLowerCase(),a=e.billItems.map(c=>c.item.name).join(" ").toLowerCase();return`${e.customer.name.toLowerCase()} ${a}`.includes(n)}}updateOrderSummary(){const e=this.allOrdersList.filter(a=>a.completed&&a.paymentCompleted);let r=0,n=0;for(const a of e){for(const d of a.billItems)r+=d.quantity;n+=a.billAmount}this.totalRevenue=n,this.totalItemsSold=r,this.totalBookingAmount=this.allOrdersList.filter(a=>!(a.completed&&a.paymentCompleted)).reduce((a,d)=>a+d.billAmount,0)}updateFilterSummary(){this.filteredRevenue=this.dataSource.filteredData.filter(e=>e.completed&&e.paymentCompleted).reduce((e,r)=>e+r.billAmount,0),this.filteredBookingAmount=this.dataSource.filteredData.filter(e=>!(e.completed&&e.paymentCompleted)).reduce((e,r)=>e+r.billAmount,0)}isDateSame(e,r){return e.start===r.start&&e.end===r.end}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Q),t.Y36(Y.x),t.Y36(P.W))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-orders"]],viewQuery:function(e,r){if(1&e&&(t.Gf(D.NW,5),t.Gf(O.YE,5)),2&e){let n;t.iGM(n=t.CRH())&&(r.paginator=n.first),t.iGM(n=t.CRH())&&(r.sort=n.first)}},decls:89,vars:31,consts:[[1,"order-container"],[1,"section-container","mar-bottom-32"],[1,"orders","mar-bottom-8"],["appearance","outline","color","accent",1,"mar-right-16"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],["mat-button","","matDateRangePickerCancel",""],["mat-raised-button","","color","primary","matDateRangePickerApply",""],["matInput","","placeholder","Ex. Nikola Tesla",3,"keyup"],["input",""],["class","order-summary mar-bottom-16",4,"ngIf"],["color","accent",1,"orders-toggle",3,"checked","click"],["color","accent",1,"orders-toggle","mar-right-16",3,"checked","click"],[1,"order-summary","mar-bottom-16"],[1,"mar-right-16","order-info"],[1,"mar-right-16"],["mat-icon-button","","color","accent",3,"click"],["matTooltip","Expand Rows",4,"ngIf"],["matTooltip","Collapse Rows",4,"ngIf"],["mat-icon-button","","color","accent",3,"disabled","click"],["matTooltip","Previous Day",1,"font-48"],["matTooltip","Next Day",1,"font-48"],[1,"orders-table"],["mat-table","","matSort","","multiTemplateDataRows","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","customerName"],["mat-cell","","class","order-customer-name",4,"matCellDef"],["matColumnDef","items"],["matColumnDef","billAmount"],["mat-header-cell","","mat-sort-header","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["matColumnDef","timeCreated"],["matColumnDef","deliveryDate"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","order-row",3,"order-expanded-row","order-completed-row","order-time-warning-row","order-overdue-warning-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","order-detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],[4,"ngIf"],["mat-fab","","color","accent",1,"menu-button",3,"click"],["matTooltip","Add New"],["matTooltip","Expand Rows"],["matTooltip","Collapse Rows"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"order-customer-name"],["color","accent","class","order-customer-occasion pad-left-8",4,"ngIf"],["color","accent",1,"order-customer-occasion","pad-left-8"],["mat-header-cell","","mat-sort-header","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"],["mat-header-cell","","mat-sort-header",""],[1,"flex"],["mat-icon-button","","matTooltip","Complete Preperation",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Receipt",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Complete Preperation",3,"click"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-icon-button","","color","primary","matTooltip","Receipt",3,"click"],[1,"order-expanded-detail-row"],[1,"customer-card","mar-16"],["mat-card-avatar",""],[1,"font-14","font-weight-400"],[1,"font-12"],[1,"item-card","mar-16"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],["matColumnDef","totalAmount"],["mat-cell","","class","total-table-cell",4,"matCellDef"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","total-table-cell net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["target","_blank",1,"direction-icon",3,"href"],["mat-header-row",""],["mat-row",""],["mat-cell","",1,"total-table-cell"],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"total-table-cell","net-bill-column"],["mat-row","",1,"order-row",3,"click"],["mat-row","",1,"order-detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,r){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-form-field",3)(4,"mat-label"),t._uU(5,"Enter a date range"),t.qZA(),t.TgZ(6,"mat-date-range-input",4),t._UZ(7,"input",5)(8,"input",6),t.qZA(),t._UZ(9,"mat-datepicker-toggle",7),t.TgZ(10,"mat-date-range-picker",null,8)(12,"mat-date-range-picker-actions")(13,"button",9),t._uU(14,"Cancel"),t.qZA(),t.TgZ(15,"button",10),t._uU(16," Apply "),t.qZA()()()(),t.TgZ(17,"mat-form-field",3)(18,"mat-label"),t._uU(19,"Search Orders"),t.qZA(),t.TgZ(20,"input",11,12),t.NdJ("keyup",function(a){return r.applyFilter(a)}),t.qZA()(),t.YNc(22,Ce,7,8,"div",13),t.TgZ(23,"mat-slide-toggle",14),t.NdJ("click",function(){return r.toggleFinishedOrders()}),t._uU(24," Show Finished Orders "),t.qZA(),t.TgZ(25,"mat-slide-toggle",15),t.NdJ("click",function(){return r.togglePreparedOrders()}),t._uU(26," Show Prepared Orders "),t.qZA(),t.TgZ(27,"mat-slide-toggle",15),t.NdJ("click",function(){return r.togglePaidOrders()}),t._uU(28," Show Paid Orders "),t.qZA(),t.TgZ(29,"div")(30,"div",16)(31,"span",17),t._uU(32),t.qZA(),t.TgZ(33,"span",18),t._uU(34),t.qZA(),t.TgZ(35,"span",18),t._uU(36),t.qZA(),t.TgZ(37,"span",18),t._uU(38),t.ALo(39,"currency"),t.qZA(),t.TgZ(40,"span",18),t._uU(41),t.ALo(42,"currency"),t.qZA()(),t.TgZ(43,"button",19),t.NdJ("click",function(){return r.toggleAllRowsExpand()}),t.YNc(44,Te,2,0,"mat-icon",20),t.YNc(45,xe,2,0,"mat-icon",21),t.qZA(),t.TgZ(46,"button",22),t.NdJ("click",function(){return r.gotToAdjacentDay("previous")}),t.TgZ(47,"mat-icon",23),t._uU(48,"arrow_left"),t.qZA()(),t.TgZ(49,"button",22),t.NdJ("click",function(){return r.gotToAdjacentDay("next")}),t.TgZ(50,"mat-icon",24),t._uU(51,"arrow_right"),t.qZA()()(),t.TgZ(52,"div",25)(53,"table",26),t.ynx(54,27),t.YNc(55,Oe,2,0,"th",28),t.YNc(56,Ze,2,1,"td",29),t.BQk(),t.ynx(57,30),t.YNc(58,ye,2,0,"th",28),t.YNc(59,be,3,2,"td",31),t.BQk(),t.ynx(60,32),t.YNc(61,De,2,0,"th",28),t.YNc(62,we,4,3,"td",29),t.BQk(),t.ynx(63,33),t.YNc(64,Ne,2,0,"th",34),t.YNc(65,Ue,3,4,"td",35),t.BQk(),t.ynx(66,36),t.YNc(67,Se,2,0,"th",28),t.YNc(68,Fe,3,4,"td",29),t.BQk(),t.ynx(69,37),t.YNc(70,qe,2,0,"th",38),t.YNc(71,Pe,3,2,"td",29),t.BQk(),t.ynx(72,39),t.YNc(73,Ye,2,0,"th",28),t.YNc(74,Le,6,5,"td",29),t.BQk(),t.ynx(75,40),t.YNc(76,je,2,0,"th",28),t.YNc(77,We,7,5,"td",29),t.BQk(),t.ynx(78,41),t.YNc(79,Ao,61,16,"td",29),t.BQk(),t.YNc(80,wo,1,0,"tr",42),t.YNc(81,No,1,8,"tr",43),t.YNc(82,Uo,1,0,"tr",44),t.YNc(83,So,3,0,"tr",45),t.qZA(),t._UZ(84,"mat-paginator",46),t.qZA()()(),t.YNc(85,Fo,1,0,"app-order-total-items",47),t.qZA(),t.TgZ(86,"button",48),t.NdJ("click",function(){return r.addOrder()}),t.TgZ(87,"mat-icon",49),t._uU(88,"receipt"),t.qZA()()),2&e){const n=t.MAs(11);t.xp6(6),t.Q6J("formGroup",r.orderDateRange)("rangePicker",n),t.xp6(3),t.Q6J("for",n),t.xp6(13),t.Q6J("ngIf",r.showFilterSummary),t.xp6(1),t.Q6J("checked",!0),t.xp6(2),t.Q6J("checked",!0),t.xp6(2),t.Q6J("checked",!0),t.xp6(5),t.hij("Pending Orders: ",r.getNumberOfOrders(!1),""),t.xp6(2),t.hij("Completed Orders: ",r.getNumberOfOrders(!0),""),t.xp6(2),t.hij("Total Items Sold: ",r.totalItemsSold,""),t.xp6(2),t.hij("Total Revenue: ",t.xi3(39,23,r.totalRevenue,"USD"),""),t.xp6(3),t.hij("Total Booking Amount: ",t.xi3(42,26,r.totalBookingAmount,"USD"),""),t.xp6(3),t.Q6J("ngIf",!r.expandedOrderRows.length),t.xp6(1),t.Q6J("ngIf",r.expandedOrderRows.length),t.xp6(1),t.Q6J("disabled",r.orderDateRange.value.end),t.xp6(3),t.Q6J("disabled",r.orderDateRange.value.end),t.xp6(4),t.Q6J("dataSource",r.dataSource),t.xp6(27),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(29,qo)),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(30,Ro)),t.xp6(1),t.Q6J("ngIf",r.allOrdersList.length)}},directives:[T.KE,T.hX,f.wx,s.JL,s.sg,f.zY,s.Fj,s.JJ,s.u,f.By,f.nW,T.R9,f._g,f.M5,A.lW,f.dp,f.DK,I.Nt,g.O5,$.Rr,S.Hw,w.gM,m.BZ,O.YE,m.w1,m.fO,m.ge,m.Dz,m.ev,O.nU,x.a8,x.dk,x.kc,x.n5,x.$j,x.dn,m.as,m.XQ,m.nj,m.Gk,m.Ee,D.NW,fe],pipes:[g.H9,g.uU],styles:["tr.order-detail-row[_ngcontent-%COMP%]{height:0}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):hover{background:whitesmoke}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):active{background:#efefef}.order-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.order-expanded-detail-row[_ngcontent-%COMP%]{overflow:hidden;display:flex}.order-completed-row[_ngcontent-%COMP%]{background-color:#00ff0040!important}.order-time-warning-row[_ngcontent-%COMP%]{background-color:#ff910040!important}.order-overdue-warning-row[_ngcontent-%COMP%]{background-color:#ff000040!important}.order-customer-name[_ngcontent-%COMP%]{position:relative}.order-customer-name[_ngcontent-%COMP%]   .order-customer-occasion[_ngcontent-%COMP%]{position:absolute;top:10px}.row-expand-toggle[_ngcontent-%COMP%]{float:right;margin-right:16px!important}.customer-card[_ngcontent-%COMP%]{max-width:400px;height:-moz-fit-content;height:fit-content;border:1px solid grey}.item-card[_ngcontent-%COMP%]{flex-grow:.5;border:1px solid grey}.total-table-cell[_ngcontent-%COMP%]{border-top:1px solid black;border-bottom:1px solid black}.direction-icon[_ngcontent-%COMP%]{text-decoration:none;color:initial}.orders-toggle[_ngcontent-%COMP%]{float:right}.order-info[_ngcontent-%COMP%]{font-weight:500}.order-summary[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);border-radius:5px;padding:8px;width:-moz-fit-content;width:fit-content;display:inline-block}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}"],data:{animation:[(0,C.X$)("detailExpand",[(0,C.SB)("collapsed, void",(0,C.oB)({height:"0px",minHeight:"0"})),(0,C.SB)("expanded",(0,C.oB)({height:"*"})),(0,C.eR)("expanded <=> collapsed",(0,C.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)")),(0,C.eR)("expanded <=> void",(0,C.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),o})()},{path:"**",redirectTo:"",pathMatch:"full"}];let Po=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[L.Bz.forChild(ko)],L.Bz]}),o})();var Yo=l(8553);let Qo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[g.ez,Po,Yo.m,s.UX,T.lN,m.p0,S.Ps,D.TU,I.c,A.ot,O.JX,F.Bb,f.FA,x.QW,B.LD,$.rP,w.AV,h.Is,Z.Cv]]}),o})()}}]);