"use strict";(self.webpackChunkbillit=self.webpackChunkbillit||[]).push([[430],{8430:(Fo,Q,l)=>{l.r(Q),l.d(Q,{OrdersModule:()=>Uo});var f=l(8583),s=l(3679),Z=l(8295),m=l(2789),I=l(6627),A=l(9692),b=l(9983),w=l(1095),x=l(1494),q=l(5781),h=l(3220),T=l(3738),B=l(7441),J=l(5396),N=l(1436),C=l(2238),y=l(2178),M=l(4655),p=l(4762),g=l(7238),V=l(9765),U=l(5319),S=l(739),O=l(9761),$=l(8002),z=l(3342),F=l(7165),_=l(9670),t=l(7716),k=l(4416),L=l(3208),W=l(7672),P=l(8312),v=l(9067),X=l(6215),K=l(4885),j=l(1841);let tt=(()=>{class o{constructor(e){this.http=e}generateReceiptForOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){yield this.http.post(`${P.a.receiptForOrderUrl}/${e}`,null,{params:{shopId:v.cQ.storageHelper.shopId}}).toPromise()})}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(j.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var et=l(2266),ot=l(7001),H=l(7048);let R=(()=>{class o{constructor(e,r,i,a,d,c,u){this.http=e,this.receiptService=r,this.helperService=i,this.reportService=a,this._snackBar=d,this.dialogService=c,this.customerService=u,this.orderList$=new X.X(null),this.orderUrl=P.a.orderUrl,this.isDataLoaded=!1,this.initDate()}getOrders(){return this.isDataLoaded||this.loadOrders(),this.orderList$.asObservable()}getCurrentDateRange(){return{startDate:this.startOfRange,endDate:this.endDate}}updateOrderDateRange(e,r){const i=this.helperService._getDateRange(e,r);this.startOfRange=i.startOfRange,this.endOfRange=i.endOfRange,r&&(this.endDate=r),this.getOrdersFromCache()||this.loadOrders()}addOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(y.pW,_.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent";const i=yield this.http.post(this.orderUrl,e,{params:{shopId:v.cQ.storageHelper.shopId}}).toPromise();if(r.close(),this.orderCache.startOfRange<=new Date(i.deliveryDate)&&this.orderCache.endOfRange>=new Date(i.deliveryDate)&&this.orderCache.orders.push(i),this.isOrderInRange(i.deliveryDate)){const a=this.getOrderListValue();a.length?(a.splice(this.helperService._deliveryDateLocationOf(i,a),0,i),this.orderList$.next(a)):this.orderList$.next([i])}return this._snackBar.open("Order added successfully!",null,_.R$.success),i})}updateOrder(e,r){return(0,p.mG)(this,void 0,void 0,function*(){const i=this.dialogService.openDialog(y.pW,_.ib.progressBar);i.componentInstance.mode="indeterminate",i.componentInstance.color="accent";const a=yield this.http.patch(`${this.orderUrl}/${e}`,r,{params:{shopId:v.cQ.storageHelper.shopId}}).toPromise();if(i.close(),this.orderCache){const u=this.orderCache.orders.findIndex(Y=>Y._id===e);-1!==u&&(this.orderCache.orders[u]=this.helperService._clone(a))}const d=this.getOrderListValue(),c=d.findIndex(u=>u._id===e);if(-1!==c&&(d.splice(c,1)[0].deliveryDate===a.deliveryDate?d.splice(c,0,a):this.isOrderInRange(a.deliveryDate)&&(d.length?d.splice(this.helperService._deliveryDateLocationOf(a,d),0,a):d.push(a)),this.orderList$.next(d),this._snackBar.open("Order updated successfully!",null,_.R$.success)),a.paymentCompleted&&a.completed){yield this.receiptService.generateReceiptForOrder(e);const u=a.customer.currentPoints+Math.round(a.billAmount)-a.pointsUsed;yield this.customerService.updateCustomer(a.customer._id,{currentPoints:u})}this.reportService.refreshData()})}deleteOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(y.pW,_.ib.progressBar);r.componentInstance.mode="indeterminate",r.componentInstance.color="accent",yield this.http.delete(`${this.orderUrl}/${e}`,{params:{shopId:v.cQ.storageHelper.shopId}}).toPromise(),r.close();const i=this.orderList$.getValue();if(this.orderCache){const d=this.orderCache.orders.findIndex(c=>c._id===e);-1!==d&&this.orderCache.orders.splice(d,1)}const a=i.findIndex(d=>d._id===e);-1!==a&&(i.splice(a,1),this.orderList$.next(i)),this._snackBar.open("Order deleted successfully!",null,_.R$.success),this.reportService.refreshData()})}clearOrdersCache(){this.orderCache=null}addOrdersToCache(e){const r=this.helperService._clone(e);if(this.orderCache){let i=!1;this.startOfRange<=this.orderCache.startOfRange&&this.endOfRange>=this.orderCache.startOfRange&&(this.orderCache.startOfRange=this.startOfRange,i=!0),this.endOfRange>=this.orderCache.endOfRange&&this.startOfRange<=this.orderCache.endOfRange&&(this.orderCache.endOfRange=this.endOfRange,i=!0),i&&(this.orderCache.orders.length?r.forEach(a=>{const d=this.orderCache.orders.findIndex(c=>c._id===a._id);-1!==d?this.orderCache.orders[d]=a:this.orderCache.orders.push(a)}):this.orderCache.orders=r)}else this.orderCache={startOfRange:this.startOfRange,endOfRange:this.endOfRange,orders:this.helperService._clone(r)}}loadOrders(){const e={shopId:v.cQ.storageHelper.shopId,startDate:this.startOfRange.toISOString(),endDate:this.endOfRange.toISOString()},r=this.dialogService.openDialog(K.$g,_.ib.spinnerBig);this.http.get(P.a.allOrdersUrl,{params:e}).subscribe(i=>{this.orderList$.next(i),this.addOrdersToCache(i),this.isDataLoaded=!0,r.close()})}getOrdersFromCache(){if(this.orderCache&&this.orderCache.startOfRange<=this.startOfRange&&this.orderCache.endOfRange>=this.endOfRange){const e=this.orderCache.orders.filter(r=>new Date(r.deliveryDate)>=this.startOfRange&&new Date(r.deliveryDate)<=this.endOfRange);return this.orderList$.next(e),!0}return!1}getOrderListValue(){return this.orderList$.getValue()}isOrderInRange(e){let r=e;return"string"==typeof e&&(r=new Date(e)),r>=this.startOfRange&&r<this.endOfRange}initDate(){const e=this.helperService._getDateRange(new Date);this.startOfRange=e.startOfRange,this.endOfRange=e.endOfRange}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(j.eN),t.LFG(tt),t.LFG(k.W),t.LFG(et.r),t.LFG(ot.ux),t.LFG(H.x),t.LFG(L.v))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var rt=l(9574),nt=l(2458);function it(o,n){1&o&&t._UZ(0,"mat-progress-bar",4)}function at(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-option",69),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).autoFillCustomerForm(a)}),t.TgZ(1,"span"),t._uU(2),t.qZA(),t._uU(3," | "),t.TgZ(4,"small"),t._uU(5),t.qZA(),t.qZA()}if(2&o){const e=n.$implicit;t.Q6J("value",e.name),t.xp6(2),t.Oqu(e.name),t.xp6(3),t.hij("Mob. No: ",e.mobile,"")}}function st(o,n){if(1&o&&(t.TgZ(0,"mat-option",70),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function lt(o,n){if(1&o&&(t.TgZ(0,"mat-option",70),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function dt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-option",69),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).selectItem(a)}),t._uU(1),t.qZA()}if(2&o){const e=n.$implicit;t.Q6J("value",e.name),t.xp6(1),t.hij(" ",e.name," ")}}function mt(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"No."),t.qZA())}function ct(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=n.index;t.xp6(1),t.hij(" ",e+1," ")}}function ut(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Name"),t.qZA())}function pt(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Oqu(e.item.name)}}function _t(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Price"),t.qZA())}function ht(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.itemPrice,"USD")," ")}}function gt(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Quantity"),t.qZA())}function ft(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Oqu(e.quantity)}}function Zt(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Total Cost"),t.qZA())}function Tt(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.quantity*e.itemPrice,"USD")," ")}}function Ct(o,n){1&o&&t._UZ(0,"th",71)}function xt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"td",72),t.TgZ(1,"button",73),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw(2).removeItemFromBill(a)}),t.TgZ(2,"mat-icon"),t._uU(3,"close"),t.qZA(),t.qZA(),t.qZA()}}function Ot(o,n){1&o&&t._UZ(0,"tr",74)}function yt(o,n){1&o&&t._UZ(0,"tr",75),2&o&&t.ekj("bg-grey",n.even)}function vt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw(3);t.xp6(1),t.hij("Max. Usable Points: ",e.maxUsablePoints,"")}}function At(o,n){if(1&o&&(t.TgZ(0,"div",76),t.YNc(1,vt,2,1,"span",2),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.maxUsablePoints)}}function bt(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Total Amount"),t.qZA())}function Dt(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.totalAmount,"USD")," ")}}function It(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Discount"),t.qZA())}function wt(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Oqu(e.discount)}}function qt(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Delivery"),t.qZA())}function Nt(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" +",t.xi3(2,1,e.deliveryCharges,"USD")," ")}}function Ut(o,n){1&o&&(t.TgZ(0,"th",71),t._uU(1,"Advance"),t.qZA())}function St(o,n){if(1&o&&(t.TgZ(0,"td",72),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.advancePayment,"USD")," ")}}function Ft(o,n){1&o&&(t.TgZ(0,"th",77),t._uU(1," Net Bill Amount "),t.qZA())}function kt(o,n){if(1&o&&(t.TgZ(0,"td",78),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function Pt(o,n){1&o&&t._UZ(0,"tr",74)}function Rt(o,n){1&o&&t._UZ(0,"tr",75)}function Yt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-dialog-content"),t.TgZ(1,"div",5),t.TgZ(2,"div",6),t.TgZ(3,"h4",7),t._uU(4,"Customer Details"),t.qZA(),t.TgZ(5,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().resetCustomerForm()}),t.TgZ(6,"mat-icon",9),t._uU(7,"restart_alt"),t.qZA(),t.qZA(),t.TgZ(8,"form",10),t.TgZ(9,"div",11),t.TgZ(10,"mat-form-field",12),t.TgZ(11,"mat-label"),t._uU(12,"Name"),t.qZA(),t._UZ(13,"input",13),t.TgZ(14,"mat-autocomplete",null,14),t.YNc(16,at,6,3,"mat-option",15),t.ALo(17,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"div",11),t.TgZ(19,"mat-form-field",16),t.TgZ(20,"mat-label"),t._uU(21,"Mobile"),t.qZA(),t._UZ(22,"input",17),t.qZA(),t.qZA(),t.TgZ(23,"div",11),t.TgZ(24,"mat-form-field",12),t.TgZ(25,"mat-label"),t._uU(26,"Address"),t.qZA(),t._UZ(27,"textarea",18),t.qZA(),t.qZA(),t.TgZ(28,"div",11),t.TgZ(29,"mat-form-field",12),t.TgZ(30,"mat-label"),t._uU(31,"Email"),t.qZA(),t._UZ(32,"input",19),t.qZA(),t.qZA(),t.TgZ(33,"div",20),t.TgZ(34,"div",21),t.TgZ(35,"h4"),t._uU(36,"Birthday"),t.qZA(),t.TgZ(37,"mat-form-field",22),t.TgZ(38,"mat-label"),t._uU(39,"Day"),t.qZA(),t._UZ(40,"input",23),t.qZA(),t._UZ(41,"div",24),t.TgZ(42,"mat-form-field",22),t.TgZ(43,"mat-label"),t._uU(44,"Month"),t.qZA(),t.TgZ(45,"mat-select",25),t.YNc(46,st,2,2,"mat-option",26),t.qZA(),t.qZA(),t.qZA(),t.TgZ(47,"div",27),t.TgZ(48,"h4"),t._uU(49,"Anniversary"),t.qZA(),t.TgZ(50,"mat-form-field",22),t.TgZ(51,"mat-label"),t._uU(52,"Day"),t.qZA(),t._UZ(53,"input",23),t.qZA(),t._UZ(54,"div",24),t.TgZ(55,"mat-form-field",22),t.TgZ(56,"mat-label"),t._uU(57,"Month"),t.qZA(),t.TgZ(58,"mat-select",25),t.YNc(59,lt,2,2,"mat-option",26),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t._UZ(60,"div",28),t.TgZ(61,"div",29),t.TgZ(62,"h4",7),t._uU(63,"Items Details"),t.qZA(),t.TgZ(64,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().resetItemForm()}),t.TgZ(65,"mat-icon",30),t._uU(66,"restart_alt"),t.qZA(),t.qZA(),t.TgZ(67,"div"),t.TgZ(68,"span",31),t._uU(69,"Choose Item"),t.qZA(),t.TgZ(70,"button",32),t.NdJ("click",function(){return t.CHM(e),t.oxw().clearItemSelection()}),t._uU(71," Clear "),t.qZA(),t.qZA(),t.TgZ(72,"form",10),t.TgZ(73,"div",11),t.TgZ(74,"mat-form-field",33),t.TgZ(75,"mat-label"),t._uU(76,"Item Name"),t.qZA(),t._UZ(77,"input",34),t.TgZ(78,"mat-autocomplete",null,35),t.YNc(80,dt,2,2,"mat-option",15),t.ALo(81,"async"),t.qZA(),t.qZA(),t.TgZ(82,"mat-form-field",33),t.TgZ(83,"mat-label"),t._uU(84,"Quantity"),t.qZA(),t._UZ(85,"input",36),t.qZA(),t.TgZ(86,"button",37),t.NdJ("click",function(){return t.CHM(e),t.oxw().addItemToBill()}),t._uU(87," Add "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(88,"table",38),t.ynx(89,39),t.YNc(90,mt,2,0,"th",40),t.YNc(91,ct,2,1,"td",41),t.BQk(),t.ynx(92,42),t.YNc(93,ut,2,0,"th",40),t.YNc(94,pt,2,1,"td",41),t.BQk(),t.ynx(95,43),t.YNc(96,_t,2,0,"th",40),t.YNc(97,ht,3,4,"td",41),t.BQk(),t.ynx(98,44),t.YNc(99,gt,2,0,"th",40),t.YNc(100,ft,2,1,"td",41),t.BQk(),t.ynx(101,45),t.YNc(102,Zt,2,0,"th",40),t.YNc(103,Tt,3,4,"td",41),t.BQk(),t.ynx(104,46),t.YNc(105,Ct,1,0,"th",40),t.YNc(106,xt,4,0,"td",41),t.BQk(),t.YNc(107,Ot,1,0,"tr",47),t.YNc(108,yt,1,2,"tr",48),t.qZA(),t.TgZ(109,"form",10),t.TgZ(110,"div",49),t.TgZ(111,"mat-form-field",22),t.TgZ(112,"mat-label"),t._uU(113,"Discount"),t.qZA(),t._UZ(114,"input",50),t.qZA(),t.TgZ(115,"mat-form-field",51),t.TgZ(116,"mat-label"),t._uU(117,"Type"),t.qZA(),t.TgZ(118,"mat-select",52),t.NdJ("valueChange",function(i){return t.CHM(e),t.oxw().discountType=i}),t.TgZ(119,"mat-option",53),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(120,"%"),t.qZA(),t.TgZ(121,"mat-option",54),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(122,"Amount"),t.qZA(),t.TgZ(123,"mat-option",55),t.NdJ("click",function(){return t.CHM(e),t.oxw().calculateBillData()}),t._uU(124,"Points"),t.qZA(),t.qZA(),t.qZA(),t.YNc(125,At,2,1,"div",56),t.TgZ(126,"mat-form-field",16),t.TgZ(127,"mat-label"),t._uU(128,"Delivery Date & Time"),t.qZA(),t._UZ(129,"input",57),t.qZA(),t.qZA(),t.TgZ(130,"div",58),t.TgZ(131,"mat-form-field",33),t.TgZ(132,"mat-label"),t._uU(133,"Delivery Charges"),t.qZA(),t._UZ(134,"input",59),t.qZA(),t.TgZ(135,"mat-form-field",33),t.TgZ(136,"mat-label"),t._uU(137,"Advance Payment"),t.qZA(),t._UZ(138,"input",60),t.qZA(),t.qZA(),t.qZA(),t.TgZ(139,"table",38),t.ynx(140,61),t.YNc(141,bt,2,0,"th",40),t.YNc(142,Dt,3,4,"td",41),t.BQk(),t.ynx(143,62),t.YNc(144,It,2,0,"th",40),t.YNc(145,wt,2,1,"td",41),t.BQk(),t.ynx(146,63),t.YNc(147,qt,2,0,"th",40),t.YNc(148,Nt,3,4,"td",41),t.BQk(),t.ynx(149,64),t.YNc(150,Ut,2,0,"th",40),t.YNc(151,St,3,4,"td",41),t.BQk(),t.ynx(152,65),t.YNc(153,Ft,2,0,"th",66),t.YNc(154,kt,3,4,"td",67),t.BQk(),t.YNc(155,Pt,1,0,"tr",47),t.YNc(156,Rt,1,0,"tr",68),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.MAs(15),r=t.MAs(79),i=t.oxw();t.xp6(8),t.Q6J("formGroup",i.orderCustomerForm),t.xp6(5),t.Q6J("matAutocomplete",e),t.xp6(3),t.Q6J("ngForOf",t.lcZ(17,20,i.customerList$)),t.xp6(30),t.Q6J("ngForOf",i.MONTHS),t.xp6(13),t.Q6J("ngForOf",i.MONTHS),t.xp6(11),t.Q6J("disabled",!i.enableItemAddButton||!(null!=i.orderItemForm&&i.orderItemForm.valid)),t.xp6(2),t.Q6J("formGroup",i.orderItemForm),t.xp6(5),t.Q6J("matAutocomplete",r),t.xp6(3),t.Q6J("ngForOf",t.lcZ(81,22,i.itemList$)),t.xp6(6),t.Q6J("disabled",!i.enableItemAddButton||!(null!=i.orderItemForm&&i.orderItemForm.valid)),t.xp6(2),t.Q6J("dataSource",i.viewBillItems),t.xp6(19),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(1),t.Q6J("formGroup",i.orderItemForm),t.xp6(9),t.Q6J("value",i.discountType),t.xp6(5),t.Q6J("disabled",!i.selectedCustomerId),t.xp6(2),t.Q6J("ngIf","points"===i.discountType),t.xp6(14),t.Q6J("dataSource",i.billData),t.xp6(16),t.Q6J("matHeaderRowDef",i.billDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.billDisplayedColumns)}}function Qt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-dialog-actions",79),t.TgZ(1,"button",80),t._uU(2,"Cancel"),t.qZA(),t.TgZ(3,"button",81),t.NdJ("click",function(){return t.CHM(e),t.oxw().executeAction()}),t._uU(4),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("disabled",!e.enableAction()),t.xp6(1),t.hij(" ","Add"===e.formType?"Order":e.formType," ")}}let E=(()=>{class o{constructor(e,r,i,a,d,c,u){this.dialogRef=e,this.helperService=r,this.customerService=i,this.itemService=a,this.orderService=d,this.preferencesService=c,this.orderData=u,this.MONTHS=_.zC,this.viewBillItems=[],this.enableItemAddButton=!1,this.availablePoints=0,this.maxUsablePoints=0,this.iemRemovedFromBill$=new V.xQ,this.isLoading=!0,this.displayedColumns=["id","name","price","quantity","total","actions"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.subscriptions=new U.w}ngOnInit(){return(0,p.mG)(this,void 0,void 0,function*(){this.orderData?(this.formType="Update",this.selectedCustomerId=this.orderData.customer._id,this.availablePoints=this.orderData.customer.currentPoints,this.discountType=this.orderData.discountType?this.orderData.discountType:"amount"):(this.formType="Add",this.discountType="amount"),this.isLoading=!0,this.currentPreferences=yield this.preferencesService.getPreferences(),this.isLoading=!1,this.initCustomerForm(),this.initItemForm(),this.initBillItemTable(),this.calculateBillData(),this.customerList$=(0,S.aj)([this.customerService.getAllCustomers(),this.orderCustomerForm.get("name").valueChanges.pipe((0,O.O)(""))]).pipe((0,$.U)(([i,a])=>{if(i)return this._customerListFilter(i,a)})),this.itemList$=(0,S.aj)([this.itemService.getAllItems(),this.orderItemForm.get("itemName").valueChanges.pipe((0,O.O)(""))]).pipe((0,z.b)(()=>{this.enableItemAddButton=!1,this.selectedItem=null}),(0,$.U)(([i,a])=>{if(i)return this._itemListFilter(i,a)}));const e=(0,S.aj)([this.orderItemForm.get("discount").valueChanges.pipe((0,O.O)(0)),this.orderItemForm.get("advancePayment").valueChanges.pipe((0,O.O)(0)),this.orderItemForm.get("deliveryCharges").valueChanges.pipe((0,O.O)(0))]).subscribe(()=>{this.calculateBillData()});this.subscriptions.add(e);const r=this.orderItemForm.get("quantity").valueChanges.pipe((0,O.O)(0)).subscribe(i=>{this.selectedItem&&i&&(this.enableItemAddButton=!0)});this.subscriptions.add(r)})}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}executeAction(){"Add"===this.formType?this.addNewOrder():this.updateOrder()}calculateBillData(){this.billData=[];const e=this.orderData?this.orderData.dollarToPointsMultiplier:this.currentPreferences.dollarToPointsMultiplier;if(this.viewBillItems.length){const r=this.viewBillItems.map(D=>D.itemPrice*D.quantity).reduce((D,So)=>D+So,0);this.maxUsablePoints=Math.min(Math.floor(r*e),this.availablePoints),"Add"===this.formType&&this.selectedCustomerId&&!this.orderItemForm.get("discount").dirty&&this.currentPreferences.applyAutoDiscount&&this.availablePoints>=e*this.currentPreferences.autoDiscountAmount&&(this.discountType="points",this.orderItemForm.get("discount").setValue(Math.min(this.maxUsablePoints,e*this.currentPreferences.autoDiscountAmount),{emitEvent:!1}),this.orderItemForm.get("discount").markAsDirty());let i=this.orderItemForm.get("discount").value;i=i||0;const a="percentage"===this.discountType?Math.round(i/100*r*100)/100:"points"===this.discountType?Math.round(i/e*100)/100:i;this.orderDiscountPercentage="percentage"===this.discountType?i:"points"===this.discountType?Math.round(i/e/r*1e3)/10:Math.round(i/r*1e3)/10;let d=this.orderItemForm.get("advancePayment").value;d=d||0;let c=this.orderItemForm.get("deliveryCharges").value;c=c||0;const u=r-a+c;this.orderItemForm.get("advancePayment").setValidators(s.kI.max(u)),this.orderItemForm.get("advancePayment").updateValueAndValidity({emitEvent:!1});const Y="percentage"===this.discountType?[s.kI.min(0),s.kI.max(100)]:"points"===this.discountType?[s.kI.min(0),s.kI.max(this.maxUsablePoints)]:[s.kI.min(0),s.kI.max(r)];this.orderItemForm.get("discount").setValidators(Y),this.orderItemForm.get("discount").updateValueAndValidity({emitEvent:!1}),this.billData.push({totalAmount:r,discount:`-$${a} (${this.orderDiscountPercentage}%)`,billAmount:u,advancePayment:d,deliveryCharges:c})}else this.resetItemFormValidators()}updateBillTable(){this.calculateBillData(),this.billTable.renderRows()}autoFillCustomerForm(e){this.orderCustomerForm.patchValue({name:e.name,mobile:e.mobile,address:e.address,email:e.email}),e.birthday&&this.orderCustomerForm.patchValue({birthday:{day:e.birthday.day,month:e.birthday.month}}),e.anniversary&&this.orderCustomerForm.patchValue({anniversary:{day:e.anniversary.day,month:e.anniversary.month}}),this.selectedCustomerId=e._id,this.availablePoints=e.currentPoints,this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable()}resetCustomerForm(){this.orderCustomerForm.enable(),this.orderCustomerForm.reset(),this.selectedCustomerId=null,this.availablePoints=null,"points"===this.discountType&&(this.discountType="amount"),this.calculateBillData()}selectItem(e){this.selectedItem=this.helperService._clone(e)}addItemToBill(){const e={item:this.selectedItem,itemPrice:this.selectedItem.price,quantity:this.getItemQuantityFromForm()};this.viewBillItems.push(e),this.updateBillTable(),this.enableItemAddButton=!1,this.selectedItem=null,this.orderItemForm.get("itemName").reset(),this.orderItemForm.get("quantity").reset(),this.itemTable.renderRows()}removeItemFromBill(e){this.viewBillItems=this.viewBillItems.filter(r=>r.item._id!==e.item._id),this.itemTable.renderRows(),this.updateBillTable(),this.orderItemForm.get("itemName").updateValueAndValidity()}resetItemForm(){this.orderItemForm.reset({discount:0,advancePayment:0,deliveryCharges:0,deliveryDate:this._getBrowserDateTimeString()}),this.selectedItem=null,this.enableItemAddButton=!1,this.viewBillItems=[],this.billData=[],this.discountType="amount",this.resetItemFormValidators()}clearItemSelection(){this.orderItemForm.get("itemName").reset(),this.orderItemForm.get("quantity").reset(),this.enableItemAddButton=!1,this.selectedItem=null}enableAction(){return this.orderCustomerForm.valid&&(this.orderCustomerForm.dirty||this.orderItemForm.dirty||this.viewBillItems.length!==this.orderData.billItems.length)&&this.viewBillItems.length&&this.billData.length&&!this.enableItemAddButton&&this.orderItemForm.valid}generateNewOrderObject(){return(0,p.mG)(this,void 0,void 0,function*(){const e=this.viewBillItems.map(i=>({item:i.item._id,itemPrice:i.itemPrice,quantity:i.quantity}));return this.selectedCustomerId||(yield this.addNewCustomer()),{customer:this.selectedCustomerId,billItems:e,billAmount:this.billData[0].billAmount,discount:this.orderDiscountPercentage?this.orderDiscountPercentage:0,advancePayment:this.orderItemForm.get("advancePayment").value,deliveryCharges:this.orderItemForm.get("deliveryCharges").value,deliveryDate:new Date(this.orderItemForm.get("deliveryDate").value).toISOString(),paymentCompleted:this.billData[0].advancePayment===this.billData[0].billAmount,pointsUsed:"points"===this.discountType?Math.round(this.orderItemForm.get("discount").value):0,discountType:this.discountType,discountValue:this.orderItemForm.get("discount").value,dollarToPointsMultiplier:this.orderData?this.orderData.dollarToPointsMultiplier:this.currentPreferences.dollarToPointsMultiplier}})}addNewOrder(){return(0,p.mG)(this,void 0,void 0,function*(){const e=yield this.generateNewOrderObject();yield this.orderService.addOrder(e),this.closeDialog()})}updateOrder(){return(0,p.mG)(this,void 0,void 0,function*(){const e=yield this.generateNewOrderObject();yield this.orderService.updateOrder(this.orderData._id,e),this.closeDialog()})}initCustomerForm(){"Add"===this.formType?this.orderCustomerForm=new s.cw({name:new s.NI(null,[s.kI.required.bind(this),F.F]),mobile:new s.NI(null,s.kI.required.bind(this)),address:new s.NI(null),email:new s.NI(null,s.kI.email.bind(this)),birthday:new s.cw({day:new s.NI(null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(null,[s.kI.min(1),s.kI.max(12)])}),anniversary:new s.cw({day:new s.NI(null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(null,[s.kI.min(1),s.kI.max(12)])})}):(this.orderCustomerForm=new s.cw({name:new s.NI(this.orderData.customer.name,[s.kI.required.bind(this),F.F]),mobile:new s.NI(this.orderData.customer.mobile,s.kI.required.bind(this)),address:new s.NI(this.orderData.customer.address),email:new s.NI(this.orderData.customer.email,s.kI.email.bind(this)),birthday:new s.cw({day:new s.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.day:null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.month:null,[s.kI.min(1),s.kI.max(12)])}),anniversary:new s.cw({day:new s.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.day:null,[s.kI.min(1),s.kI.max(31)]),month:new s.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.month:null,[s.kI.min(1),s.kI.max(12)])})}),this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable())}getOrderCustomerFormData(){return this.helperService._clone(this.orderCustomerForm.value)}_customerListFilter(e,r){return r=r||"",e.filter(i=>i.name.toLowerCase().includes(r.toLowerCase()))}addNewCustomer(){return(0,p.mG)(this,void 0,void 0,function*(){const e=this.getOrderCustomerFormData(),r=yield this.customerService.addCustomer(e);this.selectedCustomerId=r._id,this.availablePoints=r.currentPoints})}initItemForm(){this.orderItemForm=new s.cw({itemName:new s.NI(null,F.F),quantity:new s.NI(null,s.kI.min(1))}),this.orderItemForm.addControl("discount",new s.NI(this.orderData?this.orderData.discountValue:0,s.kI.min(0))),this.orderItemForm.addControl("advancePayment",new s.NI(this.orderData?this.orderData.advancePayment:0,s.kI.min(0))),this.orderItemForm.addControl("deliveryCharges",new s.NI(this.orderData?this.orderData.deliveryCharges:0,s.kI.min(0)));const a=this.orderData?this._getBrowserDateTimeString(this.orderData.deliveryDate):this._getBrowserDateTimeString();this.orderItemForm.addControl("deliveryDate",new s.NI(a,s.kI.required.bind(this)))}resetItemFormValidators(){this.orderItemForm.get("advancePayment").setValidators(s.kI.min(0)),this.orderItemForm.get("advancePayment").updateValueAndValidity({emitEvent:!1}),this.orderItemForm.get("discount").setValidators(s.kI.min(0)),this.orderItemForm.get("discount").updateValueAndValidity({emitEvent:!1})}initBillItemTable(){this.orderData&&this.orderData.billItems.forEach(e=>{this.viewBillItems.push({item:e.item,itemPrice:e.itemPrice,quantity:e.quantity})})}getItemQuantityFromForm(){return this.orderItemForm.get("quantity").value}_itemListFilter(e,r){return r=r||"",e.filter(i=>i.name.toLowerCase().includes(r.toLowerCase())&&-1===this.viewBillItems.findIndex(a=>a.item._id===i._id))}_getBrowserDateTimeString(e){let r=new Date;return"string"==typeof e&&(r=new Date(e)),`${r.getFullYear()}-${r.getMonth()+1<10?`0${r.getMonth()+1}`:`${r.getMonth()+1}`}-${r.getDate()<10?`0${r.getDate()}`:`${r.getDate()}`}T${r.getHours()<10?`0${r.getHours()}`:`${r.getHours()}`}:${r.getMinutes()<10?`0${r.getMinutes()}`:`${r.getMinutes()}`}`}closeDialog(){this.dialogRef.close()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(C.so),t.Y36(k.W),t.Y36(L.v),t.Y36(W.e),t.Y36(R),t.Y36(rt.y),t.Y36(C.WI))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order-form"]],viewQuery:function(e,r){if(1&e&&(t.Gf(m.BZ,5),t.Gf(m.BZ,5)),2&e){let i;t.iGM(i=t.CRH())&&(r.itemTable=i.first),t.iGM(i=t.CRH())&&(r.billTable=i.first)}},decls:5,vars:4,consts:[["mat-dialog-title",""],["mode","indeterminate","color","accent",4,"ngIf"],[4,"ngIf"],["align","end",4,"ngIf"],["mode","indeterminate","color","accent"],[1,"flex","order-form-container"],[1,"customer-form-container"],[1,"sub-form-heading"],["mat-icon-button","","color","warn",1,"reset-button",3,"click"],["matTooltip","Reset Customer Form"],[3,"formGroup"],[1,"mar-vr-16"],["appearance","fill",1,"full-width"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","name","required","",3,"matAutocomplete"],["autoSuggestCustomers","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["appearance","fill"],["matInput","","type","number","formControlName","mobile","required",""],["matInput","","formControlName","address","placeholder","Ex: #1 Tesla Road, Nikola City"],["matInput","","type","email","placeholder","Ex. nikola@tesla.com","formControlName","email"],[1,"flex-col"],["formGroupName","birthday",1,"occasion-container","mar-right-16"],["appearance","fill",1,"input-small"],["matInput","","type","number","formControlName","day"],[1,"input-separator"],["formControlName","month"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","anniversary",1,"occasion-container"],[1,"separator"],[1,"items-form-container"],["matTooltip","Reset Item Form"],[1,"mar-right-8"],["mat-button","","color","warn","matTooltip","Clear Selected Item",3,"disabled","click"],["appearance","fill",1,"mar-right-16"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","itemName",3,"matAutocomplete"],["autoSuggestItems","matAutocomplete"],["type","number","matInput","","placeholder","Ex: 1","formControlName","quantity"],["mat-raised-button","","color","primary","matTooltip","Add Item To Order",3,"disabled","click"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],[1,"mar-top-32","position-relative"],["type","number","matInput","","placeholder","Ex: 1","formControlName","discount"],["appearance","fill",1,"input-small","mar-right-16"],[3,"value","valueChange"],["value","percentage",3,"click"],["value","amount",3,"click"],["value","points",3,"disabled","click"],["class","input-subtext font-12",4,"ngIf"],["type","datetime-local","matInput","","formControlName","deliveryDate"],[1,"mar-top-16"],["type","number","matInput","","placeholder","Ex: 1","formControlName","deliveryCharges"],["type","number","matInput","","placeholder","Ex: 1","formControlName","advancePayment"],["matColumnDef","totalAmount"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["matColumnDef","billAmount"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"value","click"],[3,"value"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"input-subtext","font-12"],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(e,r){1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.YNc(2,it,1,0,"mat-progress-bar",1),t.YNc(3,Yt,157,24,"mat-dialog-content",2),t.YNc(4,Qt,5,2,"mat-dialog-actions",3)),2&e&&(t.xp6(1),t.hij("",r.formType," Order"),t.xp6(1),t.Q6J("ngIf",r.isLoading),t.xp6(1),t.Q6J("ngIf",!r.isLoading),t.xp6(1),t.Q6J("ngIf",!r.isLoading))},directives:[C.uh,f.O5,y.pW,C.xY,w.lW,I.Hw,N.gM,s._Y,s.JL,s.sg,Z.KE,Z.hX,b.Nt,s.Fj,q.ZL,s.JJ,s.u,s.Q7,q.XC,f.sg,s.wV,s.x0,B.gD,m.BZ,m.w1,m.fO,m.Dz,m.as,m.nj,nt.ey,m.ge,m.ev,m.XQ,m.Gk,C.H8,C.ZT],pipes:[f.Ov,f.H9],styles:[".customer-form-container[_ngcontent-%COMP%]{flex:.25 1 auto}.items-form-container[_ngcontent-%COMP%]{flex:1}.sub-form-heading[_ngcontent-%COMP%]{display:inline-block}.reset-button[_ngcontent-%COMP%]{float:right}.input-small[_ngcontent-%COMP%]{width:100px}.occasion-container[_ngcontent-%COMP%]{position:relative}.input-separator[_ngcontent-%COMP%]{width:0px;border-right:1px solid rgba(0,0,0,.26);display:inline-block;height:35px;position:absolute;margin-top:8px}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}.input-subtext[_ngcontent-%COMP%]{position:absolute;bottom:-2px}"]}),o})();var Bt=l(7176),Jt=l(7519),Mt=l(13);const $t=["pendingPaginator"],Lt=["pendingSort"],jt=["soldPaginator"],Ht=["soldSort"];function Et(o,n){1&o&&(t.TgZ(0,"th",26),t._uU(1,"No."),t.qZA())}function Gt(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.index;t.oxw();const r=t.MAs(26);t.xp6(1),t.hij(" ",e+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function Vt(o,n){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Name"),t.qZA())}function zt(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function Wt(o,n){1&o&&(t.TgZ(0,"th",26),t._uU(1,"Total Quantity"),t.qZA())}function Xt(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function Kt(o,n){1&o&&t._UZ(0,"tr",29)}function te(o,n){1&o&&t._UZ(0,"tr",30),2&o&&t.ekj("bg-grey",n.even)}function ee(o,n){1&o&&(t.TgZ(0,"tr",31),t.TgZ(1,"td",32),t._uU(2,"No data found."),t.qZA(),t.qZA())}function oe(o,n){1&o&&(t.TgZ(0,"th",26),t._uU(1,"No."),t.qZA())}function re(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.index;t.oxw();const r=t.MAs(53);t.xp6(1),t.hij(" ",e+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function ne(o,n){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Name"),t.qZA())}function ie(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function ae(o,n){1&o&&(t.TgZ(0,"th",26),t._uU(1,"Total Quantity"),t.qZA())}function se(o,n){if(1&o&&(t.TgZ(0,"td",27),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function le(o,n){1&o&&t._UZ(0,"tr",29)}function de(o,n){1&o&&t._UZ(0,"tr",30),2&o&&t.ekj("bg-grey",n.even)}function me(o,n){1&o&&(t.TgZ(0,"tr",31),t.TgZ(1,"td",32),t._uU(2,"No data found."),t.qZA(),t.qZA())}const G=function(){return[5,10,25,100]};let ce=(()=>{class o{constructor(e){this.orderService=e,this.displayedColumns=["id","name","quantity"],this.pendingDataSource=new m.by([]),this.soldDataSource=new m.by([]),this.subscriptions=new U.w}ngOnInit(){const e=this.orderService.getOrders().subscribe(r=>{r&&(this.pendingDataSource.data=this.setTableDataSource(r.filter(i=>!i.completed)),this.soldDataSource.data=this.setTableDataSource(r.filter(i=>i.completed)))});this.subscriptions.add(e)}ngAfterViewInit(){this.pendingDataSource.paginator=this.pendingPaginator,this.pendingDataSource.sort=this.pendingSort,this.soldDataSource.paginator=this.soldPaginator,this.soldDataSource.sort=this.soldSort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilterPending(e){this.pendingDataSource.filter=e.target.value.trim().toLowerCase(),this.pendingDataSource.paginator&&this.pendingDataSource.paginator.firstPage()}applyFilterSold(e){this.soldDataSource.filter=e.target.value.trim().toLowerCase(),this.soldDataSource.paginator&&this.soldDataSource.paginator.firstPage()}setTableDataSource(e){const r=new Map,i=[];for(const a of e)for(const d of a.billItems){const c=r.get(d.item.name);c?(c.quantity+=d.quantity,r.set(d.item.name,c)):r.set(d.item.name,{name:d.item.name,quantity:d.quantity})}return r.forEach(a=>{i.push(a)}),i}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(R))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-order-total-items"]],viewQuery:function(e,r){if(1&e&&(t.Gf($t,5),t.Gf(Lt,5),t.Gf(jt,5),t.Gf(Ht,5)),2&e){let i;t.iGM(i=t.CRH())&&(r.pendingPaginator=i.first),t.iGM(i=t.CRH())&&(r.pendingSort=i.first),t.iGM(i=t.CRH())&&(r.soldPaginator=i.first),t.iGM(i=t.CRH())&&(r.soldSort=i.first)}},decls:54,vars:12,consts:[[1,"total-items","flex"],[1,"flex-1"],[1,"section-container"],[1,"title","mar-bottom-16"],["appearance","outline","color","accent",1,"mar-right-16"],["matInput","","placeholder","Ex. Samosa",3,"keyup"],["inputPending",""],[1,"pending-items-table"],["mat-table","","matSort","",1,"full-width",3,"dataSource"],["pendingSort","matSort"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","quantity"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],["pendingPaginator",""],[1,"hr-section-separator"],["inputSold",""],[1,"sold-items-table"],["soldSort","matSort"],["soldPaginator",""],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4,"Pending Items"),t.qZA(),t.TgZ(5,"mat-form-field",4),t.TgZ(6,"mat-label"),t._uU(7,"Search"),t.qZA(),t.TgZ(8,"input",5,6),t.NdJ("keyup",function(a){return r.applyFilterPending(a)}),t.qZA(),t.qZA(),t.TgZ(10,"div",7),t.TgZ(11,"table",8,9),t.ynx(13,10),t.YNc(14,Et,2,0,"th",11),t.YNc(15,Gt,2,1,"td",12),t.BQk(),t.ynx(16,13),t.YNc(17,Vt,2,0,"th",14),t.YNc(18,zt,2,1,"td",12),t.BQk(),t.ynx(19,15),t.YNc(20,Wt,2,0,"th",11),t.YNc(21,Xt,2,1,"td",12),t.BQk(),t.YNc(22,Kt,1,0,"tr",16),t.YNc(23,te,1,2,"tr",17),t.YNc(24,ee,3,0,"tr",18),t.qZA(),t._UZ(25,"mat-paginator",19,20),t.qZA(),t.qZA(),t.qZA(),t._UZ(27,"div",21),t.TgZ(28,"div",1),t.TgZ(29,"div",2),t.TgZ(30,"div",3),t._uU(31,"Prepared Items"),t.qZA(),t.TgZ(32,"mat-form-field",4),t.TgZ(33,"mat-label"),t._uU(34,"Search"),t.qZA(),t.TgZ(35,"input",5,22),t.NdJ("keyup",function(a){return r.applyFilterSold(a)}),t.qZA(),t.qZA(),t.TgZ(37,"div",23),t.TgZ(38,"table",8,24),t.ynx(40,10),t.YNc(41,oe,2,0,"th",11),t.YNc(42,re,2,1,"td",12),t.BQk(),t.ynx(43,13),t.YNc(44,ne,2,0,"th",14),t.YNc(45,ie,2,1,"td",12),t.BQk(),t.ynx(46,15),t.YNc(47,ae,2,0,"th",11),t.YNc(48,se,2,1,"td",12),t.BQk(),t.YNc(49,le,1,0,"tr",16),t.YNc(50,de,1,2,"tr",17),t.YNc(51,me,3,0,"tr",18),t.qZA(),t._UZ(52,"mat-paginator",19,25),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(11),t.Q6J("dataSource",r.pendingDataSource),t.xp6(11),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(10,G)),t.xp6(13),t.Q6J("dataSource",r.soldDataSource),t.xp6(11),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(11,G)))},directives:[Z.KE,Z.hX,b.Nt,m.BZ,x.YE,m.w1,m.fO,m.Dz,m.as,m.nj,m.Ee,A.NW,m.ge,m.ev,x.nU,m.XQ,m.Gk],styles:[".title[_ngcontent-%COMP%]{font-weight:500}"]}),o})();function ue(o,n){if(1&o&&(t.TgZ(0,"div",16),t.TgZ(1,"span",18),t._uU(2),t.ALo(3,"currency"),t.qZA(),t.TgZ(4,"span",18),t._uU(5),t.ALo(6,"currency"),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.hij("Filtered Revenue: ",t.xi3(3,2,e.filteredRevenue,"USD"),""),t.xp6(3),t.hij("Filtered Booking Amount: ",t.xi3(6,5,e.filteredBookingAmount,"USD"),"")}}function pe(o,n){1&o&&(t.TgZ(0,"mat-icon",50),t._uU(1,"unfold_more"),t.qZA())}function _e(o,n){1&o&&(t.TgZ(0,"mat-icon",51),t._uU(1,"unfold_less"),t.qZA())}function he(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"No."),t.qZA())}function ge(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=n.dataIndex,r=t.oxw();t.xp6(1),t.hij(" ",e+1+(null==r.paginator?null:r.paginator.pageIndex)*(null==r.paginator?null:r.paginator.pageSize)," ")}}function fe(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Customer Name"),t.qZA())}function Ze(o,n){1&o&&(t.TgZ(0,"mat-icon",56),t._uU(1,"label_important"),t.qZA())}function Te(o,n){if(1&o&&(t.TgZ(0,"td",54),t._uU(1),t.YNc(2,Ze,2,0,"mat-icon",55),t.qZA()),2&o){const e=n.$implicit,r=t.oxw();t.xp6(1),t.hij(" ",e.customer.name," "),t.xp6(1),t.Q6J("ngIf",r.isCustomerOccasion(e.customer.birthday)||r.isCustomerOccasion(e.customer.anniversary))}}function Ce(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Items"),t.qZA())}function xe(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"+ 1 other"),t.qZA())}function Oe(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij("+ ",e.billItems.length-1," others")}}function ye(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.YNc(2,xe,2,0,"span",47),t.YNc(3,Oe,2,1,"span",47),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.billItems[0].item.name," "),t.xp6(1),t.Q6J("ngIf",2===e.billItems.length),t.xp6(1),t.Q6J("ngIf",e.billItems.length>2)}}function ve(o,n){1&o&&(t.TgZ(0,"th",57),t._uU(1," Net Amount "),t.qZA())}function Ae(o,n){if(1&o&&(t.TgZ(0,"td",58),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function be(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Created At"),t.qZA())}function De(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.createdAt,"MMM d, hh:mm a")," ")}}function Ie(o,n){1&o&&(t.TgZ(0,"th",59),t._uU(1," Delivery By "),t.qZA())}function we(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.deliveryDate,"MMM d, hh:mm a")," ")}}function qe(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.deliveryDate,"shortTime")," ")}}function Ne(o,n){if(1&o&&(t.TgZ(0,"td",53),t.YNc(1,we,3,4,"span",47),t.YNc(2,qe,3,4,"span",47),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.orderDateRange.value.end),t.xp6(1),t.Q6J("ngIf",!e.orderDateRange.value.end)}}function Ue(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Status"),t.qZA())}function Se(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Finished"),t.qZA())}function Fe(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Payment Pending"),t.qZA())}function ke(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Preperation Pending"),t.qZA())}function Pe(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Pending"),t.qZA())}function Re(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Overdue"),t.qZA())}function Ye(o,n){if(1&o&&(t.TgZ(0,"td",53),t.YNc(1,Se,2,0,"span",47),t.YNc(2,Fe,2,0,"span",47),t.YNc(3,ke,2,0,"span",47),t.YNc(4,Pe,2,0,"span",47),t.YNc(5,Re,2,0,"span",47),t.qZA()),2&o){const e=n.$implicit,r=t.oxw();t.xp6(1),t.Q6J("ngIf",e.completed&&e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",e.completed&&!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed&&e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed&&!e.paymentCompleted&&!r.isOrderOverdue(e.deliveryDate)),t.xp6(1),t.Q6J("ngIf",!(e.completed&&e.paymentCompleted)&&r.isOrderOverdue(e.deliveryDate))}}function Qe(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Actions"),t.qZA())}function Be(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",65),t.NdJ("click",function(i){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().completeOrder(a),i.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"playlist_add_check"),t.qZA(),t.qZA()}}function Je(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",66),t.NdJ("click",function(i){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().paymentCompleteOrder(a),i.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"price_check"),t.qZA(),t.qZA()}}function Me(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",67),t.NdJ("click",function(i){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().updateOrder(a),i.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA(),t.qZA()}}function $e(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",68),t.NdJ("click",function(i){t.CHM(e);const a=t.oxw().$implicit;return t.oxw().deleteOrder(a),i.stopPropagation()}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA(),t.qZA()}}function Le(o,n){if(1&o&&(t.TgZ(0,"td",53),t.TgZ(1,"div",60),t.YNc(2,Be,3,0,"button",61),t.YNc(3,Je,3,0,"button",62),t.YNc(4,Me,3,0,"button",63),t.YNc(5,$e,3,0,"button",64),t.qZA(),t.qZA()),2&o){const e=n.$implicit;t.xp6(2),t.Q6J("ngIf",!e.completed),t.xp6(1),t.Q6J("ngIf",!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed||!e.paymentCompleted),t.xp6(1),t.Q6J("ngIf",!e.completed||!e.paymentCompleted)}}function je(o,n){if(1&o&&(t.TgZ(0,"mat-card-header"),t.TgZ(1,"div",71),t.TgZ(2,"a",89),t.TgZ(3,"mat-icon"),t._uU(4,"location_on"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(5,"mat-card-title",72),t._uU(6),t.qZA(),t.TgZ(7,"mat-card-subtitle",73),t._uU(8,"Address"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("href","https://www.google.com/maps/place/"+e.customer.address,t.LSH),t.xp6(4),t.hij("",e.customer.address," ")}}function He(o,n){if(1&o&&(t.TgZ(0,"mat-card-header"),t.TgZ(1,"div",71),t.TgZ(2,"mat-icon"),t._uU(3,"alternate_email"),t.qZA(),t.qZA(),t.TgZ(4,"mat-card-title",72),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",73),t._uU(7,"Email"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(5),t.hij("",e.customer.email," ")}}function Ee(o,n){if(1&o&&(t.TgZ(0,"mat-card-header"),t.TgZ(1,"div",71),t.TgZ(2,"mat-icon"),t._uU(3,"cake"),t.qZA(),t.qZA(),t.TgZ(4,"mat-card-title",72),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",73),t._uU(7,"Birthday"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit,r=t.oxw();t.xp6(5),t.hij("",r.getDateString(e.customer.birthday)," ")}}function Ge(o,n){if(1&o&&(t.TgZ(0,"mat-card-header"),t.TgZ(1,"div",71),t.TgZ(2,"mat-icon"),t._uU(3,"celebration"),t.qZA(),t.qZA(),t.TgZ(4,"mat-card-title",72),t._uU(5),t.qZA(),t.TgZ(6,"mat-card-subtitle",73),t._uU(7,"Anniversary"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit,r=t.oxw();t.xp6(5),t.hij("",r.getDateString(e.customer.anniversary)," ")}}function Ve(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"No."),t.qZA())}function ze(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=n.index;t.xp6(1),t.hij(" ",e+1," ")}}function We(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Name"),t.qZA())}function Xe(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.item.name," ")}}function Ke(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Price"),t.qZA())}function to(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.itemPrice,"USD")," ")}}function eo(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Quantity"),t.qZA())}function oo(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.quantity," ")}}function ro(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Total Cost"),t.qZA())}function no(o,n){if(1&o&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.quantity*e.itemPrice,"USD")," ")}}function io(o,n){1&o&&t._UZ(0,"tr",90)}function ao(o,n){1&o&&t._UZ(0,"tr",91),2&o&&t.ekj("bg-grey",n.even)}function so(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Total Amount"),t.qZA())}function lo(o,n){if(1&o&&(t.TgZ(0,"td",92),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,100*(e.billAmount-e.deliveryCharges)/(100-e.discount),"USD")," ")}}function mo(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Discount"),t.qZA())}function co(o,n){if(1&o&&(t.TgZ(0,"td",92),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.discount*(e.billAmount-e.deliveryCharges)/(100-e.discount),"USD")," ")}}function uo(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Delivery"),t.qZA())}function po(o,n){if(1&o&&(t.TgZ(0,"td",92),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" +",t.xi3(2,1,e.deliveryCharges,"USD")," ")}}function _o(o,n){1&o&&(t.TgZ(0,"th",52),t._uU(1,"Advance"),t.qZA())}function ho(o,n){if(1&o&&(t.TgZ(0,"td",92),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" -",t.xi3(2,1,e.advancePayment,"USD")," ")}}function go(o,n){1&o&&(t.TgZ(0,"th",93),t._uU(1," Net Bill Amount "),t.qZA())}function fo(o,n){if(1&o&&(t.TgZ(0,"td",94),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.billAmount-e.advancePayment,"USD")," ")}}function Zo(o,n){1&o&&t._UZ(0,"tr",90)}function To(o,n){1&o&&t._UZ(0,"tr",91)}const Co=function(o){return[o]};function xo(o,n){if(1&o&&(t.TgZ(0,"td",53),t.TgZ(1,"div",69),t.TgZ(2,"mat-card",70),t.TgZ(3,"mat-card-header"),t.TgZ(4,"div",71),t.TgZ(5,"mat-icon"),t._uU(6,"face"),t.qZA(),t.qZA(),t.TgZ(7,"mat-card-title",72),t._uU(8),t.qZA(),t.TgZ(9,"mat-card-subtitle",73),t._uU(10,"Name"),t.qZA(),t.qZA(),t.YNc(11,je,9,2,"mat-card-header",47),t.TgZ(12,"mat-card-header"),t.TgZ(13,"div",71),t.TgZ(14,"mat-icon"),t._uU(15,"smartphone"),t.qZA(),t.qZA(),t.TgZ(16,"mat-card-title",72),t._uU(17),t.qZA(),t.TgZ(18,"mat-card-subtitle",73),t._uU(19,"Mobile"),t.qZA(),t.qZA(),t.YNc(20,He,8,1,"mat-card-header",47),t.YNc(21,Ee,8,1,"mat-card-header",47),t.YNc(22,Ge,8,1,"mat-card-header",47),t.qZA(),t.TgZ(23,"mat-card",74),t.TgZ(24,"mat-card-content"),t.TgZ(25,"table",75),t.ynx(26,27),t.YNc(27,Ve,2,0,"th",28),t.YNc(28,ze,2,1,"td",29),t.BQk(),t.ynx(29,76),t.YNc(30,We,2,0,"th",28),t.YNc(31,Xe,2,1,"td",29),t.BQk(),t.ynx(32,77),t.YNc(33,Ke,2,0,"th",28),t.YNc(34,to,3,4,"td",29),t.BQk(),t.ynx(35,78),t.YNc(36,eo,2,0,"th",28),t.YNc(37,oo,2,1,"td",29),t.BQk(),t.ynx(38,79),t.YNc(39,ro,2,0,"th",28),t.YNc(40,no,3,4,"td",29),t.BQk(),t.YNc(41,io,1,0,"tr",42),t.YNc(42,ao,1,2,"tr",80),t.qZA(),t.TgZ(43,"table",75),t.ynx(44,81),t.YNc(45,so,2,0,"th",28),t.YNc(46,lo,3,4,"td",82),t.BQk(),t.ynx(47,83),t.YNc(48,mo,2,0,"th",28),t.YNc(49,co,3,4,"td",82),t.BQk(),t.ynx(50,84),t.YNc(51,uo,2,0,"th",28),t.YNc(52,po,3,4,"td",82),t.BQk(),t.ynx(53,85),t.YNc(54,_o,2,0,"th",28),t.YNc(55,ho,3,4,"td",82),t.BQk(),t.ynx(56,33),t.YNc(57,go,2,0,"th",86),t.YNc(58,fo,3,4,"td",87),t.BQk(),t.YNc(59,Zo,1,0,"tr",42),t.YNc(60,To,1,0,"tr",88),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o){const e=n.$implicit,r=t.oxw();t.uIk("colspan",r.displayedColumns.length),t.xp6(1),t.Q6J("@detailExpand",r.checkExpanded(e._id)?"expanded":"collapsed"),t.xp6(7),t.hij("",e.customer.name," "),t.xp6(3),t.Q6J("ngIf",e.customer.address),t.xp6(6),t.hij("",e.customer.mobile," "),t.xp6(3),t.Q6J("ngIf",e.customer.email),t.xp6(1),t.Q6J("ngIf",e.customer.birthday),t.xp6(1),t.Q6J("ngIf",e.customer.anniversary),t.xp6(3),t.Q6J("dataSource",e.billItems),t.xp6(16),t.Q6J("matHeaderRowDef",r.itemDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.itemDisplayedColumns),t.xp6(1),t.Q6J("dataSource",t.VKq(14,Co,e)),t.xp6(16),t.Q6J("matHeaderRowDef",r.billDisplayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.billDisplayedColumns)}}function Oo(o,n){1&o&&t._UZ(0,"tr",90)}function yo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",95),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.oxw().toggleRowExpand(a._id)}),t.qZA()}if(2&o){const e=n.$implicit,r=t.oxw();t.ekj("order-expanded-row",r.checkExpanded(e._id))("order-completed-row",e.completed&&e.paymentCompleted)("order-time-warning-row",!(e.completed&&e.paymentCompleted)&&r.isOrderTimeWarning(e.deliveryDate))("order-overdue-warning-row",!(e.completed&&e.paymentCompleted)&&r.isOrderOverdue(e.deliveryDate))}}function vo(o,n){1&o&&t._UZ(0,"tr",96)}function Ao(o,n){1&o&&(t.TgZ(0,"tr",97),t.TgZ(1,"td",98),t._uU(2,"No data found."),t.qZA(),t.qZA())}function bo(o,n){1&o&&t._UZ(0,"app-order-total-items")}const Do=function(){return["expandedDetail"]},Io=function(){return[5,10,25,100]},wo=[{path:"",component:(()=>{class o{constructor(e,r,i){this.orderService=e,this.dialogService=r,this.helperService=i,this.displayedColumns=["id","customerName","items","billAmount","timeCreated","deliveryDate","status","actions"],this.itemDisplayedColumns=["id","name","price","quantity","total"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.dataSource=new m.by([]),this.expandedOrderRows=[],this.allOrdersList=[],this.isShowPaidOrders=!0,this.isShowPreparedOrders=!0,this.isShowFinishedOrders=!0,this.totalRevenue=0,this.totalItemsSold=0,this.totalBookingAmount=0,this.filteredRevenue=0,this.filteredBookingAmount=0,this.showFilterSummary=!1,this.subscriptions=new U.w}ngOnInit(){this.setDataSourceFilter();const e=this.orderService.getOrders().subscribe(i=>{i&&(this.allOrdersList=this.helperService._clone(i),this.updateDataSource(),this.updateOrderSummary())});this.initDateRange();const r=this.orderDateRange.valueChanges.pipe((0,Jt.x)(this.isDateSame.bind(this)),(0,Mt.e)(1e3)).subscribe(i=>{i.end&&i.start.getTime()!==i.end.getTime()?this.orderService.updateOrderDateRange(i.start,i.end):this.orderService.updateOrderDateRange(i.start)});this.subscriptions.add(e),this.subscriptions.add(r)}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilter(e){const r=e.target.value;this.dataSource.filter=r.trim().toLowerCase(),""!==r.trim()?(this.updateFilterSummary(),this.showFilterSummary=!0):this.showFilterSummary=!1,this.dataSource.paginator&&this.dataSource.paginator.firstPage()}checkExpanded(e){return this.expandedOrderRows.includes(e)}toggleRowExpand(e){const r=this.expandedOrderRows.indexOf(e);-1===r?this.expandedOrderRows.push(e):this.expandedOrderRows.splice(r,1)}toggleAllRowsExpand(){this.expandedOrderRows=this.expandedOrderRows.length?[]:this.allOrdersList.map(e=>e._id)}addOrder(){this.dialogService.openDialog(E,_.ib.order)}updateOrder(e){this.dialogService.openDialog(E,Object.assign(Object.assign({},_.ib.order),{data:e}))}completeOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(e._id,{completed:!0})})}paymentCompleteOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(e._id,{paymentCompleted:!0})})}deleteOrder(e){return(0,p.mG)(this,void 0,void 0,function*(){(yield this.dialogService.openDialog(Bt.z,Object.assign(Object.assign({},_.ib.confirmationDialog),{data:{type:"warning",action:"delete",entity:"order"}})).afterClosed().toPromise())&&(yield this.orderService.deleteOrder(e._id))})}isOrderTimeWarning(e){const r=(new Date).getTime(),i=new Date(e).getTime();return i>=r&&i-r<=18e5}isOrderOverdue(e){const r=(new Date).getTime();return new Date(e).getTime()<=r}isCustomerOccasion(e){if(e){const r=new Date;return r.getDate()===e.day&&r.getMonth()+1===e.month}}getDateString(e){if(e)return`${_.zC.find(r=>r.value===e.month).name}, ${e.day}`}togglePaidOrders(){this.isShowPaidOrders=!this.isShowPaidOrders,this.updateDataSource()}togglePreparedOrders(){this.isShowPreparedOrders=!this.isShowPreparedOrders,this.updateDataSource()}toggleFinishedOrders(){this.isShowFinishedOrders=!this.isShowFinishedOrders,this.updateDataSource()}getNumberOfOrders(e){return e?this.allOrdersList.filter(r=>r.completed&&r.paymentCompleted).length:this.allOrdersList.filter(r=>!(r.completed&&r.paymentCompleted)).length}gotToAdjacentDay(e){const r=this.orderDateRange.get("start").value;let i;"next"===e?(i=new Date(r.getTime()),i.setDate(i.getDate()+1)):(i=new Date(r.getTime()),i.setDate(i.getDate()-1)),this.orderDateRange.get("start").patchValue(i)}initDateRange(){const e=this.orderService.getCurrentDateRange();this.orderDateRange=new s.cw({start:new s.NI(e.startDate),end:new s.NI(e.endDate)})}updateDataSource(){if(this.allOrdersList.length){let e;!this.isShowPaidOrders&&this.isShowPreparedOrders?e=this.allOrdersList.filter(r=>!r.paymentCompleted):this.isShowPaidOrders&&!this.isShowPreparedOrders?e=this.allOrdersList.filter(r=>!r.completed):this.isShowPaidOrders||this.isShowPreparedOrders?this.isShowPaidOrders&&this.isShowPreparedOrders&&(e=this.isShowFinishedOrders?this.helperService._clone(this.allOrdersList):this.allOrdersList.filter(r=>!(r.completed&&r.paymentCompleted))):e=this.allOrdersList.filter(r=>!r.completed&&!r.paymentCompleted),this.dataSource.data=e}else this.dataSource.data=[]}setDataSourceFilter(){this.dataSource.filterPredicate=(e,r)=>{const i=r.toLowerCase(),a=e.billItems.map(c=>c.item.name).join(" ").toLowerCase();return`${e.customer.name.toLowerCase()} ${a}`.includes(i)}}updateOrderSummary(){const e=this.allOrdersList.filter(a=>a.completed&&a.paymentCompleted);let r=0,i=0;for(const a of e){for(const d of a.billItems)r+=d.quantity;i+=a.billAmount}this.totalRevenue=i,this.totalItemsSold=r,this.totalBookingAmount=this.allOrdersList.filter(a=>!(a.completed&&a.paymentCompleted)).reduce((a,d)=>a+d.billAmount,0)}updateFilterSummary(){this.filteredRevenue=this.dataSource.filteredData.filter(e=>e.completed&&e.paymentCompleted).reduce((e,r)=>e+r.billAmount,0),this.filteredBookingAmount=this.dataSource.filteredData.filter(e=>!(e.completed&&e.paymentCompleted)).reduce((e,r)=>e+r.billAmount,0)}isDateSame(e,r){return e.start===r.start&&e.end===r.end}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(R),t.Y36(H.x),t.Y36(k.W))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-orders"]],viewQuery:function(e,r){if(1&e&&(t.Gf(A.NW,5),t.Gf(x.YE,5)),2&e){let i;t.iGM(i=t.CRH())&&(r.paginator=i.first),t.iGM(i=t.CRH())&&(r.sort=i.first)}},decls:89,vars:31,consts:[[1,"order-container"],[1,"section-container","mar-bottom-32"],[1,"orders","mar-bottom-8"],["appearance","outline","color","accent",1,"mar-right-16"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],["mat-button","","matDateRangePickerCancel",""],["mat-raised-button","","color","primary","matDateRangePickerApply",""],["matInput","","placeholder","Ex. Nikola Tesla",3,"keyup"],["input",""],["class","order-summary mar-bottom-16",4,"ngIf"],["color","accent",1,"orders-toggle",3,"checked","click"],["color","accent",1,"orders-toggle","mar-right-16",3,"checked","click"],[1,"order-summary","mar-bottom-16"],[1,"mar-right-16","order-info"],[1,"mar-right-16"],["mat-icon-button","","color","accent",3,"click"],["matTooltip","Expand Rows",4,"ngIf"],["matTooltip","Collapse Rows",4,"ngIf"],["mat-icon-button","","color","accent",3,"disabled","click"],["matTooltip","Previous Day",1,"font-48"],["matTooltip","Next Day",1,"font-48"],[1,"orders-table"],["mat-table","","matSort","","multiTemplateDataRows","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","customerName"],["mat-cell","","class","order-customer-name",4,"matCellDef"],["matColumnDef","items"],["matColumnDef","billAmount"],["mat-header-cell","","mat-sort-header","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["matColumnDef","timeCreated"],["matColumnDef","deliveryDate"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","order-row",3,"order-expanded-row","order-completed-row","order-time-warning-row","order-overdue-warning-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","order-detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],[4,"ngIf"],["mat-fab","","color","accent",1,"menu-button",3,"click"],["matTooltip","Add New"],["matTooltip","Expand Rows"],["matTooltip","Collapse Rows"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"order-customer-name"],["color","accent","class","order-customer-occasion pad-left-8",4,"ngIf"],["color","accent",1,"order-customer-occasion","pad-left-8"],["mat-header-cell","","mat-sort-header","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"],["mat-header-cell","","mat-sort-header",""],[1,"flex"],["mat-icon-button","","matTooltip","Complete Preperation",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Complete Preperation",3,"click"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],[1,"order-expanded-detail-row"],[1,"customer-card","mar-16"],["mat-card-avatar",""],[1,"font-14","font-weight-400"],[1,"font-12"],[1,"item-card","mar-16"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["mat-row","",3,"bg-grey",4,"matRowDef","matRowDefColumns"],["matColumnDef","totalAmount"],["mat-cell","","class","total-table-cell",4,"matCellDef"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","total-table-cell net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["target","_blank",1,"direction-icon",3,"href"],["mat-header-row",""],["mat-row",""],["mat-cell","",1,"total-table-cell"],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"total-table-cell","net-bill-column"],["mat-row","",1,"order-row",3,"click"],["mat-row","",1,"order-detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,r){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"mat-form-field",3),t.TgZ(4,"mat-label"),t._uU(5,"Enter a date range"),t.qZA(),t.TgZ(6,"mat-date-range-input",4),t._UZ(7,"input",5),t._UZ(8,"input",6),t.qZA(),t._UZ(9,"mat-datepicker-toggle",7),t.TgZ(10,"mat-date-range-picker",null,8),t.TgZ(12,"mat-date-range-picker-actions"),t.TgZ(13,"button",9),t._uU(14,"Cancel"),t.qZA(),t.TgZ(15,"button",10),t._uU(16," Apply "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"mat-form-field",3),t.TgZ(18,"mat-label"),t._uU(19,"Search Orders"),t.qZA(),t.TgZ(20,"input",11,12),t.NdJ("keyup",function(a){return r.applyFilter(a)}),t.qZA(),t.qZA(),t.YNc(22,ue,7,8,"div",13),t.TgZ(23,"mat-slide-toggle",14),t.NdJ("click",function(){return r.toggleFinishedOrders()}),t._uU(24," Show Finished Orders "),t.qZA(),t.TgZ(25,"mat-slide-toggle",15),t.NdJ("click",function(){return r.togglePreparedOrders()}),t._uU(26," Show Prepared Orders "),t.qZA(),t.TgZ(27,"mat-slide-toggle",15),t.NdJ("click",function(){return r.togglePaidOrders()}),t._uU(28," Show Paid Orders "),t.qZA(),t.TgZ(29,"div"),t.TgZ(30,"div",16),t.TgZ(31,"span",17),t._uU(32),t.qZA(),t.TgZ(33,"span",18),t._uU(34),t.qZA(),t.TgZ(35,"span",18),t._uU(36),t.qZA(),t.TgZ(37,"span",18),t._uU(38),t.ALo(39,"currency"),t.qZA(),t.TgZ(40,"span",18),t._uU(41),t.ALo(42,"currency"),t.qZA(),t.qZA(),t.TgZ(43,"button",19),t.NdJ("click",function(){return r.toggleAllRowsExpand()}),t.YNc(44,pe,2,0,"mat-icon",20),t.YNc(45,_e,2,0,"mat-icon",21),t.qZA(),t.TgZ(46,"button",22),t.NdJ("click",function(){return r.gotToAdjacentDay("previous")}),t.TgZ(47,"mat-icon",23),t._uU(48,"arrow_left"),t.qZA(),t.qZA(),t.TgZ(49,"button",22),t.NdJ("click",function(){return r.gotToAdjacentDay("next")}),t.TgZ(50,"mat-icon",24),t._uU(51,"arrow_right"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(52,"div",25),t.TgZ(53,"table",26),t.ynx(54,27),t.YNc(55,he,2,0,"th",28),t.YNc(56,ge,2,1,"td",29),t.BQk(),t.ynx(57,30),t.YNc(58,fe,2,0,"th",28),t.YNc(59,Te,3,2,"td",31),t.BQk(),t.ynx(60,32),t.YNc(61,Ce,2,0,"th",28),t.YNc(62,ye,4,3,"td",29),t.BQk(),t.ynx(63,33),t.YNc(64,ve,2,0,"th",34),t.YNc(65,Ae,3,4,"td",35),t.BQk(),t.ynx(66,36),t.YNc(67,be,2,0,"th",28),t.YNc(68,De,3,4,"td",29),t.BQk(),t.ynx(69,37),t.YNc(70,Ie,2,0,"th",38),t.YNc(71,Ne,3,2,"td",29),t.BQk(),t.ynx(72,39),t.YNc(73,Ue,2,0,"th",28),t.YNc(74,Ye,6,5,"td",29),t.BQk(),t.ynx(75,40),t.YNc(76,Qe,2,0,"th",28),t.YNc(77,Le,6,4,"td",29),t.BQk(),t.ynx(78,41),t.YNc(79,xo,61,16,"td",29),t.BQk(),t.YNc(80,Oo,1,0,"tr",42),t.YNc(81,yo,1,8,"tr",43),t.YNc(82,vo,1,0,"tr",44),t.YNc(83,Ao,3,0,"tr",45),t.qZA(),t._UZ(84,"mat-paginator",46),t.qZA(),t.qZA(),t.qZA(),t.YNc(85,bo,1,0,"app-order-total-items",47),t.qZA(),t.TgZ(86,"button",48),t.NdJ("click",function(){return r.addOrder()}),t.TgZ(87,"mat-icon",49),t._uU(88,"receipt"),t.qZA(),t.qZA()),2&e){const i=t.MAs(11);t.xp6(6),t.Q6J("formGroup",r.orderDateRange)("rangePicker",i),t.xp6(3),t.Q6J("for",i),t.xp6(13),t.Q6J("ngIf",r.showFilterSummary),t.xp6(1),t.Q6J("checked",!0),t.xp6(2),t.Q6J("checked",!0),t.xp6(2),t.Q6J("checked",!0),t.xp6(5),t.hij("Pending Orders: ",r.getNumberOfOrders(!1),""),t.xp6(2),t.hij("Completed Orders: ",r.getNumberOfOrders(!0),""),t.xp6(2),t.hij("Total Items Sold: ",r.totalItemsSold,""),t.xp6(2),t.hij("Total Revenue: ",t.xi3(39,23,r.totalRevenue,"USD"),""),t.xp6(3),t.hij("Total Booking Amount: ",t.xi3(42,26,r.totalBookingAmount,"USD"),""),t.xp6(3),t.Q6J("ngIf",!r.expandedOrderRows.length),t.xp6(1),t.Q6J("ngIf",r.expandedOrderRows.length),t.xp6(1),t.Q6J("disabled",r.orderDateRange.value.end),t.xp6(3),t.Q6J("disabled",r.orderDateRange.value.end),t.xp6(4),t.Q6J("dataSource",r.dataSource),t.xp6(27),t.Q6J("matHeaderRowDef",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(29,Do)),t.xp6(2),t.Q6J("pageSize",10)("pageSizeOptions",t.DdM(30,Io)),t.xp6(1),t.Q6J("ngIf",r.allOrdersList.length)}},directives:[Z.KE,Z.hX,h.wx,s.JL,s.sg,h.zY,s.Fj,s.JJ,s.u,h.By,h.nW,Z.R9,h._g,h.M5,w.lW,h.dp,h.DK,b.Nt,f.O5,J.Rr,I.Hw,N.gM,m.BZ,x.YE,m.w1,m.fO,m.Dz,m.as,m.nj,m.Ee,A.NW,m.ge,m.ev,x.nU,T.a8,T.dk,T.kc,T.n5,T.$j,T.dn,m.XQ,m.Gk,ce],pipes:[f.H9,f.uU],styles:["tr.order-detail-row[_ngcontent-%COMP%]{height:0}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):hover{background:whitesmoke}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):active{background:#efefef}.order-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.order-expanded-detail-row[_ngcontent-%COMP%]{overflow:hidden;display:flex}.order-completed-row[_ngcontent-%COMP%]{background-color:#00ff0040!important}.order-time-warning-row[_ngcontent-%COMP%]{background-color:#ff910040!important}.order-overdue-warning-row[_ngcontent-%COMP%]{background-color:#ff000040!important}.order-customer-name[_ngcontent-%COMP%]{position:relative}.order-customer-name[_ngcontent-%COMP%]   .order-customer-occasion[_ngcontent-%COMP%]{position:absolute;top:10px}.row-expand-toggle[_ngcontent-%COMP%]{float:right;margin-right:16px!important}.customer-card[_ngcontent-%COMP%]{max-width:400px;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;border:1px solid grey}.item-card[_ngcontent-%COMP%]{flex-grow:.5;border:1px solid grey}.total-table-cell[_ngcontent-%COMP%]{border-top:1px solid black;border-bottom:1px solid black}.direction-icon[_ngcontent-%COMP%]{text-decoration:none;color:initial}.orders-toggle[_ngcontent-%COMP%]{float:right}.order-info[_ngcontent-%COMP%]{font-weight:500}.order-summary[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);border-radius:5px;padding:8px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}"],data:{animation:[(0,g.X$)("detailExpand",[(0,g.SB)("collapsed, void",(0,g.oB)({height:"0px",minHeight:"0"})),(0,g.SB)("expanded",(0,g.oB)({height:"*"})),(0,g.eR)("expanded <=> collapsed",(0,g.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)")),(0,g.eR)("expanded <=> void",(0,g.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),o})()},{path:"**",redirectTo:"",pathMatch:"full"}];let qo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[M.Bz.forChild(wo)],M.Bz]}),o})();var No=l(4992);let Uo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[f.ez,qo,No.m,s.UX,Z.lN,m.p0,I.Ps,A.TU,b.c,w.ot,x.JX,q.Bb,h.FA,T.QW,B.LD,J.rP,N.AV,C.Is,y.Cv]]}),o})()}}]);