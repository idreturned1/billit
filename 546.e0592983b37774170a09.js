"use strict";(self.webpackChunkbillit=self.webpackChunkbillit||[]).push([[546],{9546:(ko,Y,s)=>{s.r(Y),s.d(Y,{OrdersModule:()=>No});var Z=s(8583),a=s(3679),f=s(8295),m=s(2789),I=s(6627),x=s(9692),A=s(9983),w=s(1095),v=s(1494),q=s(5781),h=s(3220),T=s(3738),Q=s(7441),B=s(8553),e=s(7716),_=s(2458),P=s(9490),z=s(6237),X=s(9238);const W=["thumbContainer"],K=["toggleBar"],ee=["input"],te=function(o){return{enterDuration:o}},oe=["*"],re=new e.OlP("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let ie=0;const ne={provide:a.JU,useExisting:(0,e.Gpc)(()=>$),multi:!0};class ae{constructor(i,t){this.source=i,this.checked=t}}const le=(0,_.sb)((0,_.pj)((0,_.Kr)((0,_.Id)(class{constructor(o){this._elementRef=o}}))));let $=(()=>{class o extends le{constructor(t,r,n,l,d,c){super(t),this._focusMonitor=r,this._changeDetectorRef=n,this.defaults=d,this._onChange=u=>{},this._onTouched=()=>{},this._uniqueId="mat-slide-toggle-"+ ++ie,this._required=!1,this._checked=!1,this.name=null,this.id=this._uniqueId,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new e.vpe,this.toggleChange=new e.vpe,this.tabIndex=parseInt(l)||0,this.color=this.defaultColor=d.color||"accent",this._noopAnimations="NoopAnimations"===c}get required(){return this._required}set required(t){this._required=(0,P.Ig)(t)}get checked(){return this._checked}set checked(t){this._checked=(0,P.Ig)(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?this._inputElement.nativeElement.focus():t||Promise.resolve().then(()=>this._onTouched())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}focus(t,r){r?this._focusMonitor.focusVia(this._inputElement,r,t):this._inputElement.nativeElement.focus(t)}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(new ae(this,this.checked))}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq),e.Y36(X.tE),e.Y36(e.sBO),e.$8M("tabindex"),e.Y36(re),e.Y36(z.Qb,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["mat-slide-toggle"]],viewQuery:function(t,r){if(1&t&&(e.Gf(W,5),e.Gf(K,5),e.Gf(ee,5)),2&t){let n;e.iGM(n=e.CRH())&&(r._thumbEl=n.first),e.iGM(n=e.CRH())&&(r._thumbBarEl=n.first),e.iGM(n=e.CRH())&&(r._inputElement=n.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:12,hostBindings:function(t,r){2&t&&(e.Ikx("id",r.id),e.uIk("tabindex",r.disabled?null:-1)("aria-label",null)("aria-labelledby",null),e.ekj("mat-checked",r.checked)("mat-disabled",r.disabled)("mat-slide-toggle-label-before","before"==r.labelPosition)("_mat-animation-noopable",r._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex",name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],required:"required",checked:"checked",ariaDescribedby:["aria-describedby","ariaDescribedby"]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[e._Bn([ne]),e.qOj],ngContentSelectors:oe,decls:16,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["toggleBar",""],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],["thumbContainer",""],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(t,r){if(1&t&&(e.F$t(),e.TgZ(0,"label",0,1),e.TgZ(2,"div",2,3),e.TgZ(4,"input",4,5),e.NdJ("change",function(l){return r._onChangeEvent(l)})("click",function(l){return r._onInputClick(l)}),e.qZA(),e.TgZ(6,"div",6,7),e._UZ(8,"div",8),e.TgZ(9,"div",9),e._UZ(10,"div",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"span",11,12),e.NdJ("cdkObserveContent",function(){return r._onLabelTextChange()}),e.TgZ(13,"span",13),e._uU(14,"\xa0"),e.qZA(),e.Hsn(15),e.qZA(),e.qZA()),2&t){const n=e.MAs(1),l=e.MAs(12);e.uIk("for",r.inputId),e.xp6(2),e.ekj("mat-slide-toggle-bar-no-side-margin",!l.textContent||!l.textContent.trim()),e.xp6(2),e.Q6J("id",r.inputId)("required",r.required)("tabIndex",r.tabIndex)("checked",r.checked)("disabled",r.disabled),e.uIk("name",r.name)("aria-checked",r.checked.toString())("aria-label",r.ariaLabel)("aria-labelledby",r.ariaLabelledby)("aria-describedby",r.ariaDescribedby),e.xp6(5),e.Q6J("matRippleTrigger",n)("matRippleDisabled",r.disableRipple||r.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",e.VKq(18,te,r._noopAnimations?0:150))}},directives:[_.wG,B.wD],styles:[".mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:transparent}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}.cdk-high-contrast-active .mat-slide-toggle.cdk-keyboard-focused .mat-slide-toggle-bar{outline:2px dotted;outline-offset:5px}\n"],encapsulation:2,changeDetection:0}),o})(),J=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({}),o})(),me=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[J,_.si,_.BQ,B.Q8],J,_.BQ]}),o})();var S=s(1436),C=s(2238),L=s(4655),g=s(4762),b=s(7238),ce=s(9765),N=s(5319),U=s(739),y=s(9761),j=s(8002),ue=s(3342),k=s(7165),p=s(9670),R=s(4416),pe=s(3208),ge=s(7672),F=s(8312),O=s(9067),he=s(6215),D=s(4885),E=s(1841);let _e=(()=>{class o{constructor(t){this.http=t}generateReceiptForOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){yield this.http.post(`${F.a.receiptForOrderUrl}/${t}`,null,{params:{shopId:O.cQ.storageHelper.shopId}}).toPromise()})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(E.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var fe=s(2266),Ze=s(7001),G=s(7048);let M=(()=>{class o{constructor(t,r,n,l,d,c){this.http=t,this.receiptService=r,this.helperService=n,this.reportService=l,this._snackBar=d,this.dialogService=c,this.orderList$=new he.X(null),this.orderUrl=F.a.orderUrl,this.startDate=new Date,this.isDataLoaded=!1}getOrders(){return this.isDataLoaded||this.loadOrders(),this.orderList$.asObservable()}getCurrentDateRange(){return{startDate:this.startDate,endDate:this.endDate}}updateOrderDateRange(t,r){this.startDate=t,this.endDate=r||null,this.getOrdersFromCache()||this.loadOrders()}addOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(D.$g,p.ib.spinner),n=yield this.http.post(this.orderUrl,t,{params:{shopId:O.cQ.storageHelper.shopId}}).toPromise();if(r.close(),this.orderCache.startOfRange<=new Date(n.deliveryDate)&&this.orderCache.endOfRange>=new Date(n.deliveryDate)&&this.orderCache.orders.push(n),this.isOrderInRange(n.deliveryDate)){const l=this.getOrderListValue();l.length?(l.splice(this.helperService._deliveryDateLocationOf(n,l),0,n),this.orderList$.next(l)):this.orderList$.next([n])}return this._snackBar.open("Order added successfully!",null,p.R$.success),n})}updateOrder(t,r){return(0,g.mG)(this,void 0,void 0,function*(){const n=this.dialogService.openDialog(D.$g,p.ib.spinner),l=yield this.http.patch(`${this.orderUrl}/${t}`,r,{params:{shopId:O.cQ.storageHelper.shopId}}).toPromise();if(n.close(),this.orderCache){const u=this.orderCache.orders.findIndex(Uo=>Uo._id===t);-1!==u&&(this.orderCache.orders[u]=this.helperService._clone(l))}const d=this.getOrderListValue(),c=d.findIndex(u=>u._id===t);-1!==c&&(d.splice(c,1)[0].deliveryDate===l.deliveryDate?d.splice(c,0,l):this.isOrderInRange(l.deliveryDate)&&(d.length?d.splice(this.helperService._deliveryDateLocationOf(l,d),0,l):d.push(l)),this.orderList$.next(d),this._snackBar.open("Order updated successfully!",null,p.R$.success)),l.paymentCompleted&&l.completed&&(yield this.receiptService.generateReceiptForOrder(t)),this.reportService.refreshData()})}deleteOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){const r=this.dialogService.openDialog(D.$g,p.ib.spinner);yield this.http.delete(`${this.orderUrl}/${t}`,{params:{shopId:O.cQ.storageHelper.shopId}}).toPromise(),r.close();const n=this.orderList$.getValue();if(this.orderCache){const d=this.orderCache.orders.findIndex(c=>c._id===t);-1!==d&&this.orderCache.orders.splice(d,1)}const l=n.findIndex(d=>d._id===t);-1!==l&&(n.splice(l,1),this.orderList$.next(n)),this._snackBar.open("Order deleted successfully!",null,p.R$.success),this.reportService.refreshData()})}clearOrdersCache(){this.orderCache=null}addOrdersToCache(t){const r=this.defineDateRange(),n=this.helperService._clone(t);if(this.orderCache){let l=!1;r.startOfRange<this.orderCache.startOfRange&&r.endOfRange>=this.orderCache.startOfRange&&(this.orderCache.startOfRange=r.startOfRange,l=!0),r.endOfRange>this.orderCache.endOfRange&&r.startOfRange<=this.orderCache.endOfRange&&(this.orderCache.endOfRange=r.endOfRange,l=!0),l&&(this.orderCache.orders.length?n.forEach(d=>{const c=this.orderCache.orders.findIndex(u=>u._id===d._id);-1!==c?this.orderCache.orders[c]=d:this.orderCache.orders.push(d)}):this.orderCache.orders=n)}else this.orderCache={startOfRange:r.startOfRange,endOfRange:r.endOfRange,orders:this.helperService._clone(n)}}loadOrders(){const t={shopId:O.cQ.storageHelper.shopId,startDate:this.startDate.toISOString()};this.endDate&&(t.endDate=this.endDate.toISOString());const r=this.dialogService.openDialog(D.$g,p.ib.spinner);this.http.get(F.a.allOrdersUrl,{params:t}).subscribe(n=>{this.orderList$.next(n),this.addOrdersToCache(n),this.isDataLoaded=!0,r.close()})}getOrdersFromCache(){if(this.orderCache){const t=this.defineDateRange();if(this.orderCache.startOfRange<=t.startOfRange&&this.orderCache.endOfRange>=t.endOfRange){const r=this.orderCache.orders.filter(n=>new Date(n.deliveryDate)>=t.startOfRange&&new Date(n.deliveryDate)<=t.endOfRange);return this.orderList$.next(r),!0}}return!1}getOrderListValue(){return this.orderList$.getValue()}isOrderInRange(t){let r=t;"string"==typeof t&&(r=new Date(t));const n=this.defineDateRange();return r>=n.startOfRange&&r<n.endOfRange}defineDateRange(){const t=new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate());let r;return r=this.endDate?new Date(this.endDate.getFullYear(),this.endDate.getMonth(),this.endDate.getDate()+1):new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate()+1),{startOfRange:t,endOfRange:r}}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(E.eN),e.LFG(_e),e.LFG(R.W),e.LFG(fe.r),e.LFG(Ze.ux),e.LFG(G.x))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function Te(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"mat-option",62),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().autoFillCustomerForm(l)}),e.TgZ(1,"span"),e._uU(2),e.qZA(),e._uU(3," | "),e.TgZ(4,"small"),e._uU(5),e.qZA(),e.qZA()}if(2&o){const t=i.$implicit;e.Q6J("value",t.name),e.xp6(2),e.Oqu(t.name),e.xp6(3),e.hij("Mob. No: ",t.mobile,"")}}function Ce(o,i){if(1&o&&(e.TgZ(0,"mat-option",63),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function be(o,i){if(1&o&&(e.TgZ(0,"mat-option",63),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function ve(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"mat-option",62),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().selectItem(l)}),e._uU(1),e.qZA()}if(2&o){const t=i.$implicit;e.Q6J("value",t.name),e.xp6(1),e.hij(" ",t.name," ")}}function ye(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"No."),e.qZA())}function Oe(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.qZA()),2&o){const t=i.index;e.xp6(1),e.hij(" ",t+1," ")}}function xe(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Name"),e.qZA())}function Ae(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.Oqu(t.item.name)}}function De(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Price"),e.qZA())}function Ie(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.itemPrice,"USD")," ")}}function we(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Quantity"),e.qZA())}function qe(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.Oqu(t.quantity)}}function Se(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Total Cost"),e.qZA())}function Ne(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.quantity*t.itemPrice,"USD")," ")}}function Ue(o,i){1&o&&e._UZ(0,"th",64)}function ke(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"td",65),e.TgZ(1,"button",66),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().removeItemFromBill(l)}),e.TgZ(2,"mat-icon"),e._uU(3,"close"),e.qZA(),e.qZA(),e.qZA()}}function Re(o,i){1&o&&e._UZ(0,"tr",67)}function Fe(o,i){1&o&&e._UZ(0,"tr",68),2&o&&e.ekj("grey",i.even)}function Me(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Total Amount"),e.qZA())}function Ye(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.totalAmount,"USD")," ")}}function Qe(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Discount"),e.qZA())}function Be(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.Oqu(t.discount)}}function Pe(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Delivery"),e.qZA())}function $e(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" +",e.xi3(2,1,t.deliveryCharges,"USD")," ")}}function Je(o,i){1&o&&(e.TgZ(0,"th",64),e._uU(1,"Advance"),e.qZA())}function Le(o,i){if(1&o&&(e.TgZ(0,"td",65),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" -",e.xi3(2,1,t.advancePayment,"USD")," ")}}function je(o,i){1&o&&(e.TgZ(0,"th",69),e._uU(1," Net Bill Amount "),e.qZA())}function Ee(o,i){if(1&o&&(e.TgZ(0,"td",70),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.billAmount-t.advancePayment,"USD")," ")}}function Ge(o,i){1&o&&e._UZ(0,"tr",67)}function He(o,i){1&o&&e._UZ(0,"tr",68)}let H=(()=>{class o{constructor(t,r,n,l,d,c){this.dialogRef=t,this.helperService=r,this.customerService=n,this.itemService=l,this.orderService=d,this.orderData=c,this.MONTHS=p.zC,this.viewBillItems=[],this.enableItemAddButton=!1,this.iemRemovedFromBill$=new ce.xQ,this.displayedColumns=["id","name","price","quantity","total","actions"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.subscriptions=new N.w}ngOnInit(){this.orderData?(this.formType="Update",this.selectedCustomerId=this.orderData.customer._id):this.formType="Add",this.initCustomerForm(),this.initItemForm(),this.initBillItemTable(),this.calculateBillData(),this.customerList$=(0,U.aj)([this.customerService.getAllCustomers(),this.orderCustomerForm.get("name").valueChanges.pipe((0,y.O)(""))]).pipe((0,j.U)(([r,n])=>{if(r)return this._customerListFilter(r,n)})),this.itemList$=(0,U.aj)([this.itemService.getAllItems(),this.orderItemForm.get("name").valueChanges.pipe((0,y.O)(""))]).pipe((0,ue.b)(()=>{this.enableItemAddButton=!1,this.selectedItem=null}),(0,j.U)(([r,n])=>{if(r)return this._itemListFilter(r,n)}));const t=(0,U.aj)([this.orderItemForm.get("discount").valueChanges.pipe((0,y.O)(0)),this.orderItemForm.get("advancePayment").valueChanges.pipe((0,y.O)(0)),this.orderItemForm.get("deliveryCharges").valueChanges.pipe((0,y.O)(0))]).subscribe(()=>{this.calculateBillData()});this.subscriptions.add(t)}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}executeAction(){"Add"===this.formType?this.addNewOrder():this.updateOrder()}calculateBillData(){if(this.billData=[],this.viewBillItems.length){const t=this.viewBillItems.map(c=>c.itemPrice*c.quantity).reduce((c,u)=>c+u,0);let r=this.orderItemForm.get("discount").value;r=r||0;let n=this.orderItemForm.get("advancePayment").value;n=n||0;let l=this.orderItemForm.get("deliveryCharges").value;l=l||0;const d=t-r/100*t+l;this.orderItemForm.get("advancePayment").setValidators(a.kI.max(d)),this.orderItemForm.get("advancePayment").updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this.billData.push({totalAmount:t,discount:`-$${r/100*t} (${r}%)`,billAmount:d,advancePayment:n,deliveryCharges:l})}}updateBillTable(){this.calculateBillData(),this.billTable.renderRows()}addNewOrder(){return(0,g.mG)(this,void 0,void 0,function*(){const t=yield this.generateNewOrderObject();yield this.orderService.addOrder(t),this.closeDialog()})}updateOrder(){return(0,g.mG)(this,void 0,void 0,function*(){const t=yield this.generateNewOrderObject();yield this.orderService.updateOrder(this.orderData._id,t),this.closeDialog()})}autoFillCustomerForm(t){this.orderCustomerForm.patchValue({name:t.name,mobile:t.mobile,address:t.address,email:t.email}),t.birthday&&this.orderCustomerForm.patchValue({birthday:{day:t.birthday.day,month:t.birthday.month}}),t.anniversary&&this.orderCustomerForm.patchValue({anniversary:{day:t.anniversary.day,month:t.anniversary.month}}),this.selectedCustomerId=t._id,this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable()}addNewCustomer(){return(0,g.mG)(this,void 0,void 0,function*(){const t=this.getOrderCustomerFormData(),r=yield this.customerService.addCustomer(t);this.selectedCustomerId=r._id})}resetCustomerForm(){this.orderCustomerForm.enable(),this.orderCustomerForm.reset(),this.selectedCustomerId=null}selectItem(t){this.selectedItem=this.helperService._clone(t),this.enableItemAddButton=!0}addItemToBill(){const t={item:this.selectedItem,itemPrice:this.selectedItem.price,quantity:this.getItemQuantityFromForm()};this.viewBillItems.push(t),this.updateBillTable(),this.enableItemAddButton=!1,this.selectedItem=null,this.orderItemForm.get("name").reset(),this.orderItemForm.get("quantity").reset(),this.itemTable.renderRows()}removeItemFromBill(t){this.viewBillItems=this.viewBillItems.filter(r=>r.item._id!==t.item._id),this.itemTable.renderRows(),this.updateBillTable(),this.orderItemForm.get("name").updateValueAndValidity()}resetItemForm(){this.orderItemForm.reset({discount:0,advancePayment:0,deliveryCharges:0,deliveryDate:this._getBrowserDateTimeString()}),this.selectedItem=null,this.enableItemAddButton=!1,this.viewBillItems=[],this.billData=[]}clearItemSelection(){this.orderItemForm.get("name").reset(),this.orderItemForm.get("quantity").reset(),this.enableItemAddButton=!1}closeDialog(){this.dialogRef.close()}enableAction(){return this.orderCustomerForm.valid&&(this.orderCustomerForm.dirty||this.orderItemForm.dirty||this.viewBillItems.length!==this.orderData.billItems.length)&&this.viewBillItems.length&&this.billData.length&&!this.enableItemAddButton&&this.orderItemForm.valid}generateNewOrderObject(){return(0,g.mG)(this,void 0,void 0,function*(){const t=this.viewBillItems.map(n=>({item:n.item._id,itemPrice:n.itemPrice,quantity:n.quantity}));return this.selectedCustomerId||(yield this.addNewCustomer()),{customer:this.selectedCustomerId,billItems:t,billAmount:this.billData[0].billAmount,discount:this.orderItemForm.get("discount").value,advancePayment:this.orderItemForm.get("advancePayment").value,deliveryCharges:this.orderItemForm.get("deliveryCharges").value,deliveryDate:new Date(this.orderItemForm.get("deliveryDate").value).toISOString(),paymentCompleted:this.billData[0].advancePayment===this.billData[0].billAmount}})}initCustomerForm(){"Add"===this.formType?this.orderCustomerForm=new a.cw({name:new a.NI(null,[a.kI.required.bind(this),k.F]),mobile:new a.NI(null,a.kI.required.bind(this)),address:new a.NI(null),email:new a.NI(null,a.kI.email.bind(this)),birthday:new a.cw({day:new a.NI(null,[a.kI.min(1),a.kI.max(31)]),month:new a.NI(null,[a.kI.min(1),a.kI.max(12)])}),anniversary:new a.cw({day:new a.NI(null,[a.kI.min(1),a.kI.max(31)]),month:new a.NI(null,[a.kI.min(1),a.kI.max(12)])})}):(this.orderCustomerForm=new a.cw({name:new a.NI(this.orderData.customer.name,[a.kI.required.bind(this),k.F]),mobile:new a.NI(this.orderData.customer.mobile,a.kI.required.bind(this)),address:new a.NI(this.orderData.customer.address),email:new a.NI(this.orderData.customer.email,a.kI.email.bind(this)),birthday:new a.cw({day:new a.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.day:null,[a.kI.min(1),a.kI.max(31)]),month:new a.NI(this.orderData.customer.birthday?this.orderData.customer.birthday.month:null,[a.kI.min(1),a.kI.max(12)])}),anniversary:new a.cw({day:new a.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.day:null,[a.kI.min(1),a.kI.max(31)]),month:new a.NI(this.orderData.customer.anniversary?this.orderData.customer.anniversary.month:null,[a.kI.min(1),a.kI.max(12)])})}),this.orderCustomerForm.disable(),this.orderCustomerForm.get("name").enable())}getOrderCustomerFormData(){return this.helperService._clone(this.orderCustomerForm.value)}_customerListFilter(t,r){return r=r||"",t.filter(n=>n.name.toLowerCase().includes(r.toLowerCase()))}initItemForm(){this.orderItemForm=new a.cw({name:new a.NI(null,k.F),quantity:new a.NI(null,a.kI.min(1))}),this.orderItemForm.addControl("discount",new a.NI(this.orderData?this.orderData.discount:0,[a.kI.min(0),a.kI.max(100)])),this.orderItemForm.addControl("advancePayment",new a.NI(this.orderData?this.orderData.advancePayment:0,a.kI.min(0))),this.orderItemForm.addControl("deliveryCharges",new a.NI(this.orderData?this.orderData.deliveryCharges:0,a.kI.min(0)));const l=this.orderData?this._getBrowserDateTimeString(this.orderData.deliveryDate):this._getBrowserDateTimeString();this.orderItemForm.addControl("deliveryDate",new a.NI(l,a.kI.required.bind(this)))}initBillItemTable(){this.orderData&&this.orderData.billItems.forEach(t=>{this.viewBillItems.push({item:t.item,itemPrice:t.itemPrice,quantity:t.quantity})})}getItemQuantityFromForm(){return this.orderItemForm.get("quantity").value}_itemListFilter(t,r){return r=r||"",t.filter(n=>n.name.toLowerCase().includes(r.toLowerCase())&&-1===this.viewBillItems.findIndex(l=>l.item._id===n._id))}_getBrowserDateTimeString(t){let r=new Date;return"string"==typeof t&&(r=new Date(t)),`${r.getFullYear()}-${r.getMonth()+1<10?`0${r.getMonth()+1}`:`${r.getMonth()+1}`}-${r.getDate()<10?`0${r.getDate()}`:`${r.getDate()}`}T${r.getHours()<10?`0${r.getHours()}`:`${r.getHours()}`}:${r.getMinutes()<10?`0${r.getMinutes()}`:`${r.getMinutes()}`}`}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.so),e.Y36(R.W),e.Y36(pe.v),e.Y36(ge.e),e.Y36(M),e.Y36(C.WI))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-order-form"]],viewQuery:function(t,r){if(1&t&&(e.Gf(m.BZ,5),e.Gf(m.BZ,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.itemTable=n.first),e.iGM(n=e.CRH())&&(r.billTable=n.first)}},decls:153,vars:24,consts:[["mat-dialog-title",""],[1,"flex","order-form-container"],[1,"customer-form-container"],[1,"sub-form-heading"],["mat-icon-button","","color","warn",1,"reset-button",3,"click"],["matTooltip","Reset Customer Form"],[3,"formGroup"],[1,"mar-vr-16"],["appearance","fill",1,"full-width"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","name","required","",3,"matAutocomplete"],["autoSuggestCustomers","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["appearance","fill"],["matInput","","type","number","formControlName","mobile","required",""],["matInput","","formControlName","address","placeholder","Ex: #1 Tesla Road, Nikola City"],["matInput","","type","email","placeholder","Ex. nikola@tesla.com","formControlName","email"],[1,"flex-col"],["formGroupName","birthday",1,"occasion-container","mar-right-16"],["appearance","fill",1,"occasion-input"],["matInput","","type","number","formControlName","day"],[1,"input-separator"],["formControlName","month"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","anniversary",1,"occasion-container"],[1,"separator"],[1,"items-form-container"],["matTooltip","Reset Item Form"],[1,"mar-right-8"],["mat-button","","color","warn","matTooltip","Clear Selected Item",3,"disabled","click"],["appearance","fill",1,"mar-right-16"],["type","text","matInput","","placeholder","Ex: Nikola Tesla","formControlName","name",3,"matAutocomplete"],["autoSuggestItems","matAutocomplete"],["type","number","matInput","","placeholder","Ex: 1","formControlName","quantity"],["mat-raised-button","","color","primary","matTooltip","Add Item To Order",3,"disabled","click"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"grey",4,"matRowDef","matRowDefColumns"],[1,"mar-top-32"],["type","number","matInput","","placeholder","Ex: 1","formControlName","discount"],["type","datetime-local","matInput","","formControlName","deliveryDate"],[1,"mar-top-16"],["type","number","matInput","","placeholder","Ex: 1","formControlName","deliveryCharges"],["type","number","matInput","","placeholder","Ex: 1","formControlName","advancePayment"],["matColumnDef","totalAmount"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["matColumnDef","billAmount"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"disabled","click"],[3,"value","click"],[3,"value"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"]],template:function(t,r){if(1&t&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content"),e.TgZ(3,"div",1),e.TgZ(4,"div",2),e.TgZ(5,"h4",3),e._uU(6,"Customer Details"),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return r.resetCustomerForm()}),e.TgZ(8,"mat-icon",5),e._uU(9,"restart_alt"),e.qZA(),e.qZA(),e.TgZ(10,"form",6),e.TgZ(11,"div",7),e.TgZ(12,"mat-form-field",8),e.TgZ(13,"mat-label"),e._uU(14,"Name"),e.qZA(),e._UZ(15,"input",9),e.TgZ(16,"mat-autocomplete",null,10),e.YNc(18,Te,6,3,"mat-option",11),e.ALo(19,"async"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"div",7),e.TgZ(21,"mat-form-field",12),e.TgZ(22,"mat-label"),e._uU(23,"Mobile"),e.qZA(),e._UZ(24,"input",13),e.qZA(),e.qZA(),e.TgZ(25,"div",7),e.TgZ(26,"mat-form-field",8),e.TgZ(27,"mat-label"),e._uU(28,"Address"),e.qZA(),e._UZ(29,"textarea",14),e.qZA(),e.qZA(),e.TgZ(30,"div",7),e.TgZ(31,"mat-form-field",8),e.TgZ(32,"mat-label"),e._uU(33,"Email"),e.qZA(),e._UZ(34,"input",15),e.qZA(),e.qZA(),e.TgZ(35,"div",16),e.TgZ(36,"div",17),e.TgZ(37,"h4"),e._uU(38,"Birthday"),e.qZA(),e.TgZ(39,"mat-form-field",18),e.TgZ(40,"mat-label"),e._uU(41,"Day"),e.qZA(),e._UZ(42,"input",19),e.qZA(),e._UZ(43,"div",20),e.TgZ(44,"mat-form-field",18),e.TgZ(45,"mat-label"),e._uU(46,"Month"),e.qZA(),e.TgZ(47,"mat-select",21),e.YNc(48,Ce,2,2,"mat-option",22),e.qZA(),e.qZA(),e.qZA(),e.TgZ(49,"div",23),e.TgZ(50,"h4"),e._uU(51,"Anniversary"),e.qZA(),e.TgZ(52,"mat-form-field",18),e.TgZ(53,"mat-label"),e._uU(54,"Day"),e.qZA(),e._UZ(55,"input",19),e.qZA(),e._UZ(56,"div",20),e.TgZ(57,"mat-form-field",18),e.TgZ(58,"mat-label"),e._uU(59,"Month"),e.qZA(),e.TgZ(60,"mat-select",21),e.YNc(61,be,2,2,"mat-option",22),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(62,"div",24),e.TgZ(63,"div",25),e.TgZ(64,"h4",3),e._uU(65,"Items Details"),e.qZA(),e.TgZ(66,"button",4),e.NdJ("click",function(){return r.resetItemForm()}),e.TgZ(67,"mat-icon",26),e._uU(68,"restart_alt"),e.qZA(),e.qZA(),e.TgZ(69,"div"),e.TgZ(70,"span",27),e._uU(71,"Choose Item"),e.qZA(),e.TgZ(72,"button",28),e.NdJ("click",function(){return r.clearItemSelection()}),e._uU(73," Clear "),e.qZA(),e.qZA(),e.TgZ(74,"form",6),e.TgZ(75,"div",7),e.TgZ(76,"mat-form-field",29),e.TgZ(77,"mat-label"),e._uU(78,"Item Name"),e.qZA(),e._UZ(79,"input",30),e.TgZ(80,"mat-autocomplete",null,31),e.YNc(82,ve,2,2,"mat-option",11),e.ALo(83,"async"),e.qZA(),e.qZA(),e.TgZ(84,"mat-form-field",29),e.TgZ(85,"mat-label"),e._uU(86,"Quantity"),e.qZA(),e._UZ(87,"input",32),e.qZA(),e.TgZ(88,"button",33),e.NdJ("click",function(){return r.addItemToBill()}),e._uU(89," Add "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(90,"table",34),e.ynx(91,35),e.YNc(92,ye,2,0,"th",36),e.YNc(93,Oe,2,1,"td",37),e.BQk(),e.ynx(94,38),e.YNc(95,xe,2,0,"th",36),e.YNc(96,Ae,2,1,"td",37),e.BQk(),e.ynx(97,39),e.YNc(98,De,2,0,"th",36),e.YNc(99,Ie,3,4,"td",37),e.BQk(),e.ynx(100,40),e.YNc(101,we,2,0,"th",36),e.YNc(102,qe,2,1,"td",37),e.BQk(),e.ynx(103,41),e.YNc(104,Se,2,0,"th",36),e.YNc(105,Ne,3,4,"td",37),e.BQk(),e.ynx(106,42),e.YNc(107,Ue,1,0,"th",36),e.YNc(108,ke,4,0,"td",37),e.BQk(),e.YNc(109,Re,1,0,"tr",43),e.YNc(110,Fe,1,2,"tr",44),e.qZA(),e.TgZ(111,"form",6),e.TgZ(112,"div",45),e.TgZ(113,"mat-form-field",29),e.TgZ(114,"mat-label"),e._uU(115,"Discount %"),e.qZA(),e._UZ(116,"input",46),e.qZA(),e.TgZ(117,"mat-form-field",12),e.TgZ(118,"mat-label"),e._uU(119,"Delivery Date & Time"),e.qZA(),e._UZ(120,"input",47),e.qZA(),e.qZA(),e.TgZ(121,"div",48),e.TgZ(122,"mat-form-field",29),e.TgZ(123,"mat-label"),e._uU(124,"Delivery Charges"),e.qZA(),e._UZ(125,"input",49),e.qZA(),e.TgZ(126,"mat-form-field",29),e.TgZ(127,"mat-label"),e._uU(128,"Advance Payment"),e.qZA(),e._UZ(129,"input",50),e.qZA(),e.qZA(),e.qZA(),e.TgZ(130,"table",34),e.ynx(131,51),e.YNc(132,Me,2,0,"th",36),e.YNc(133,Ye,3,4,"td",37),e.BQk(),e.ynx(134,52),e.YNc(135,Qe,2,0,"th",36),e.YNc(136,Be,2,1,"td",37),e.BQk(),e.ynx(137,53),e.YNc(138,Pe,2,0,"th",36),e.YNc(139,$e,3,4,"td",37),e.BQk(),e.ynx(140,54),e.YNc(141,Je,2,0,"th",36),e.YNc(142,Le,3,4,"td",37),e.BQk(),e.ynx(143,55),e.YNc(144,je,2,0,"th",56),e.YNc(145,Ee,3,4,"td",57),e.BQk(),e.YNc(146,Ge,1,0,"tr",43),e.YNc(147,He,1,0,"tr",58),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(148,"mat-dialog-actions",59),e.TgZ(149,"button",60),e._uU(150,"Cancel"),e.qZA(),e.TgZ(151,"button",61),e.NdJ("click",function(){return r.executeAction()}),e._uU(152),e.qZA(),e.qZA()),2&t){const n=e.MAs(17),l=e.MAs(81);e.xp6(1),e.hij("",r.formType," Order"),e.xp6(9),e.Q6J("formGroup",r.orderCustomerForm),e.xp6(5),e.Q6J("matAutocomplete",n),e.xp6(3),e.Q6J("ngForOf",e.lcZ(19,20,r.customerList$)),e.xp6(30),e.Q6J("ngForOf",r.MONTHS),e.xp6(13),e.Q6J("ngForOf",r.MONTHS),e.xp6(11),e.Q6J("disabled",!r.enableItemAddButton||!(null!=r.orderItemForm&&r.orderItemForm.valid)),e.xp6(2),e.Q6J("formGroup",r.orderItemForm),e.xp6(5),e.Q6J("matAutocomplete",l),e.xp6(3),e.Q6J("ngForOf",e.lcZ(83,22,r.itemList$)),e.xp6(6),e.Q6J("disabled",!r.enableItemAddButton||!(null!=r.orderItemForm&&r.orderItemForm.valid)),e.xp6(2),e.Q6J("dataSource",r.viewBillItems),e.xp6(19),e.Q6J("matHeaderRowDef",r.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.displayedColumns),e.xp6(1),e.Q6J("formGroup",r.orderItemForm),e.xp6(19),e.Q6J("dataSource",r.billData),e.xp6(16),e.Q6J("matHeaderRowDef",r.billDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.billDisplayedColumns),e.xp6(4),e.Q6J("disabled",!r.enableAction()),e.xp6(1),e.hij(" ",r.formType," ")}},directives:[C.uh,C.xY,w.lW,I.Hw,S.gM,a._Y,a.JL,a.sg,f.KE,f.hX,A.Nt,a.Fj,q.ZL,a.JJ,a.u,a.Q7,q.XC,Z.sg,a.wV,a.x0,Q.gD,m.BZ,m.w1,m.fO,m.Dz,m.as,m.nj,C.H8,C.ZT,_.ey,m.ge,m.ev,m.XQ,m.Gk],pipes:[Z.Ov,Z.H9],styles:[".customer-form-container[_ngcontent-%COMP%]{flex:.25 1 auto}.items-form-container[_ngcontent-%COMP%]{flex:1}.sub-form-heading[_ngcontent-%COMP%]{display:inline-block}.reset-button[_ngcontent-%COMP%]{float:right}.occasion-input[_ngcontent-%COMP%]{width:100px}.occasion-container[_ngcontent-%COMP%]{position:relative}.input-separator[_ngcontent-%COMP%]{width:0px;border-right:1px solid rgba(0,0,0,.26);display:inline-block;height:35px;position:absolute;margin-top:8px}.item-description[_ngcontent-%COMP%]{font-size:10px;color:#f5f5f5}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}"]}),o})();var Ve=s(7176),ze=s(7519);const Xe=["pendingPaginator"],We=["pendingSort"],Ke=["soldPaginator"],et=["soldSort"];function tt(o,i){1&o&&(e.TgZ(0,"th",25),e._uU(1,"No."),e.qZA())}function ot(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.index;e.oxw();const r=e.MAs(25);e.xp6(1),e.hij(" ",t+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function rt(o,i){1&o&&(e.TgZ(0,"th",27),e._uU(1,"Name"),e.qZA())}function it(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function nt(o,i){1&o&&(e.TgZ(0,"th",25),e._uU(1,"Total Quantity"),e.qZA())}function at(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function lt(o,i){1&o&&e._UZ(0,"tr",28)}function st(o,i){1&o&&e._UZ(0,"tr",29),2&o&&e.ekj("grey",i.even)}function dt(o,i){1&o&&(e.TgZ(0,"tr",30),e.TgZ(1,"td",31),e._uU(2,"No data found."),e.qZA(),e.qZA())}function mt(o,i){1&o&&(e.TgZ(0,"th",25),e._uU(1,"No."),e.qZA())}function ct(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.index;e.oxw();const r=e.MAs(51);e.xp6(1),e.hij(" ",t+1+(null==r?null:r.pageIndex)*(null==r?null:r.pageSize)," ")}}function ut(o,i){1&o&&(e.TgZ(0,"th",27),e._uU(1,"Name"),e.qZA())}function pt(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function gt(o,i){1&o&&(e.TgZ(0,"th",25),e._uU(1,"Total Quantity"),e.qZA())}function ht(o,i){if(1&o&&(e.TgZ(0,"td",26),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function _t(o,i){1&o&&e._UZ(0,"tr",28)}function ft(o,i){1&o&&e._UZ(0,"tr",29),2&o&&e.ekj("grey",i.even)}function Zt(o,i){1&o&&(e.TgZ(0,"tr",30),e.TgZ(1,"td",31),e._uU(2,"No data found."),e.qZA(),e.qZA())}const V=function(){return[5,10,25,100]};let Tt=(()=>{class o{constructor(t){this.orderService=t,this.displayedColumns=["id","name","quantity"],this.pendingDataSource=new m.by([]),this.soldDataSource=new m.by([]),this.subscriptions=new N.w}ngOnInit(){const t=this.orderService.getOrders().subscribe(r=>{r&&(this.pendingDataSource.data=this.setTableDataSource(r.filter(n=>!n.completed)),this.soldDataSource.data=this.setTableDataSource(r.filter(n=>n.completed)))});this.subscriptions.add(t)}ngAfterViewInit(){this.pendingDataSource.paginator=this.pendingPaginator,this.pendingDataSource.sort=this.pendingSort,this.soldDataSource.paginator=this.soldPaginator,this.soldDataSource.sort=this.soldSort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilterPending(t){this.pendingDataSource.filter=t.target.value.trim().toLowerCase(),this.pendingDataSource.paginator&&this.pendingDataSource.paginator.firstPage()}applyFilterSold(t){this.soldDataSource.filter=t.target.value.trim().toLowerCase(),this.soldDataSource.paginator&&this.soldDataSource.paginator.firstPage()}setTableDataSource(t){const r=new Map,n=[];for(const l of t)for(const d of l.billItems){const c=r.get(d.item.name);c?(c.quantity+=d.quantity,r.set(d.item.name,c)):r.set(d.item.name,{name:d.item.name,quantity:d.quantity})}return r.forEach(l=>{n.push(l)}),n}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-order-total-items"]],viewQuery:function(t,r){if(1&t&&(e.Gf(Xe,5),e.Gf(We,5),e.Gf(Ke,5),e.Gf(et,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.pendingPaginator=n.first),e.iGM(n=e.CRH())&&(r.pendingSort=n.first),e.iGM(n=e.CRH())&&(r.soldPaginator=n.first),e.iGM(n=e.CRH())&&(r.soldSort=n.first)}},decls:52,vars:12,consts:[[1,"total-items","flex"],[1,"items-table-container"],[1,"title","mar-vr-16"],["appearance","outline","color","accent",1,"mar-right-16"],["matInput","","placeholder","Ex. Samosa",3,"keyup"],["inputPending",""],[1,"pending-items-table"],["mat-table","","matSort","",1,"full-width",3,"dataSource"],["pendingSort","matSort"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","quantity"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"grey",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],["pendingPaginator",""],[1,"separator"],["inputSold",""],[1,"sold-items-table"],["soldSort","matSort"],["soldPaginator",""],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._uU(3,"Pending Items"),e.qZA(),e.TgZ(4,"mat-form-field",3),e.TgZ(5,"mat-label"),e._uU(6,"Search"),e.qZA(),e.TgZ(7,"input",4,5),e.NdJ("keyup",function(l){return r.applyFilterPending(l)}),e.qZA(),e.qZA(),e.TgZ(9,"div",6),e.TgZ(10,"table",7,8),e.ynx(12,9),e.YNc(13,tt,2,0,"th",10),e.YNc(14,ot,2,1,"td",11),e.BQk(),e.ynx(15,12),e.YNc(16,rt,2,0,"th",13),e.YNc(17,it,2,1,"td",11),e.BQk(),e.ynx(18,14),e.YNc(19,nt,2,0,"th",10),e.YNc(20,at,2,1,"td",11),e.BQk(),e.YNc(21,lt,1,0,"tr",15),e.YNc(22,st,1,2,"tr",16),e.YNc(23,dt,3,0,"tr",17),e.qZA(),e._UZ(24,"mat-paginator",18,19),e.qZA(),e.qZA(),e._UZ(26,"div",20),e.TgZ(27,"div",1),e.TgZ(28,"div",2),e._uU(29,"Prepared Items"),e.qZA(),e.TgZ(30,"mat-form-field",3),e.TgZ(31,"mat-label"),e._uU(32,"Search"),e.qZA(),e.TgZ(33,"input",4,21),e.NdJ("keyup",function(l){return r.applyFilterSold(l)}),e.qZA(),e.qZA(),e.TgZ(35,"div",22),e.TgZ(36,"table",7,23),e.ynx(38,9),e.YNc(39,mt,2,0,"th",10),e.YNc(40,ct,2,1,"td",11),e.BQk(),e.ynx(41,12),e.YNc(42,ut,2,0,"th",13),e.YNc(43,pt,2,1,"td",11),e.BQk(),e.ynx(44,14),e.YNc(45,gt,2,0,"th",10),e.YNc(46,ht,2,1,"td",11),e.BQk(),e.YNc(47,_t,1,0,"tr",15),e.YNc(48,ft,1,2,"tr",16),e.YNc(49,Zt,3,0,"tr",17),e.qZA(),e._UZ(50,"mat-paginator",18,24),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(10),e.Q6J("dataSource",r.pendingDataSource),e.xp6(11),e.Q6J("matHeaderRowDef",r.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.displayedColumns),e.xp6(2),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(10,V)),e.xp6(12),e.Q6J("dataSource",r.soldDataSource),e.xp6(11),e.Q6J("matHeaderRowDef",r.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.displayedColumns),e.xp6(2),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(11,V)))},directives:[f.KE,f.hX,A.Nt,m.BZ,v.YE,m.w1,m.fO,m.Dz,m.as,m.nj,m.Ee,x.NW,m.ge,m.ev,v.nU,m.XQ,m.Gk],styles:[".title[_ngcontent-%COMP%]{font-weight:500}.items-table-container[_ngcontent-%COMP%]{flex:1}"]}),o})();function Ct(o,i){1&o&&(e.TgZ(0,"mat-icon",47),e._uU(1,"unfold_more"),e.qZA())}function bt(o,i){1&o&&(e.TgZ(0,"mat-icon",48),e._uU(1,"unfold_less"),e.qZA())}function vt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"No."),e.qZA())}function yt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.qZA()),2&o){const t=i.dataIndex,r=e.oxw();e.xp6(1),e.hij(" ",t+1+(null==r.paginator?null:r.paginator.pageIndex)*(null==r.paginator?null:r.paginator.pageSize)," ")}}function Ot(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Customer Name"),e.qZA())}function xt(o,i){1&o&&(e.TgZ(0,"mat-icon",53),e._uU(1,"label_important"),e.qZA())}function At(o,i){if(1&o&&(e.TgZ(0,"td",51),e._uU(1),e.YNc(2,xt,2,0,"mat-icon",52),e.qZA()),2&o){const t=i.$implicit,r=e.oxw();e.xp6(1),e.hij(" ",t.customer.name," "),e.xp6(1),e.Q6J("ngIf",r.isCustomerOccasion(t.customer.birthday)||r.isCustomerOccasion(t.customer.anniversary))}}function Dt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Items"),e.qZA())}function It(o,i){1&o&&(e.TgZ(0,"span"),e._uU(1,"+ 1 other"),e.qZA())}function wt(o,i){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("+ ",t.billItems.length-1," others")}}function qt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.YNc(2,It,2,0,"span",44),e.YNc(3,wt,2,1,"span",44),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.billItems[0].item.name," "),e.xp6(1),e.Q6J("ngIf",2===t.billItems.length),e.xp6(1),e.Q6J("ngIf",t.billItems.length>2)}}function St(o,i){1&o&&(e.TgZ(0,"th",54),e._uU(1," Net Amount "),e.qZA())}function Nt(o,i){if(1&o&&(e.TgZ(0,"td",55),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.billAmount-t.advancePayment,"USD")," ")}}function Ut(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Created At"),e.qZA())}function kt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.createdAt,"MMM d, hh:mm a")," ")}}function Rt(o,i){1&o&&(e.TgZ(0,"th",56),e._uU(1,"Delivery By"),e.qZA())}function Ft(o,i){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.deliveryDate,"MMM d, hh:mm a")," ")}}function Mt(o,i){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.deliveryDate,"shortTime")," ")}}function Yt(o,i){if(1&o&&(e.TgZ(0,"td",50),e.YNc(1,Ft,3,4,"span",44),e.YNc(2,Mt,3,4,"span",44),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.orderDateRange.value.end),e.xp6(1),e.Q6J("ngIf",!t.orderDateRange.value.end)}}function Qt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Status"),e.qZA())}function Bt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.completed?"Done":"Pending"," ")}}function Pt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Actions"),e.qZA())}function $t(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",62),e.NdJ("click",function(n){e.CHM(t);const l=e.oxw().$implicit;return e.oxw().completeOrder(l),n.stopPropagation()}),e.TgZ(1,"mat-icon"),e._uU(2,"done"),e.qZA(),e.qZA()}}function Jt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(n){e.CHM(t);const l=e.oxw().$implicit;return e.oxw().paymentCompleteOrder(l),n.stopPropagation()}),e.TgZ(1,"mat-icon"),e._uU(2,"price_check"),e.qZA(),e.qZA()}}function Lt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"td",50),e.TgZ(1,"div",57),e.YNc(2,$t,3,0,"button",58),e.YNc(3,Jt,3,0,"button",59),e.TgZ(4,"button",60),e.NdJ("click",function(n){const d=e.CHM(t).$implicit;return e.oxw().updateOrder(d),n.stopPropagation()}),e.TgZ(5,"mat-icon"),e._uU(6,"edit"),e.qZA(),e.qZA(),e.TgZ(7,"button",61),e.NdJ("click",function(n){const d=e.CHM(t).$implicit;return e.oxw().deleteOrder(d),n.stopPropagation()}),e.TgZ(8,"mat-icon"),e._uU(9,"delete"),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=i.$implicit;e.xp6(2),e.Q6J("ngIf",!t.completed),e.xp6(1),e.Q6J("ngIf",!t.paymentCompleted)}}function jt(o,i){if(1&o&&(e.TgZ(0,"mat-card-header"),e.TgZ(1,"div",66),e.TgZ(2,"a",84),e.TgZ(3,"mat-icon"),e._uU(4,"location_on"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(5,"mat-card-title",67),e._uU(6),e.qZA(),e.TgZ(7,"mat-card-subtitle",68),e._uU(8,"Address"),e.qZA(),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("href","https://www.google.com/maps/place/"+t.customer.address,e.LSH),e.xp6(4),e.hij("",t.customer.address," ")}}function Et(o,i){if(1&o&&(e.TgZ(0,"mat-card-header"),e.TgZ(1,"div",66),e.TgZ(2,"mat-icon"),e._uU(3,"alternate_email"),e.qZA(),e.qZA(),e.TgZ(4,"mat-card-title",67),e._uU(5),e.qZA(),e.TgZ(6,"mat-card-subtitle",68),e._uU(7,"Email"),e.qZA(),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(5),e.hij("",t.customer.email," ")}}function Gt(o,i){if(1&o&&(e.TgZ(0,"mat-card-header"),e.TgZ(1,"div",66),e.TgZ(2,"mat-icon"),e._uU(3,"cake"),e.qZA(),e.qZA(),e.TgZ(4,"mat-card-title",67),e._uU(5),e.qZA(),e.TgZ(6,"mat-card-subtitle",68),e._uU(7,"Birthday"),e.qZA(),e.qZA()),2&o){const t=e.oxw().$implicit,r=e.oxw();e.xp6(5),e.hij("",r.getDateString(t.customer.birthday)," ")}}function Ht(o,i){if(1&o&&(e.TgZ(0,"mat-card-header"),e.TgZ(1,"div",66),e.TgZ(2,"mat-icon"),e._uU(3,"celebration"),e.qZA(),e.qZA(),e.TgZ(4,"mat-card-title",67),e._uU(5),e.qZA(),e.TgZ(6,"mat-card-subtitle",68),e._uU(7,"Anniversary"),e.qZA(),e.qZA()),2&o){const t=e.oxw().$implicit,r=e.oxw();e.xp6(5),e.hij("",r.getDateString(t.customer.anniversary)," ")}}function Vt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"No."),e.qZA())}function zt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.qZA()),2&o){const t=i.index;e.xp6(1),e.hij(" ",t+1," ")}}function Xt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Name"),e.qZA())}function Wt(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.item.name," ")}}function Kt(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Price"),e.qZA())}function eo(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.itemPrice,"USD")," ")}}function to(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Quantity"),e.qZA())}function oo(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function ro(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Total Cost"),e.qZA())}function io(o,i){if(1&o&&(e.TgZ(0,"td",50),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.quantity*t.itemPrice,"USD")," ")}}function no(o,i){1&o&&e._UZ(0,"tr",85)}function ao(o,i){1&o&&e._UZ(0,"tr",86),2&o&&e.ekj("grey",i.even)}function lo(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Total Amount"),e.qZA())}function so(o,i){if(1&o&&(e.TgZ(0,"td",87),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,100*(t.billAmount-t.deliveryCharges)/(100-t.discount),"USD")," ")}}function mo(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Discount"),e.qZA())}function co(o,i){if(1&o&&(e.TgZ(0,"td",87),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" -",e.xi3(2,1,t.discount*(t.billAmount-t.deliveryCharges)/(100-t.discount),"USD")," ")}}function uo(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Delivery"),e.qZA())}function po(o,i){if(1&o&&(e.TgZ(0,"td",87),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" +",e.xi3(2,1,t.deliveryCharges,"USD")," ")}}function go(o,i){1&o&&(e.TgZ(0,"th",49),e._uU(1,"Advance"),e.qZA())}function ho(o,i){if(1&o&&(e.TgZ(0,"td",87),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" -",e.xi3(2,1,t.advancePayment,"USD")," ")}}function _o(o,i){1&o&&(e.TgZ(0,"th",88),e._uU(1," Net Bill Amount "),e.qZA())}function fo(o,i){if(1&o&&(e.TgZ(0,"td",89),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.billAmount-t.advancePayment,"USD")," ")}}function Zo(o,i){1&o&&e._UZ(0,"tr",85)}function To(o,i){1&o&&e._UZ(0,"tr",86)}const Co=function(o){return[o]};function bo(o,i){if(1&o&&(e.TgZ(0,"td",50),e.TgZ(1,"div",64),e.TgZ(2,"mat-card",65),e.TgZ(3,"mat-card-header"),e.TgZ(4,"div",66),e.TgZ(5,"mat-icon"),e._uU(6,"face"),e.qZA(),e.qZA(),e.TgZ(7,"mat-card-title",67),e._uU(8),e.qZA(),e.TgZ(9,"mat-card-subtitle",68),e._uU(10,"Name"),e.qZA(),e.qZA(),e.YNc(11,jt,9,2,"mat-card-header",44),e.TgZ(12,"mat-card-header"),e.TgZ(13,"div",66),e.TgZ(14,"mat-icon"),e._uU(15,"smartphone"),e.qZA(),e.qZA(),e.TgZ(16,"mat-card-title",67),e._uU(17),e.qZA(),e.TgZ(18,"mat-card-subtitle",68),e._uU(19,"Mobile"),e.qZA(),e.qZA(),e.YNc(20,Et,8,1,"mat-card-header",44),e.YNc(21,Gt,8,1,"mat-card-header",44),e.YNc(22,Ht,8,1,"mat-card-header",44),e.qZA(),e.TgZ(23,"mat-card",69),e.TgZ(24,"mat-card-content"),e.TgZ(25,"table",70),e.ynx(26,24),e.YNc(27,Vt,2,0,"th",25),e.YNc(28,zt,2,1,"td",26),e.BQk(),e.ynx(29,71),e.YNc(30,Xt,2,0,"th",25),e.YNc(31,Wt,2,1,"td",26),e.BQk(),e.ynx(32,72),e.YNc(33,Kt,2,0,"th",25),e.YNc(34,eo,3,4,"td",26),e.BQk(),e.ynx(35,73),e.YNc(36,to,2,0,"th",25),e.YNc(37,oo,2,1,"td",26),e.BQk(),e.ynx(38,74),e.YNc(39,ro,2,0,"th",25),e.YNc(40,io,3,4,"td",26),e.BQk(),e.YNc(41,no,1,0,"tr",39),e.YNc(42,ao,1,2,"tr",75),e.qZA(),e.TgZ(43,"table",70),e.ynx(44,76),e.YNc(45,lo,2,0,"th",25),e.YNc(46,so,3,4,"td",77),e.BQk(),e.ynx(47,78),e.YNc(48,mo,2,0,"th",25),e.YNc(49,co,3,4,"td",77),e.BQk(),e.ynx(50,79),e.YNc(51,uo,2,0,"th",25),e.YNc(52,po,3,4,"td",77),e.BQk(),e.ynx(53,80),e.YNc(54,go,2,0,"th",25),e.YNc(55,ho,3,4,"td",77),e.BQk(),e.ynx(56,30),e.YNc(57,_o,2,0,"th",81),e.YNc(58,fo,3,4,"td",82),e.BQk(),e.YNc(59,Zo,1,0,"tr",39),e.YNc(60,To,1,0,"tr",83),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o){const t=i.$implicit,r=e.oxw();e.uIk("colspan",r.displayedColumns.length),e.xp6(1),e.Q6J("@detailExpand",r.checkExpanded(t._id)?"expanded":"collapsed"),e.xp6(7),e.hij("",t.customer.name," "),e.xp6(3),e.Q6J("ngIf",t.customer.address),e.xp6(6),e.hij("",t.customer.mobile," "),e.xp6(3),e.Q6J("ngIf",t.customer.email),e.xp6(1),e.Q6J("ngIf",t.customer.birthday),e.xp6(1),e.Q6J("ngIf",t.customer.anniversary),e.xp6(3),e.Q6J("dataSource",t.billItems),e.xp6(16),e.Q6J("matHeaderRowDef",r.itemDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.itemDisplayedColumns),e.xp6(1),e.Q6J("dataSource",e.VKq(14,Co,t)),e.xp6(16),e.Q6J("matHeaderRowDef",r.billDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.billDisplayedColumns)}}function vo(o,i){1&o&&e._UZ(0,"tr",85)}function yo(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"tr",90),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().toggleRowExpand(l._id)}),e.qZA()}if(2&o){const t=i.$implicit,r=e.oxw();e.ekj("order-expanded-row",r.checkExpanded(t._id))("order-completed-row",t.completed)("order-time-warning-row",!t.completed&&r.isOrderTimeWarning(t.deliveryDate))("order-overdue-warning-row",!t.completed&&r.isOrderOverdue(t.deliveryDate))}}function Oo(o,i){1&o&&e._UZ(0,"tr",91)}function xo(o,i){1&o&&(e.TgZ(0,"tr",92),e.TgZ(1,"td",93),e._uU(2,"No data found."),e.qZA(),e.qZA())}function Ao(o,i){1&o&&e._UZ(0,"app-order-total-items")}const Do=function(){return["expandedDetail"]},Io=function(){return[5,10,25,100]},wo=[{path:"",component:(()=>{class o{constructor(t,r,n){this.orderService=t,this.dialogService=r,this.helperService=n,this.displayedColumns=["id","customerName","items","billAmount","timeCreated","deliveryDate","status","actions"],this.itemDisplayedColumns=["id","name","price","quantity","total"],this.billDisplayedColumns=["totalAmount","discount","deliveryCharges","advancePayment","billAmount"],this.dataSource=new m.by([]),this.expandedOrderRows=[],this.allOrdersList=[],this.isShowCompletedOrders=!0,this.totalRevenue=0,this.totalItemsSold=0,this.subscriptions=new N.w}ngOnInit(){const t=this.orderService.getOrders().subscribe(n=>{n&&(this.allOrdersList=this.helperService._clone(n),this.updateDataSource(),this.updateOrderSummary())});this.initDateRange();const r=this.orderDateRange.valueChanges.pipe((0,ze.x)(this.isDateSame.bind(this))).subscribe(n=>{this.orderService.updateOrderDateRange(n.start,n.end)});this.subscriptions.add(t),this.subscriptions.add(r)}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnDestroy(){this.subscriptions&&this.subscriptions.unsubscribe()}applyFilter(t){this.dataSource.filter=t.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}checkExpanded(t){return this.expandedOrderRows.includes(t)}toggleRowExpand(t){const r=this.expandedOrderRows.indexOf(t);-1===r?this.expandedOrderRows.push(t):this.expandedOrderRows.splice(r,1)}toggleAllRowsExpand(){this.expandedOrderRows=this.expandedOrderRows.length?[]:this.allOrdersList.map(t=>t._id)}addOrder(){this.dialogService.openDialog(H,p.ib.order)}updateOrder(t){this.dialogService.openDialog(H,Object.assign(Object.assign({},p.ib.order),{data:t}))}completeOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(t._id,{completed:!0})})}paymentCompleteOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){yield this.orderService.updateOrder(t._id,{paymentCompleted:!0})})}deleteOrder(t){return(0,g.mG)(this,void 0,void 0,function*(){(yield this.dialogService.openDialog(Ve.z,Object.assign(Object.assign({},p.ib.confirmationDialog),{data:{type:"warning",action:"delete",entity:"order"}})).afterClosed().toPromise())&&(yield this.orderService.deleteOrder(t._id))})}isOrderTimeWarning(t){const r=(new Date).getTime(),n=new Date(t).getTime();return n>=r&&n-r<=18e5}isOrderOverdue(t){const r=(new Date).getTime();return new Date(t).getTime()<=r}isCustomerOccasion(t){if(t){const r=new Date;return r.getDate()===t.day&&r.getMonth()+1===t.month}}getDateString(t){if(t)return`${p.zC.find(r=>r.value===t.month).name}, ${t.day}`}toggleCompletedOrders(){this.isShowCompletedOrders=!this.isShowCompletedOrders,this.updateDataSource()}getNumberOfOrders(t){return t?this.allOrdersList.filter(r=>r.completed).length:this.allOrdersList.filter(r=>!r.completed).length}gotToAdjacentDay(t){const r=this.orderDateRange.get("start").value;if("next"===t){const n=new Date(r.getTime());n.setDate(n.getDate()+1),this.orderDateRange.get("start").patchValue(n)}else{const n=new Date(r.getTime());n.setDate(n.getDate()-1),this.orderDateRange.get("start").patchValue(n)}}initDateRange(){const t=this.orderService.getCurrentDateRange();this.orderDateRange=new a.cw({start:new a.NI(t.startDate),end:new a.NI(t.endDate)})}updateDataSource(){if(this.allOrdersList.length){let t=this.allOrdersList.filter(r=>!r.completed);this.isShowCompletedOrders&&(t=[...t,...this.allOrdersList.filter(r=>r.completed)]),this.dataSource.data=t}else this.dataSource.data=[]}updateOrderSummary(){const t=this.allOrdersList.filter(l=>l.completed);let r=0,n=0;for(const l of t){for(const d of l.billItems)r+=d.quantity;n+=l.billAmount}this.totalRevenue=n,this.totalItemsSold=r}isDateSame(t,r){return t.start===r.start&&t.end===r.end}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M),e.Y36(G.x),e.Y36(R.W))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-orders"]],viewQuery:function(t,r){if(1&t&&(e.Gf(x.NW,5),e.Gf(v.YE,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.paginator=n.first),e.iGM(n=e.CRH())&&(r.sort=n.first)}},decls:80,vars:24,consts:[[1,"order-container","mar-top-16"],[1,"orders","mar-bottom-8"],["appearance","outline","color","accent",1,"mar-right-16"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],["mat-button","","matDateRangePickerCancel",""],["mat-raised-button","","color","primary","matDateRangePickerApply",""],["matInput","","placeholder","Ex. Nikola Tesla",3,"keyup"],["input",""],["color","accent",1,"all-orders-toggle",3,"checked","click"],[1,"order-summary","mar-bottom-16"],[1,"mar-right-16","order-info"],[1,"mar-right-16"],["mat-icon-button","","color","accent",3,"click"],["matTooltip","Expand Rows",4,"ngIf"],["matTooltip","Collapse Rows",4,"ngIf"],["mat-icon-button","","color","accent",3,"disabled","click"],["matTooltip","Previous Day",1,"day-switch-icons"],["matTooltip","Next Day",1,"day-switch-icons"],[1,"orders-table"],["mat-table","","matSort","","multiTemplateDataRows","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","customerName"],["mat-cell","","class","order-customer-name",4,"matCellDef"],["matColumnDef","items"],["matColumnDef","billAmount"],["mat-header-cell","","mat-sort-header","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","net-bill-column",4,"matCellDef"],["matColumnDef","timeCreated"],["matColumnDef","deliveryDate"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","order-row",3,"order-expanded-row","order-completed-row","order-time-warning-row","order-overdue-warning-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","order-detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSize","pageSizeOptions"],[4,"ngIf"],["mat-fab","","color","primary",1,"menu-button",3,"click"],["matTooltip","Add New"],["matTooltip","Expand Rows"],["matTooltip","Collapse Rows"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"order-customer-name"],["color","accent","class","order-customer-occasion pad-left-8",4,"ngIf"],["color","accent",1,"order-customer-occasion","pad-left-8"],["mat-header-cell","","mat-sort-header","",1,"net-bill-column"],["mat-cell","",1,"net-bill-column"],["mat-header-cell","","mat-sort-header",""],[1,"flex"],["mat-icon-button","","matTooltip","Complete Order",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-icon-button","","matTooltip","Complete Order",3,"click"],["mat-icon-button","","color","accent","matTooltip","Complete Payment",3,"click"],[1,"order-expanded-detail-row"],[1,"customer-card","mar-16"],["mat-card-avatar",""],[1,"customer-card-title"],[1,"customer-card-subtitle"],[1,"item-card","mar-16"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","total"],["mat-row","",3,"grey",4,"matRowDef","matRowDefColumns"],["matColumnDef","totalAmount"],["mat-cell","","class","total-table-cell",4,"matCellDef"],["matColumnDef","discount"],["matColumnDef","deliveryCharges"],["matColumnDef","advancePayment"],["mat-header-cell","","class","net-bill-column",4,"matHeaderCellDef"],["mat-cell","","class","total-table-cell net-bill-column",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["target","_blank",1,"direction-icon",3,"href"],["mat-header-row",""],["mat-row",""],["mat-cell","",1,"total-table-cell"],["mat-header-cell","",1,"net-bill-column"],["mat-cell","",1,"total-table-cell","net-bill-column"],["mat-row","",1,"order-row",3,"click"],["mat-row","",1,"order-detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(t,r){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"mat-form-field",2),e.TgZ(3,"mat-label"),e._uU(4,"Enter a date range"),e.qZA(),e.TgZ(5,"mat-date-range-input",3),e._UZ(6,"input",4),e._UZ(7,"input",5),e.qZA(),e._UZ(8,"mat-datepicker-toggle",6),e.TgZ(9,"mat-date-range-picker",null,7),e.TgZ(11,"mat-date-range-picker-actions"),e.TgZ(12,"button",8),e._uU(13,"Cancel"),e.qZA(),e.TgZ(14,"button",9),e._uU(15," Apply "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"mat-form-field",2),e.TgZ(17,"mat-label"),e._uU(18,"Search"),e.qZA(),e.TgZ(19,"input",10,11),e.NdJ("keyup",function(l){return r.applyFilter(l)}),e.qZA(),e.qZA(),e.TgZ(21,"mat-slide-toggle",12),e.NdJ("click",function(){return r.toggleCompletedOrders()}),e._uU(22," Show Completed Orders "),e.qZA(),e.TgZ(23,"div"),e.TgZ(24,"div",13),e.TgZ(25,"span",14),e._uU(26),e.qZA(),e.TgZ(27,"span",15),e._uU(28),e.qZA(),e.TgZ(29,"span",15),e._uU(30),e.qZA(),e.TgZ(31,"span",15),e._uU(32),e.ALo(33,"currency"),e.qZA(),e.qZA(),e.TgZ(34,"button",16),e.NdJ("click",function(){return r.toggleAllRowsExpand()}),e.YNc(35,Ct,2,0,"mat-icon",17),e.YNc(36,bt,2,0,"mat-icon",18),e.qZA(),e.TgZ(37,"button",19),e.NdJ("click",function(){return r.gotToAdjacentDay("previous")}),e.TgZ(38,"mat-icon",20),e._uU(39,"arrow_left"),e.qZA(),e.qZA(),e.TgZ(40,"button",19),e.NdJ("click",function(){return r.gotToAdjacentDay("next")}),e.TgZ(41,"mat-icon",21),e._uU(42,"arrow_right"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(43,"div",22),e.TgZ(44,"table",23),e.ynx(45,24),e.YNc(46,vt,2,0,"th",25),e.YNc(47,yt,2,1,"td",26),e.BQk(),e.ynx(48,27),e.YNc(49,Ot,2,0,"th",25),e.YNc(50,At,3,2,"td",28),e.BQk(),e.ynx(51,29),e.YNc(52,Dt,2,0,"th",25),e.YNc(53,qt,4,3,"td",26),e.BQk(),e.ynx(54,30),e.YNc(55,St,2,0,"th",31),e.YNc(56,Nt,3,4,"td",32),e.BQk(),e.ynx(57,33),e.YNc(58,Ut,2,0,"th",25),e.YNc(59,kt,3,4,"td",26),e.BQk(),e.ynx(60,34),e.YNc(61,Rt,2,0,"th",35),e.YNc(62,Yt,3,2,"td",26),e.BQk(),e.ynx(63,36),e.YNc(64,Qt,2,0,"th",25),e.YNc(65,Bt,2,1,"td",26),e.BQk(),e.ynx(66,37),e.YNc(67,Pt,2,0,"th",25),e.YNc(68,Lt,10,2,"td",26),e.BQk(),e.ynx(69,38),e.YNc(70,bo,61,16,"td",26),e.BQk(),e.YNc(71,vo,1,0,"tr",39),e.YNc(72,yo,1,8,"tr",40),e.YNc(73,Oo,1,0,"tr",41),e.YNc(74,xo,3,0,"tr",42),e.qZA(),e._UZ(75,"mat-paginator",43),e.qZA(),e.qZA(),e.YNc(76,Ao,1,0,"app-order-total-items",44),e.qZA(),e.TgZ(77,"button",45),e.NdJ("click",function(){return r.addOrder()}),e.TgZ(78,"mat-icon",46),e._uU(79,"receipt"),e.qZA(),e.qZA()),2&t){const n=e.MAs(10);e.xp6(5),e.Q6J("formGroup",r.orderDateRange)("rangePicker",n),e.xp6(3),e.Q6J("for",n),e.xp6(13),e.Q6J("checked",!0),e.xp6(5),e.hij("Pending Orders: ",r.getNumberOfOrders(!1),""),e.xp6(2),e.hij("Completed Orders: ",r.getNumberOfOrders(!0),""),e.xp6(2),e.hij("Total Items Sold: ",r.totalItemsSold,""),e.xp6(2),e.hij("Total Revenue: ",e.xi3(33,19,r.totalRevenue,"USD"),""),e.xp6(3),e.Q6J("ngIf",!r.expandedOrderRows.length),e.xp6(1),e.Q6J("ngIf",r.expandedOrderRows.length),e.xp6(1),e.Q6J("disabled",r.orderDateRange.value.end),e.xp6(3),e.Q6J("disabled",r.orderDateRange.value.end),e.xp6(4),e.Q6J("dataSource",r.dataSource),e.xp6(27),e.Q6J("matHeaderRowDef",r.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",r.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(22,Do)),e.xp6(2),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(23,Io)),e.xp6(1),e.Q6J("ngIf",r.allOrdersList.length)}},directives:[f.KE,f.hX,h.wx,a.JL,a.sg,h.zY,a.Fj,a.JJ,a.u,h.By,h.nW,f.R9,h._g,h.M5,w.lW,h.dp,h.DK,A.Nt,$,Z.O5,I.Hw,S.gM,m.BZ,v.YE,m.w1,m.fO,m.Dz,m.as,m.nj,m.Ee,x.NW,m.ge,m.ev,v.nU,T.a8,T.dk,T.kc,T.n5,T.$j,T.dn,m.XQ,m.Gk,Tt],pipes:[Z.H9,Z.uU],styles:["tr.order-detail-row[_ngcontent-%COMP%]{height:0}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):hover{background:whitesmoke}tr.order-row[_ngcontent-%COMP%]:not(.order-expanded-row):active{background:#efefef}.order-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.order-expanded-detail-row[_ngcontent-%COMP%]{overflow:hidden;display:flex}.order-completed-row[_ngcontent-%COMP%]{background-color:#00ff0040!important}.order-time-warning-row[_ngcontent-%COMP%]{background-color:#ff910040!important}.order-overdue-warning-row[_ngcontent-%COMP%]{background-color:#ff000040!important}.order-customer-name[_ngcontent-%COMP%]{position:relative}.order-customer-name[_ngcontent-%COMP%]   .order-customer-occasion[_ngcontent-%COMP%]{position:absolute;top:10px}.row-expand-toggle[_ngcontent-%COMP%]{float:right;margin-right:16px!important}.customer-card[_ngcontent-%COMP%]{max-width:400px;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.customer-card-title[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.customer-card-subtitle[_ngcontent-%COMP%]{font-size:12px}.item-card[_ngcontent-%COMP%]{flex-grow:.5}.total-table-cell[_ngcontent-%COMP%]{border-top:1px solid black;border-bottom:1px solid black}.direction-icon[_ngcontent-%COMP%]{text-decoration:none;color:initial}.all-orders-toggle[_ngcontent-%COMP%]{float:right}.order-info[_ngcontent-%COMP%]{font-weight:500}.order-summary[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);border-radius:5px;padding:8px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block}.net-bill-column[_ngcontent-%COMP%]{font-weight:500!important;color:#000!important}.day-switch-icons[_ngcontent-%COMP%]{font-size:48px}"],data:{animation:[(0,b.X$)("detailExpand",[(0,b.SB)("collapsed",(0,b.oB)({height:"0px",minHeight:"0"})),(0,b.SB)("expanded",(0,b.oB)({height:"*"})),(0,b.eR)("expanded <=> collapsed",(0,b.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),o})()},{path:"**",redirectTo:"",pathMatch:"full"}];let qo=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[L.Bz.forChild(wo)],L.Bz]}),o})();var So=s(4992);let No=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[Z.ez,qo,So.m,a.UX,f.lN,m.p0,I.Ps,x.TU,A.c,w.ot,v.JX,q.Bb,h.FA,T.QW,Q.LD,me,S.AV,C.Is]]}),o})()}}]);